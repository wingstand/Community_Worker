{"id":"fdfd89cb-546c-4212-85f7-d848dc37a075","version":"1.0.38","icon":"other","splash":"other","splashdata":{"img":"Servelec hsc Logo - RGB.png","bg":"#ffffff"},"settings":{"router":{"mode":"single","animation":"off"},"theme":"","push-notifications":{"android":{"enabled":true,"id":"888020801908"},"ios":{"enabled":true},"wp":{"enabled":false}},"provisioning":{"enabled":false,"manifest":"","poll":2,"manual":false,"wifionly":true},"crashReporting":{"enabled":false,"androidEnabled":false,"iosEnabled":false,"splunkAndroidApiKey":"","splunkIosApiKey":"","splunkExtraData":""},"kioskMode":{"enabled":false},"loading-message":false,"encryption":true,"logging":{"enabled":false,"bufferFrequency":100,"defaultRootLogLevel":"error","defaultMaxFileSizeKilobyte":1000,"defaultMaxFiles":5,"appEnabled":true,"appUseDefault":true,"appRootLogLevel":"error","appMaxFileSizeKilobyte":1000,"appMaxFiles":5,"clientEnabled":true,"clientUseDefault":true,"clientRootLogLevel":"error","clientMaxFileSizeKilobyte":1000,"clientMaxFiles":5,"nativeEnabled":true,"nativeUseDefault":true,"nativeRootLogLevel":"error","nativeMaxFileSizeKilobyte":1000,"nativeMaxFiles":5},"plugins":{"builtIn":{"cordova-plugin-whitelist@1.2.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-battery-status@1.2.4":{"override":false,"used":false,"enabled":false},"cordova-plugin-console@1.0.3":{"override":false,"used":true,"enabled":true},"cordova-plugin-contacts@2.1.0":{"override":false,"used":false,"enabled":false},"cordova-plugin-device@1.1.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-device-motion@1.2.1":{"override":false,"used":false,"enabled":false},"cordova-plugin-device-orientation@1.0.3":{"override":false,"used":false,"enabled":false},"cordova-plugin-file@4.2.0":{"override":false,"used":true,"enabled":true},"cordova-plugin-geolocation@2.2.0":{"override":true,"used":false,"enabled":true},"cordova-plugin-globalization@1.0.3":{"override":false,"used":true,"enabled":true},"commontime-cordova-plugin-inappbrowser@1.6.2":{"override":false,"used":false,"enabled":false},"cordova-plugin-network-information@1.2.1":{"override":true,"used":false,"enabled":true},"cordova-plugin-splashscreen@3.2.2":{"override":false,"used":true,"enabled":true},"cordova-plugin-vibration@2.1.4":{"override":false,"used":false,"enabled":false},"cordova-plugin-statusbar@1.0.1":{"override":false,"used":true,"enabled":true},"cordova-plugin-camera@2.3.1":{"override":false,"used":true,"enabled":true},"phonegap-plugin-barcodescanner@6.0.4":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.thumbnail@1.4.8":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.fileimporter@1.0.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-opener@1.0.11":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.beacon@1.0.6":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.notification@1.0.12":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.audio@0.9.11":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.media-properties@1.2.11":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.splitscreen@1.1.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.preferences@1.0.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.authentication@1.0.8":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.urlhandler@1.1.0":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.securesettings@1.0.2":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.geofence@0.5.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-transfer@1.5.5":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.public.provisioning@0.0.13":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.insomnia@0.0.15":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.splunk-mint@1.0.3":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.kiosk@1.0.11":{"override":false,"used":false,"enabled":false},"cordova-android-movetasktoback@0.1.3":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.logging@1.0.24":{"override":false,"used":true,"enabled":true},"cordova-plugin-email":{"override":false,"used":true,"enabled":true},"cordova-android-crosswalk-webview@2.3.0":{"override":false,"enabled":false},"cordova-plugin-emm-app-config@1.0.0":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.public.messaging@0.0.42":{"override":false,"used":true,"enabled":true},"cordova-plugin-battery-status@1.1.2":{"override":false,"used":false,"enabled":false},"cordova-plugin-vibration@2.1.1":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.file-opener@1.0.8":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.notification@1.0.11":{"override":true,"used":true,"enabled":false},"com.commontime.cordova.audio@0.9.10":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.insomnia@0.0.6":{"override":false,"used":false,"enabled":false},"com.commontime.cordova.public.messaging@0.0.44":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.logging@1.0.23":{"override":false,"used":true,"enabled":true},"cordova-plugin-email-composer":{"override":false,"used":true,"enabled":true},"com.commontime.cordova.public.messaging@0.0.41":{"override":false,"used":true,"enabled":true}},"customPlugins":{"cordova-plugin-touch-id":{"id":"cordova-plugin-touch-id","name":"cordova-plugin-touch-id","version":"3.2.0","description":"Scan the fingerprint of your user with the TouchID sensor (iPhone 5S, iPhone 6(S), ..)","spec":"3.2.0"},"cordova-plugin-android-fingerprint-auth":{"id":"cordova-plugin-android-fingerprint-auth","name":"cordova-plugin-android-fingerprint-auth","version":"1.3.1","description":"Cordova plugin to use Android fingerprint authentication API","spec":"1.3.1"},"cordova-plugin-media-capture":{"id":"cordova-plugin-media-capture","spec":"1.4.1","preferences":{},"variables":{"PHOTOLIBRARY_USAGE_DESCRIPTION":"This app would like to access your photo library.","CAMERA_USAGE_DESCRIPTION":"This app would like to use the camera.","MICROPHONE_USAGE_DESCRIPTION":"This app would like to record audio."}},"com.commontime.cordova.notification":{"id":"com.commontime.cordova.notification","spec":"https://github.com/commontime/com.commontime.cordova.notification#1.0.14","name":"CT Notification Plugin","description":"Override features for the Network Information Plugin","version":"1.0.14","preferences":{"inAppPush":"immediate"}}}},"minimise-on-back-button":true},"language":{"defaultLocale":"en_GB","initialLanguage":"","useDeviceLocale":true},"metadata":{"googleMapsApiKey":"AIzaSyB0lxIjNQtKeYwbYJo_MFzlME-gWCir09M","applicationkey":"dev","startDebug":"false","logDebug":"true"},"name":"Community_Worker","packageId":"com.commontime.infinity.communityworker","schemaVersion":22,"minimumStudioVersion":"3.1.0","pages":[{"start":true,"name":"Login","config":[],"content":[{"name":"header","type":"area","item-type":"static","_auto_id_":"eb4ef6f7-5251-4737-b6c8-b4327caf9a6f","content":[{"name":"html_splash","type":"content","item-type":"html","_auto_id_":"326977e6-7019-48b8-afcb-784594ad8ec3","content":"<div class=\"header\">\n  <div class=\"logo\"/>\n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_instructions","type":"content","item-type":"html","_auto_id_":"9a9ae4e7-267d-43a8-bbe0-9a60a61d76fd","content":"<div class=\"splash\">\n  <div class=\"riologo\"/>\n</div>\n<h3>Log In</h3>\n<h5>Please enter your RiO username and password</h5>","expressions":{}},{"name":"group_login","type":"area","item-type":"group","_auto_id_":"675c1a4f-e26e-409f-90ba-a322f67f3f0a","content":[{"name":"username","type":"user-input","item-type":"text","_auto_id_":"0b3b342d-0ee0-494c-a3b6-e9b1f0a9b483","label":"","required":true,"multiline":false,"debounce":250,"placeholder":"Username","expressions":{"disabled":"$store.variables.v_isAuthenticated"},"message":"This is a required field","classes":"minimal","validators":[],"actions":[]},{"name":"password","type":"user-input","item-type":"password","_auto_id_":"0a37fb72-7545-4939-bb1e-5a73a29dfad0","label":"","required":true,"message":"This is a required field","expressions":{"disabled":"$store.variables.v_isAuthenticated"},"placeholder":"Password","classes":"minimal","actions":[]},{"name":"button_login","type":"button","item-type":"button","_auto_id_":"f5163535-ecd6-4868-87d0-5321a99c580f","content":"Login {{'$store.variables.online == \"online\" ? \"\" : \"(offline)\"' | store}}","theme":"minimal","expressions":{"disabled":"$form.invalid"},"actions":[{"type":"if","data":{},"_auto_id_":"889d6bad-0738-4ffb-bda3-babe9cd08188","operations":[{"type":"value","content":"{{($store.variables.v_isAuthenticated) ? 1 : 0}}","$selected":false},{"type":"operator","content":"==","$selected":false},{"type":"value","content":"0","$selected":false}]},{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_login - page Login', \n  'info'\n);\n\n//create base64 encoded string from username and password for the API\ncti.fn_toggle_spinner('open', 'Authenticating...');\n\nvar auth = window.btoa(cti.store.pages.Login.username + ':' + cti.store.pages.Login.password);\ncti.store.variables.auth_header = auth;\n$success();"},"_auto_id_":"62b277ef-3eff-4f3a-a0f9-cb2b23818198","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"authenticate","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"2b448e34-83c3-4700-898d-3e0a1b6bc6c3","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('close');\n\nif($data.$response.success){\n  window.logManager.consoleLog(\n    'API CALL: /authenticate | SUCCESS', \n    'info'\n  );\n\n  cti.store.variables.v_isAuthenticated = true;\n  \n  // Retain the username (we need it for registering for push initially but may require it elsewhere).\n  cti.store.variables.loggedInUser = cti.store.pages.Login.username\n\n  cti.utils.callAction(\"call-actionflow\", { name: \"RegisterPush\" });\n}else{\n  window.logManager.consoleLog(\n    'API CALL: /authenticate | FAIL: Reason - ' + $data.$response.message, \n    'error'\n  );\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Authentication failed\", \n    \"text\" : \"Please check your username and password are correct.\"\n  });\n  \n  cti.store.variables.v_isAuthenticated = false;\n}"},"_auto_id_":"8079bba7-954a-4185-8f7d-7e11ac44ada4","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('close');\n\nwindow.logManager.consoleLog(\n  'API CALL: /authenticate | FAIL: Reason - ' + $data.$response.message, \n  'error');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to connect to the server.\"\n});\n\ncti.store.variables.v_isAuthenticated = false;"},"_auto_id_":"727ea512-95a8-4f61-83e4-6dbe30e5ed3e"}]},{"type":"otherwise","data":{},"_auto_id_":"0207c4e6-5f20-46ca-a102-97b41b2b565e"},{"event":"click","type":"call-actionflow","data":{"name":"Login"},"_auto_id_":"6ab66fc5-69cd-42db-9fe9-99647977de68"},{"type":"end-if","data":{},"_auto_id_":"d1d251dd-19fb-4e45-bce6-9c3c37ef24f2"}],"classes":"default"},{"name":"button_revoke","type":"button","item-type":"button","_auto_id_":"ea3fcf91-c35c-4a83-9953-ccfac9d9f431","content":"Revoke Authentication","theme":"minimal","expressions":{"show":"$store.variables.v_isAuthenticated"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_revoke - page Login', \n  'info'\n);\n\ncti.store.variables.v_isAuthenticated = false;\ncti.fn_revoke_cleardown();\ncti.store.pages.Login.password = \"\";\n\n// Store a temp copy of the username for use within the deregister push call.\ncti.store.variables.temp_user = cti.store.variables.loggedInUser\ncti.store.variables.loggedInUser = ''\n\n// Delete appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  // Reset appointments array\n  doc.data = [];\n  \n  window.logManager.consoleLog(\n    'Pouch DB: Successfully deleted Appointments Data from Pouch', \n    'info'\n  );\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB: Failed retriveing Appointments Data from Pouch - ' + reason + err, \n    'error'\n  );\n});\n\n$success();"},"_auto_id_":"bfbf9582-7bda-4224-b873-53a493774ab0","actions":[]},{"event":"click","type":"call-actionflow","data":{"name":"DeregisterPush"},"_auto_id_":"9aeb960d-4ac5-47cf-8014-f5dce772ca72"}]}],"repeat":false,"expressions":{}},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"853714e7-bfd3-470b-baed-7ff5b896967c","attributes":{},"expressions":{}},{"name":"popupRetry","type":"component","item-type":"web-component","content":[{"name":"html_warnings","type":"content","item-type":"html","_auto_id_":"94685c59-c1c8-4c55-b89a-b2e39bf0474b","content":"<h2>Initial Download Data Failed</h2>\n<p>There was an issue downloading the patient information data on Login. Please try again or, if you continue to have problems, contact support.</p>","expressions":{},"classes":""},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"1ae99f3d-de67-499d-8052-e5463a23b289","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"0d14bed0-90f4-4785-96f1-1a9cc1760b6b","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Login","componentInstanceId":"723ae197-d492-49b6-bde1-ca129f5b4626","function":"toggle"},"_auto_id_":"09458a2a-229b-4de1-8f3b-a6ac304ecdcd"}]},{"name":"button_end_visit_1","type":"button","item-type":"button","_auto_id_":"df86052e-315e-400a-a936-665ce64e1596","content":"RETRY","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_end_visit_1 - page Login', \n  'info'\n);\n\ncti.fn_toggle_spinner('open', 'Downloading Application Data, please wait...');\ncti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n\n$success();"},"_auto_id_":"c15c4c66-c439-4423-9c5f-653ca48824fc"},{"event":"click","type":"call-component-function","data":{"page":"Login","componentInstanceId":"723ae197-d492-49b6-bde1-ca129f5b4626","function":"toggle"},"_auto_id_":"08f1f36a-56e2-4cf1-a9d6-39dc22898df8"}],"classes":"default"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"723ae197-d492-49b6-bde1-ca129f5b4626","attributes":{},"expressions":{}}],"_auto_id_":"98632a55-d771-41a2-9012-3e96037f370e"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_version","type":"content","item-type":"html","_auto_id_":"8e6768e1-c6d4-4e61-8241-d041b21b3068","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"_auto_id_":"eeb5ae3b-c6ec-47d8-8175-4bfa1047cf67","expressions":{}}]},{"start":false,"name":"Visits","config":[{"name":"Page Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"6fc663b9-c23a-4d5e-bb23-8077031375bf","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'Page On-Loaded: Visits', \n  'info'\n);\n\n// Create and append slip js stuff to the Visits list\nvar ol = $('#Visits #list_visits ul')[0];\n\nol.addEventListener('slip:beforereorder', function(e){\n  if (/demo-no-reorder/.test(e.target.className)) {\n    e.preventDefault();\n  }\n}, false);\n\nol.addEventListener('slip:beforewait', function(e){\n  if (e.target.className.indexOf('instant') > -1) e.preventDefault();\n}, false);\n\nol.addEventListener('slip:reorder', function(e){\n  var ul = e.target.parentNode;\n  var apts = cti.store.variables.v_selectedDayAppointments;\n  \n  apts.splice(e.detail.spliceIndex, 0, apts.splice(e.detail.originalIndex, 1)[0]);\n  for (var i = 0; i < apts.length; i++) {\n    apts[i].index = i;\n  }\n  cti.utils.updatePage();\n\n  cti.utils.callAction(\"call-function\", {\"name\":\"fn_render_map\"});\n  \n  return false;\n}, false);\n\n// Clear down excess data\nif(cti.store.variables.clearDown) {\n  delete cti.store.variables.clearDown;\n  \n  delete cti.store.variables.duration_hours;\n  delete cti.store.variables.duration_minutes;\n\n  delete cti.store.variables.selected_visit;\n  delete cti.store.variables.timeline;\n\n  delete cti.store.variables.v_appointmentSyncFromDate;\n  delete cti.store.variables.v_appointmentSyncTomDate;\n\n  delete cti.store.variables.v_planner;\n  delete cti.store.variables.visit_view_mode;\n}\n\n// Initialise slip\nnew Slip(ol);\n\n// Kick off the Google Maps initialisation process\n// Calls fn_init_google_maps to check that we have maps installed...\n// ... then we execute fn_render_map on the callback of that function\nvar setMaps = cti.fn_init_google_maps(\"cti.fn_render_map\")\n\n// Hack: The Google map URL callback does not execute if the map is already added in the header script tag\nif(!setMaps) {\n  cti.fn_render_map()\n}\n\nif(cti.store.variables.v_outcomePayload_clear) {\n  delete cti.store.variables.v_outcomePayload_clear\n  delete cti.store.variables.o_activities\n  cti.utils.destroyPageData('Outcome')\n}\n\nif(cti.store.pages.DialogForm != undefined) { cti.utils.destroyPageData('DialogForm') }\nif(cti.store.pages.SafetyForm != undefined) { cti.utils.destroyPageData('SafetyForm') }\nif(cti.store.pages.LifestyleForm != undefined) { cti.utils.destroyPageData('LifestyleForm') }\n\n$success()"},"_auto_id_":"a2be9697-ce70-40e8-b0fc-70e2614b1306","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_refresh","type":"button","item-type":"button","_auto_id_":"9396ed1f-8a5f-4fe0-af66-ce42047e703f","content":"","theme":"minimal","left-icon":"fa-refresh","expressions":{"show":"0"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_refresh - page Visits', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Refreshing Patient Data, please wait...')\n$success()"},"_auto_id_":"3ab2e213-186e-4fdd-80bc-cbe9559e41b9","actions":[]},{"event":"click","type":"call-actionflow","data":{"name":"GetVisitList"},"_auto_id_":"610da5ad-5b8a-42d4-a346-75f732489496"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>{{'$store.variables.v_appointmentDateText' | store}}'s Visit List</h4>","_auto_id_":"f95e7688-9b31-47ab-bf23-f683d5ecaf88"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"78cb0cec-bd26-4eab-8701-d8d4a982ce5d","content":"","theme":"minimal","left-icon":"fa-bars","expressions":{},"actions":[{"event":"click","type":"call-function","data":{"name":"fn_openContentMenu"},"_auto_id_":"5bf303d4-c24c-4aeb-a305-564dd75035df"}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"d95e49a0-ea09-4de8-a62d-b9af8d01a5ea","attributes":{},"expressions":{}}],"_auto_id_":"ae63d670-add5-4018-b58a-92a093c4e1d7","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"5f284ea1-0c13-4bd8-bd74-028a6557ed14","content":[{"name":"row_date","type":"area","item-type":"row","_auto_id_":"e58f95bd-7b0a-49cd-b72a-1cec1b4c08e0","content":[{"name":"button_yesterday","type":"button","item-type":"button","_auto_id_":"5370bee1-2685-4076-932e-4cf3e6ada5a9","content":"","theme":"minimal","expressions":{"disabled":"$store.variables.v_appointmentDateText == \"Yesterday\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_yesterday - page Visits', \n  'info'\n);\n\ncti.fn_toggle_spinner('open', 'Loading Yesterday\\'s Appointment Data...');\n\nvar newDisplayDate = moment().subtract(1, 'days').format(\"YYYY-MM-DD\");\ncti.store.variables.v_appointmentDate = newDisplayDate;\ncti.store.variables.v_appointmentDateText = 'Yesterday';\n\n$success()"},"_auto_id_":"6c672b10-6819-4289-a3a9-45024f0d6a80"},{"event":"click","type":"debounce","data":{"duration":200},"_auto_id_":"37cf5091-e0c4-47a9-abae-1d37d6563b0e"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_yesterday - page Visits', \n  'info'\n);\n\ncti.fn_load_appointments(true);\n\ncti.utils.updatePage()\n$success()"},"_auto_id_":"165a3058-8369-43e8-8a79-ce12a87c8787","actions":[]}],"left-icon":"fa-arrow-circle-o-left"},{"name":"button_today","type":"button","item-type":"button","_auto_id_":"7fb50f11-09d1-4cf6-a240-1b39f6e197fe","content":"","theme":"minimal","expressions":{"disabled":"$store.variables.v_appointmentDateText == \"Today\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_today - page Visits', \n  'info'\n);\n\ncti.fn_toggle_spinner('open', 'Loading Today\\'s Appointment Data...');\n\nvar newDisplayDate = moment().format(\"YYYY-MM-DD\");\ncti.store.variables.v_appointmentDate = newDisplayDate;\ncti.store.variables.v_appointmentDateText = 'Today';\n\n$success()"},"_auto_id_":"83975e5d-3b68-4628-b629-c36f13a3f902"},{"event":"click","type":"debounce","data":{"duration":200},"_auto_id_":"25acce19-3d6b-44d7-9c6e-ac79b7718629"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_today - page Visits', \n  'info'\n);\n\ncti.fn_load_appointments(true);\n\n$success()"},"_auto_id_":"22cb2469-5c66-4712-86fe-47a48bef960a"}],"left-icon":"fa-calendar"},{"name":"button_tomorrow","type":"button","item-type":"button","_auto_id_":"5b0d3c41-ef09-4f01-a976-d07dfed18c53","content":"","theme":"minimal","expressions":{"disabled":"$store.variables.v_appointmentDateText == \"Tomorrow\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_tomorrow - page Visits', \n  'info'\n);\n\ncti.fn_toggle_spinner('open', 'Loading Tomorrow\\'s Appointment Data...');\n\nvar newDisplayDate = moment().add(1, 'days').format(\"YYYY-MM-DD\");\ncti.store.variables.v_appointmentDate = newDisplayDate;\ncti.store.variables.v_appointmentDateText = 'Tomorrow';\n\n$success()"},"_auto_id_":"6a8009d1-6f7e-4d35-8539-d6a81c8ae9ca"},{"event":"click","type":"debounce","data":{"duration":200},"_auto_id_":"b736b79e-0427-4927-9232-8291d477ca5a"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_tomorrow - page Visits', \n  'info'\n);\n\ncti.fn_load_appointments(true);\n\n$success()"},"_auto_id_":"9b78dd32-0fcb-4d81-8f83-2cb445b098e7","actions":[]}],"right-icon":"fa-arrow-circle-o-right"}],"expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"row_no_appointments","type":"area","item-type":"row","_auto_id_":"5fd9f64d-a6d8-4405-b9f3-bf4572db3e49","content":[{"name":"html_no_appointments","type":"content","item-type":"html","_auto_id_":"9709fc88-c626-480e-b22e-72b52a64def0","content":"<div id=\"no-appointment\">No appointments</h3>","expressions":{"show":"$store.variables.v_selectedDayAppointments.length == 0;"}}],"expressions":{"show":"$store.variables.v_selectedDayAppointments.length == 0;"}},{"name":"list_visits","type":"content","item-type":"list","_auto_id_":"4842b5b6-e456-4892-8f25-2f8012ece499","search":"","classes":"","expressions":{"show":"$store.variables.orientation == 'landscape' || $store.variables.visit_list_view_mode == 'list'"},"model":"$store.variables.v_selectedDayAppointments","theme":"bootstrap","actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"name":"group_visit","type":"area","item-type":"group","_auto_id_":"48b3fc87-e73e-49f3-a901-a2bd2a57a918","content":[{"type":"content","item-type":"html","name":"list_visits_html","_auto_id_":"65b3fc79-73a4-4031-83e8-165a86270403","content":"<div onclick=\"cti.fn_toggle_visit_menu(this.id)\" id=\"{{$data}}\">\n  <div class=\"appointmentPinContainer {{$data.$item.status}}\">\n    <div class=\"pin\">{{$data.$item.index + 1}}</div>\n  </div>\n  <div class=\"listheading patientName\" id=\"collapsible-row-{{$data.$item.$index}}\">{{$data.$item.patientData.demographics.surname}},&nbsp;{{$data.$item.patientData.demographics.firstname}}&nbsp;({{$data.$item.patientData.demographics.title}})</div>\n  <div class=\"nhsNumber\">NHS No. {{$data.$item.nhsNumFormatted}}</div>\n  <div class=\"subtle appointmentType\" id=\"collapsible-row-{{$data.$item.$index}}\">{{$data.$item.appointmentType.value}}</div>  <div class=\"appointmentTime\">{{$data.$item.shortTime}} - {{$data.$item.shortEndTime}}</div>\n  </div>\n</div>","expressions":{},"classes":"row-collapsed instant"},{"name":"group_row_buttons","type":"area","item-type":"group","_auto_id_":"2426fbee-7a6b-4a2a-99c4-bad6fe45ff5d","content":[{"name":"button_eta","type":"button","item-type":"button","_auto_id_":"dda01352-aaa6-419e-9074-aa377d76f64c","content":"Send ETA","theme":"default","expressions":{"show":"0"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_eta - page Visits', \n  'info'\n);\n\ncti.store.variables.v_selectedRowIndex = $data.$index;\n\nif($store.variables.appointments[$store.variables.v_selectedRowIndex].patientData.demographics.mobilePhoneNumber === undefined){\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Mobile Number Unavailable\", \n    \"text\" : \"The patient does not have a mobile phone number on record.\"\n  });\n} else {\n  cti.store.pages.Visits.txtEtaMessage = \"Estimated Time of Arrival is \" + cti.store.variables.appointments[$data.$index].appointmentEta; \n  $success();\n}"},"_auto_id_":"22db0330-01b7-4829-8b84-87591dda8244","actions":[]},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"1b59cf67-5dcf-4c48-8edd-6412937642aa","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"d1f42650-ca14-43b5-80a8-4428a327fa17"}],"classes":""},{"name":"button_call","type":"button","item-type":"button","_auto_id_":"4a16aef3-9fee-4a43-9ff9-33ecee299e03","content":"Call","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call - page Visits', \n  'info'\n);\n\ncti.store.variables.v_selectedRowIndex = $data.$index;\n$success();"},"_auto_id_":"7b65c3e9-3220-40cc-aad1-c8486ec43f8b","actions":[]},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"80c0444b-ee59-41fa-b77b-ce766a9303e3","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"d54c27bc-9e77-4930-80ae-3b53f193c02a"}]},{"name":"button_navigate","type":"button","item-type":"button","_auto_id_":"d47231d5-1cb8-45cf-a86d-9e3ca3564008","content":"Navigate","theme":"default","expressions":{},"classes":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_navigate - page Visits', \n  'info'\n);\n\nif(navigator.appVersion.indexOf('Macintosh') != -1) { \n  cti.utils.callAction(\"call-url\", {\"name\":\"url_google_maps\",\"params\":{\"saddr\":\"current location\",\"daddr\":$data.$item.postCode}});\n} else {\n  var destination = \"geo:0,0?q=\" + $data.$item.postCode.replace(/\\s/g,'');\n  window.open(destination);\n}"},"_auto_id_":"4923c521-3a34-4080-9c79-61f7848d0d2f"}]}],"repeat":false,"expressions":{},"classes":"group_row_buttons"},{"name":"button_open","type":"button","item-type":"button","_auto_id_":"8a4bad71-fef5-4923-a2ae-b0c72e766b71","content":"","theme":"minimal","right-icon":"fa-chevron-right","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_open - page Visits', \n  'info'\n);\n\nif(cti.store.variables.orientation === \"landscape\") {\n  cti.store.variables.visit_view_mode = 'Timeline';\n} else {\n  cti.store.variables.visit_view_mode = 'Menu';\n}\n\ncti.store.variables.selected_visit = $data.$item;\n\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  var appointments = doc.data;\n\n  for(var i in appointments) {\n    if(appointments[i].appointmentId == cti.store.variables.selected_visit.appointmentId) {\n      cti.store.variables.selected_visit.patientData = appointments[i].patientData;\n      break;\n    }\n  }\n  \n  cti.fn_prep_timeline();\n  cti.fn_prep_forms(cti.store.variables.selected_visit);\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"});\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB: Failed retriveing Appointments Data from Pouch - ' + reason + err, \n    'info'\n  );\n});"},"_auto_id_":"930f848c-6d99-48c5-b60c-ae6fcd8d6280"}],"classes":"button_open"}],"repeat":false,"expressions":{},"classes":"row-collapsed instant"}],"autoscroll":false,"searchFunctionExternal":""},{"name":"html_map_container","type":"content","item-type":"html","_auto_id_":"04139baa-3678-4c93-a46e-ec557c6969ad","content":"<div class=\"container-fluid\">\n    <div class=\"row\">\n      <div id=\"mapcontainer\" class=\"col-xs-12\">\n        <div id=\"layersmap\" class=\"embed-responsive\"></div>\n      </div>\n    </div>\n</div>","expressions":{"show":"$store.variables.orientation == 'landscape' || $store.variables.visit_list_view_mode == 'map'"}},{"name":"popupCall","type":"component","item-type":"web-component","content":[{"name":"html_call","type":"content","item-type":"html","_auto_id_":"eaf61f8f-54e3-414d-a5e7-f7f164fa3d27","content":"<h4>Call Patient</h4>\n<!--<p>Use one of the available contact numbers below</p>-->","expressions":{}},{"name":"html_no_numbers","type":"content","item-type":"html","_auto_id_":"63b4d8fb-685d-4188-89ae-340e0a34bff4","content":"<p>There are currently no valid contact numbers for this patient.</p>","expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics.mobilePhoneNumber == undefined && $store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics.officePhoneNumber == undefined && $store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics.eveningPhoneNumber == undefined"}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"0997b133-34da-4a64-a8fb-081f025e2620","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_call_mobile","type":"button","item-type":"button","_auto_id_":"3d6f1caf-130e-4624-beed-802fd50deb7d","content":"Mobile - {{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics.mobilePhoneNumber' | store}}","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call_mobile - page Visits', \n  'info'\n);\n\nvar demographics = cti.store.variables.v_selectedDayAppointments[cti.store.variables.v_selectedRowIndex].patientData.demographics;\n\nif(window) {\n  window.open('tel:141'+demographics.mobilePhoneNumber.replace(/\\\\s/g,''),'_system');\n} else {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning\", \n    \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n  }); \n}\n\n$success()"},"_auto_id_":"23e58145-d707-4555-980a-6f78c95bc1a9"},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"80c0444b-ee59-41fa-b77b-ce766a9303e3","function":"toggle"},"_auto_id_":"5596121a-244a-4f1f-b468-01cfb8b8b736"}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics.mobilePhoneNumber !== undefined"},"classes":""}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics.mobilePhoneNumber !== undefined"}},{"name":"button_bar_evening","type":"area","item-type":"button-bar","_auto_id_":"4caf6100-0635-4995-8882-d154698fbbef","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_call_evening","type":"button","item-type":"button","_auto_id_":"b0ffe54f-6fd8-4dc3-8207-52cd6c9dcf32","content":"Evening - {{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics. eveningPhoneNumber' | store}}","theme":"default","expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics.eveningPhoneNumber !== undefined"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call_evening - page Visits', \n  'info'\n);\n\nvar demographics = cti.store.variables.v_selectedDayAppointments[cti.store.variables.v_selectedRowIndex].patientData.demographics;\n\nif(window) {\n  window.open('tel:141'+demographics.eveningPhoneNumber.replace(/\\\\s/g,''),'_system');\n} else {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning\", \n    \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n  }); \n}\n\n$success();"},"_auto_id_":"1845d5a6-1101-4fcc-878a-16f6a3b966b8"},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"80c0444b-ee59-41fa-b77b-ce766a9303e3","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"43a184fa-25e6-4361-8b75-780aeac2fbae"}]}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics.eveningPhoneNumber !== undefined"}},{"name":"button_bar_office","type":"area","item-type":"button-bar","_auto_id_":"88a7b4e8-d1e7-4ad2-8015-608db5c93a3c","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_call_office","type":"button","item-type":"button","_auto_id_":"39401e70-e853-483b-9269-30193a923ae7","content":"Office - {{'$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics. officePhoneNumber' | store}}","theme":"default","expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics.officePhoneNumber !== undefined"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_call_office - page Visits', \n  'info'\n);\n\nvar demographics = cti.store.variables.v_selectedDayAppointments[cti.store.variables.v_selectedRowIndex].patientData.demographics;\n\nif(window) {\n  window.open('tel:141'+demographics.officePhoneNumber.replace(/\\\\s/g,''),'_system');\n} else {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning\", \n    \"text\" : \"Cordova is not currently installed, so you may not be running the application on a mobile device.\"\n  }); \n}\n\n$success()"},"_auto_id_":"9c8e8fb5-4fcc-4a6c-93d5-1b9e2fdb4d5a"},{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"80c0444b-ee59-41fa-b77b-ce766a9303e3","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"f64cfa6e-a2bc-48b0-a954-197b176efad0"}]}],"expressions":{"show":"$store.variables.v_selectedDayAppointments[$store.variables.v_selectedRowIndex].patientData.demographics.officePhoneNumber !== undefined"}},{"name":"button_bar_call","type":"area","item-type":"button-bar","_auto_id_":"a81c4c69-c84a-4939-b5b7-0b9c84357593","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel_call","type":"button","item-type":"button","_auto_id_":"c52fb70f-7c08-49ed-a73c-d66c82da4b5d","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"80c0444b-ee59-41fa-b77b-ce766a9303e3","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"81b4c390-33d3-49e7-a1b8-808eb2598da4"}],"classes":"default"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"80c0444b-ee59-41fa-b77b-ce766a9303e3","attributes":{"id":"popupCall"},"expressions":{}},{"name":"popupEta","type":"component","item-type":"web-component","content":[{"name":"html_eta","type":"content","item-type":"html","_auto_id_":"bac1d048-0d00-4b55-820e-251935a92706","content":"<h4>Send ETA SMS</h4> <p>Mobile Number: {{'$store.variables.appointments[$store.variables.v_selectedRowIndex].patientData.demographics.mobilePhoneNumber' | store}}</p>\n\n\n","expressions":{"show":"$store.variables.appointments[$store.variables.v_selectedRowIndex].patientData.demographics.mobilePhoneNumber !== undefined"}},{"name":"txtEtaMessage","type":"user-input","item-type":"text","_auto_id_":"e9d23b78-810b-462c-93a2-b361e7423964","label":" ","required":false,"multiline":false,"debounce":250,"expressions":{}},{"name":"button_bar","type":"area","item-type":"button-bar","_auto_id_":"bd373c18-0ebf-43bf-ba8d-4c27ee087cb8","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel","type":"button","item-type":"button","_auto_id_":"02998522-ae26-4f4d-a68e-ed7704e8d94a","content":"Cancel","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"1b59cf67-5dcf-4c48-8edd-6412937642aa","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"a255abc2-a5f5-42b3-9179-780b6faf945d"}]},{"name":"button_send_eta","type":"button","item-type":"button","_auto_id_":"11db656c-727d-461a-a996-581cc1156918","content":"Send","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-actionflow","data":{"name":"SendAppointmentETA"},"_auto_id_":"1ae2752f-d543-4db9-b6bf-cffd28afefb5"}],"classes":"default"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"1b59cf67-5dcf-4c48-8edd-6412937642aa","attributes":{"id":"popupEta"},"expressions":{},"actions":[]},{"name":"ct_context_menu_1","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"d5786c20-01a3-40e0-87c7-b5027a415b63","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"02c01738-f8a5-47d0-a9af-00edf13f9f68"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"9cf662c3-603c-4b53-a18c-3392a027fff1","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"62cc84df-bc0c-43c2-8506-8b2c51bdbb91","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"e1051f87-703d-407d-b374-d65a308c401c","attributes":{"Direction":"right","MinWidth":null,"Overlay":true},"actions":[],"expressions":{}}],"_auto_id_":"ff4c2e02-f136-4e72-bc47-d734af2be8b8","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_list","type":"button","item-type":"button","_auto_id_":"b08bf7fb-1cf2-46fa-8a60-4903c2ffed11","content":"LIST VIEW","theme":"default","actions":[{"event":"click","type":"set-variable","data":{"name":"visit_list_view_mode","value":"list"},"_auto_id_":"2046efe8-0be6-4259-b91f-d3ce6f585394"}],"expressions":{}},{"name":"button_map","type":"button","item-type":"button","_auto_id_":"5b89521f-0af7-4c32-9bbc-2f6e704fdbee","content":"MAP VIEW","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_map - page Visits', \n  'info'\n);\n\ncti.store.variables.visit_list_view_mode = \"map\";\n$success();"},"_auto_id_":"420fd3c4-7c9a-40c9-a6c7-f975022cdef1"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_map - page Visits', \n  'info'\n);\n\nsetTimeout(function(){\n  var center = window.mymap.getCenter();\n  var zoom = window.mymap.getZoom();\n  \n  if(screen.width <= 360) { zoom = 10 }\n  if(screen.width > 360 && screen.width <= 768) { zoom = 12 }\n  else { zoom = 11 }\n  \n  google.maps.event.trigger(window.mymap, \"resize\");\n  window.mymap.setCenter(center);\n  window.mymap.setZoom(zoom == 0 ? 8 : zoom);\n}, 500)\n\n$success()"},"_auto_id_":"72ff7915-9efe-4b0c-9c64-44a32d4c82c2"}],"expressions":{}}],"_auto_id_":"979c8b12-32cb-4386-b8c1-590472a00d0c","expressions":{}}]},{"start":false,"name":"Visit","config":[{"name":"On-Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"dd295370-5c41-4ce5-805d-cd0b0a952891","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.alertSent) {\n  var hiddenString = 'alertRowHidden-' + cti.store.variables.alertToRemove.id;\n  var hidden = document.getElementById(hiddenString);\n  hidden.classList.remove('selected');\n  delete cti.store.variables.alertSent;\n}\n\n// Clear down checks: To avoid displaying the cleared down page, clear it here\nif(cti.store.variables.v_progressNoteToAdd_clear) {\n  delete cti.store.variables.v_progressNoteToAdd_clear;\n  cti.utils.destroyPageData('Note');\n}\nif(cti.store.variables.v_alertToAdd_clear) {\n  delete cti.store.variables.v_alertToAdd_clear;\n  cti.utils.destroyPageData('Alert');\n}\nif(cti.store.variables.v_alertToRemove_clear) {\n  delete cti.store.variables.v_alertToRemove_clear;\n  cti.utils.destroyPageData('RemoveAlert');\n}\nif(cti.store.variables.v_teamplannerToAdd_clear) {\n  delete cti.store.variables.v_teamplannerToAdd_clear;\n  cti.utils.destroyPageData('Team_Planner');\n}\nif(cti.store.variables.v_appointmentToAdd_clear) {\n  delete cti.store.variables.v_appointmentToAdd_clear\n  cti.utils.destroyPageData('HCP_Diary');\n}\nif(cti.store.variables.v_submitOutcome_clear) {\n  delete cti.store.variables.v_submitOutcome_clear;\n  cti.utils.destroyPageData('Outcome');\n}\nif(cti.store.variables.v_submitDialogFormPayload_clear) {\n  delete cti.store.variables.v_submitDialogFormPayload_clear\n  cti.utils.destroyPageData('DialogForm')\n}\nif(cti.store.variables.v_submitSafetyFormPayload_clear) {\n  delete cti.store.variables.v_submitSafetyFormPayload_clear\n  cti.utils.destroyPageData('SafetyForm')\n}\n\n$success()"},"_auto_id_":"e8a966eb-7f7e-407c-9e37-d20391c8a37f","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"495f4883-ae58-40dd-8ea0-9ca028ae13ea","content":"","theme":"minimal","left-icon":"fa-home","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'inline_function: button_back - page Visit', \n  'info'\n)\ndebugger;\n// Retain any currently inprogress forms for usage later on\nif(cti.store.variables.selected_visit.dialog_form_status == \"inprogress\") {\n  cti.store.variables.selected_visit.dialog_form_page = cti.store.pages.DialogForm\n}\nif(cti.store.variables.selected_visit.lifestyle_form_status == \"inprogress\") {\n  cti.store.variables.selected_visit.lifestyle_form_page = cti.store.pages.LifestyleForm\n} \nif(cti.store.variables.selected_visit.safety_form_status == \"inprogress\") {\n  cti.store.variables.selected_visit.safety_form_page = cti.store.pages.SafetyForm\n}\n\n// Load appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  var appointments = doc.data;\n\n  // Check that we have a valid appointment\n  for(var i in appointments) {\n    if(appointments[i].appointmentId == cti.store.variables.selected_visit.appointmentId) {\n      // Update the appointment data with the selected appointment\n      appointments[i] = cti.store.variables.selected_visit;\n      break;\n    }\n  }\n\n  // Update the pouch DB with new data\n  window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n    console.log('Updated Appointment Data. Revision: ' + rev);\n    // Set clear down variable\n    cti.store.variables.clearDown = true;\n\n    // Reset appointments\n    cti.fn_load_appointments();\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"Visits\"});\n  }, function(reason, e) {\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"Visits\"});\n\n    console.log('Failed to Update Appointment Data - ' + reason, e);\n  });\n}, function (reason, err) {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"Visits\"});\n  console.log('Error: Failed retriveing Appointments Data from Pouch - ', reason + err);\n});"},"_auto_id_":"6f206d2d-301a-42fa-9652-f31a80e6327c"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Patient Details</h4>","_auto_id_":"b387b333-5787-45db-8d2f-2bdf3db8dc0f"},{"name":"button_menu","type":"button","item-type":"button","_auto_id_":"b7e10801-894a-4a63-afa2-942ced4f8027","content":"","theme":"minimal","expressions":{},"left-icon":"fa-bars","actions":[{"event":"click","type":"call-component-function","data":{"page":"Visit","componentInstanceId":"6d19a3c7-8376-455f-a48f-a509df9ebc3a","function":"toggle"},"_auto_id_":"dfa7ecc7-24a5-452b-a273-050841d7e922"}]}],"_auto_id_":"d31270e8-8cfa-43e2-b195-4566f1854265","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"c154bfac-abaa-495a-b685-49c2182207b4","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"ecdf6a96-3f19-43e4-9fe6-096e962515f7","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"3ecc9b9f-141f-4ac0-8266-295b0bb57d44","content":"{{'($store.variables.visit_view_mode != \"Menu\" && $store.variables.orientation == \"portrait\") ? \"Back to Summary\" : $store.variables.selected_visit.appointmentType.value + \" (\" + $store.variables.selected_visit.shortTime + \" - \" + $store.variables.selected_visit.shortEndTime + \")\"'|store}}","theme":"minimal","expressions":{},"actions":[{"event":"click","type":"set-variable","data":{"name":"visit_view_mode","value":"Menu"},"_auto_id_":"05c2a15a-b9ba-4fe7-9da0-3a5009d2d6fd"}],"classes":""},{"name":"html_view_mode","type":"content","item-type":"html","_auto_id_":"1aff1b03-61ad-43b9-8b1a-05f85b656072","content":"{{'$store.variables.visit_view_mode' | store}}","expressions":{"show":"$store.variables.visit_view_mode != \"Menu\" && $store.variables.orientation != \"landscape\" &&  $store.variables.visit_view_mode != \"Alerts\""},"classes":"infoBanner"},{"name":"button_filter","type":"button","item-type":"button","_auto_id_":"1a5f32f0-5d43-4076-a9ec-d357cda6ebcc","content":"{{'$store.variables.filter == undefined || $store.variables.filter == \"open\" ? \"Open\" : \"All\"' | store}} Alerts ({{'$store.variables.selected_visit.patientData.displayAlerts.length' | store}})","theme":"minimal","expressions":{"show":"$store.variables.visit_view_mode == \"Alerts\""},"actions":[{"event":"click","type":"call-function","data":{"name":"fn_set_view","params":{"view_name":"Alerts","manual_filter":""}},"_auto_id_":"881b4cd5-42d5-4186-a344-10b99335c24b"}],"right-icon":"fa-filter","classes":"infoBanner"}],"expressions":{},"classes":"relative"},{"name":"scrollable_menu","type":"area","item-type":"scrollable","content":[{"name":"group_tasks","type":"area","item-type":"group","_auto_id_":"5af178d7-f16d-4f5d-99ec-280ef4e871ca","content":[{"name":"html_dialog","type":"content","item-type":"html","_auto_id_":"7a2ae6c7-cacd-4780-a3ea-deb133ddfc59","content":"<div onclick=\"cti.fn_load_form('dialogplus')\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon dialog\"></div>\n    <div class=\"{{'$store.variables.selected_visit.dialog_form_status' | store}}\">\n      <h5>Dialog+</h5>\n      <i class=\"arrow fa fa-chevron-right {{'$store.variables.selected_visit.dialog_form_status != \\'notcomplete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-hourglass-half {{'$store.variables.selected_visit.dialog_form_status != \\'inprogress\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-check {{'$store.variables.selected_visit.dialog_form_status != \\'complete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <div class=\"subtle {{'$store.variables.selected_visit.dialog_form_status' | store}}\">{{'$store.variables.selected_visit.dialog_form_status_text' | store}}</div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.dialog_form"}},{"name":"html_lifestyle","type":"content","item-type":"html","_auto_id_":"181be314-540b-40a3-8ec7-e6d8fa2a9cc3","content":"<div onclick=\"cti.fn_load_form('phlifestyl')\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon lifestyle\"></div>\n    <div class=\"{{'$store.variables.selected_visit.lifestyle_form_status' | store}}\">\n      <h5>Lifestyle</h5>\n      <i class=\"arrow fa fa-chevron-right {{'$store.variables.selected_visit.lifestyle_form_status != \\'notcomplete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-hourglass-half {{'$store.variables.selected_visit.lifestyle_form_status != \\'inprogress\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-check {{'$store.variables.selected_visit.lifestyle_form_status != \\'complete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <div class=\"subtle {{'$store.variables.selected_visit.lifestyle_form_status' | store}}\">{{'$store.variables.selected_visit.lifestyle_form_status_text' | store}}</div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.lifestyle_form"}},{"name":"html_safety","type":"content","item-type":"html","_auto_id_":"e27fc242-a72e-4683-ad96-3067182ce3cb","content":"<div onclick=\"cti.fn_load_form('msp')\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon safety\"></div>\n    <div class=\"{{'$store.variables.selected_visit.safety_form_status' | store}}\">\n      <h5>My Safety Plan</h5>\n      <i class=\"arrow fa fa-chevron-right {{'$store.variables.selected_visit.safety_form_status != \\'notcomplete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-hourglass-half {{'$store.variables.selected_visit.safety_form_status != \\'inprogress\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <i class=\"arrow fa fa-check {{'$store.variables.selected_visit.safety_form_status != \\'complete\\' ? \\'display-none\\' : \\'\\'' | store}}\"></i>\n      <div class=\"subtle {{'$store.variables.selected_visit.safety_form_status' | store}}\">{{'$store.variables.selected_visit.safety_form_status_text' | store}}</div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.safety_form"}},{"name":"html_noforms","type":"content","item-type":"html","_auto_id_":"7d573e08-320c-4630-bb41-28cc34af54d4","content":"<div>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon task\"></div>\n    <div class=\"complete\">\n      <h5>No Forms to Complete for this Visit</h5>\n      <div class=\"subtle\">Not Applicable</div>\n    </div>\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.dialog_form === false && $store.variables.selected_visit.lifestyle_form === false && $store.variables.selected_visit.safety_form === false"}},{"name":"html_patient_record_head","type":"content","item-type":"html","_auto_id_":"d00640ef-415f-4a47-a669-5e33df09d592","content":"Patient Record","expressions":{}}],"repeat":false,"expressions":{}},{"name":"html_button_timeline","type":"content","item-type":"html","_auto_id_":"3cf09456-6589-4ccc-8454-2651b81f3773","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Timeline\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon timeline\"></div>\n    <div>\n      <h5>Timeline</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.timeline.length' | store}} Events</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_patient","type":"content","item-type":"html","_auto_id_":"95a15968-6f86-47e9-970b-05e81e853ff4","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Patient Demographics\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon patient\"></div>\n    <div>\n      <h5>Demographics</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.demographics.surname'|store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname'|store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title'|store}})</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_alerts","type":"content","item-type":"html","_auto_id_":"12cf7bd2-9d77-49c9-b3ce-63b90b4c13a0","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Alerts\",\"manual_filter\":\"true\"}});' class=\"{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\'hasAlerts\\' : \\'\\'' |store }}\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon alerts-added\"></div>\n    <div>\n      <h5>Alerts</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.alerts.length' | store}} Alerts, Last {{'$store.variables.selected_visit.patientData.alerts[0].date' | store | date:mediumDate}}</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_appointments","type":"content","item-type":"html","_auto_id_":"e2d4baca-f9a6-4630-a959-9f76c6921c64","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Appointments\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon appointments\"></div>\n    <div>\n      <h5>Appointments</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.appointmentHistory.length' | store}} Appointments, Last {{'$store.variables.selected_visit.patientData.appointmentHistory[0].date' | store | date:mediumDate}}</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_referrals","type":"content","item-type":"html","_auto_id_":"28a7a0ba-11d9-448f-995a-444a4820a4a3","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Referrals\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon referral\"></div>\n    <div>\n      <h5>Referrals</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.referrals.length' | store}} Referrals, Last {{'$store.variables.selected_visit.patientData.referrals[0].referralDate' | store | date:mediumDate}}</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_dialog","type":"content","item-type":"html","_auto_id_":"f1660403-e71a-47ae-974c-63c234890155","content":"<div onclick=\"cti.fn_view_dialog()\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon dialog\"></div>\n    <div>\n      <h5>Dialog+ Forms</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.dialogPlusForms.length'|store}} Forms, Last {{'$store.variables.selected_visit.patientData.dialogPlusForms[0].assessmentDate.result' | store | date:mediumDate}}</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_lifestyle","type":"content","item-type":"html","_auto_id_":"6dee6b5f-9c0c-4695-a969-19737c3fb1a8","content":"<div onclick=\"cti.fn_view_lifestyle()\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon lifestyle\"></div>\n    <div>\n      <h5>Lifesyle Assessment Forms</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms.length'|store}} Forms, Last {{'$store.variables.selected_visit.patientData.lifestyleAssessmentForms[0].assessmentDate.result' | store | date:mediumDate}}</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_safety","type":"content","item-type":"html","_auto_id_":"9eb41e27-c4e2-4bbc-968a-b2d1700cc781","content":"<div onclick=\"cti.fn_view_safety(false)\">\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon safety\"></div>\n    <div>\n      <h5>My Safety Plan Forms</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.mySafetyPlanForms.length'|store}} Forms, Last {{'$store.variables.selected_visit.patientData.mySafetyPlanForms[0].assessmentDate.result' | store | date:mediumDate}}</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_progress_note","type":"content","item-type":"html","_auto_id_":"5f711f4d-51d3-4f05-bd47-d84f0df65602","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Progress Notes\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon notes\"></div>\n    <div>\n      <h5>Progress Notes</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.progressNotes.length' | store}} Notes, Last {{'$store.variables.selected_visit.patientData.progressNotes[0].dateTime.substring(0, 10)' | store | date:mediumDate}}</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_documents","type":"content","item-type":"html","_auto_id_":"ed5cb934-9c78-496c-8cc3-6aa19be08c25","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Documents\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon documents\"></div>\n    <div>\n      <h5>Documents</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.documents.length' | store}} Documents, Last {{'$store.variables.selected_visit.patientData.documents[0].documentDate.substring(0, 10)' | store | date:mediumDate}}</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_allergies","type":"content","item-type":"html","_auto_id_":"74b6dcf6-3de7-4af9-9278-5a17ff6a8149","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Allergies\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon allergies\"></div>\n    <div>\n      <h5>Allergies</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.allergies.length' | store}} Allergies</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"html_button_contacts","type":"content","item-type":"html","_auto_id_":"a0fd5dde-5301-4f46-b026-f468ec5af06b","content":"<div onclick='cti.utils.callAction(\"call-function\", {\"name\":\"fn_set_view\",\"params\":{\"view_name\":\"Contacts\"}});'>\n  <div class=\"row summary\" onclick=\"\">\n    <div class=\"icon contacts\"></div>\n    <div>\n      <h5>Contacts</h5>\n      <i class=\"arrow fa fa-chevron-right\" aria-hidden=\"true\"></i>\n      <div class=\"subtle\">{{'$store.variables.selected_visit.patientData.contacts.length' | store}} Contacts</div>\n    </div>\n  </div>\n</div>","expressions":{}},{"name":"ct_context_menu","type":"component","item-type":"web-component","content":[{"name":"button_logout","type":"button","item-type":"button","_auto_id_":"8fe1ea84-3d97-46cd-a98f-4ec3a24d9573","content":"Logout","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"Login","isConditional":false},"_auto_id_":"1e280b88-ab30-41a6-9304-ded49c132db2"}],"expressions":{}},{"name":"button_bar_menu","type":"area","item-type":"button-bar","_auto_id_":"8a32bee1-d820-488c-acf7-cbed2693abc3","extends":{"type":"area","item-type":"row"},"content":[{"name":"html_menu_version","type":"content","item-type":"html","_auto_id_":"a14f9ef2-ae9d-4ee7-b6d8-dda319124005","content":"Version {{'$store.schema.version' | store}}","expressions":{}}],"expressions":{}}],"componentId":"1fa0aab1-7b03-413d-b3e0-433405059753","_auto_id_":"6d19a3c7-8376-455f-a48f-a509df9ebc3a","attributes":{"Direction":"right","Overlay":true},"expressions":{},"actions":[]}],"_auto_id_":"ab428813-0ad2-402f-a609-fc58a4c00e14","expressions":{"show":"$store.variables.orientation == 'landscape' || $store.variables.visit_view_mode == 'Menu'"}},{"name":"scrollable_results","type":"area","item-type":"scrollable","_auto_id_":"e7d7b01e-9ad9-4e3a-a75e-8149e4e09b66","content":[{"name":"list_timeline","type":"content","item-type":"list","_auto_id_":"a357cca3-87d4-4b02-a650-5e8688b98c66","search":"","classes":"","model":"$store.variables.timeline","expressions":{"show":"$store.variables.visit_view_mode == \"Timeline\""},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_timeline_html","_auto_id_":"02d96c84-0e55-4b8d-a449-2852156e2585","content":"<div class=\"icon {{$data.$item.eventType}}\"></div>\n<div class=\"event\">\n    <div class=\"eventType\">\n        {{$data.$item.eventType == \"admission\" ? \"Admission\" : \"\"}}\n        {{$data.$item.eventType == \"documents\" ? \"Document Added: \" + $data.$item.title : \"\"}}\n        {{$data.$item.eventType == \"referral\" ? \"Referred to \" + $data.$item.referredToDisplay + \" by \" + $data.$item.referrer + \", \" + $data.$item.referralSource.value : \"\"}}\n        {{$data.$item.eventType == \"notes\" ? \"Progress Note: \" + $data.$item.progressNoteType.value + \", \" + $data.$item.progressNoteSubType.value : \"\"}}\n        {{$data.$item.eventType == \"appointments\" ? \"Appointment: \" + $data.$item.type + \" with \" + $data.$item.hcpSurname + \", \" + $data.$item.hcpForename + \" \" + $data.$item.hcpTitle : \"\"}}\n        {{$data.$item.eventType == \"alerts-added\" ? \"Alert Added\" : \"\"}}\n      \t{{$data.$item.eventType == \"alerts-removed\" ? \"Alert Removed\" : \"\"}}\n      \t{{$data.$item.eventType == \"allergies\" ? \"Allergy Added by \" + $data.$item.reportedBy : \"\"}}\n    </div>\n    <div class=\"date\">\n      {{$data.$item.eventType == \"allergies\" ? $data.$item.eventDateDisplay : $data.$item.eventDate | date:'dd MMM yyyy HH:mm'}}\n    </div>\n    <div class=\"eventDescription\">\n        {{$data.$item.eventType == \"admission\" ? \"Admitted to \" + $data.$item.admittedWard : \"\"}}\n        {{$data.$item.eventType == \"documents\" ? \"Type: \" + $data.$item.documentType.value : \"\"}}\n        {{$data.$item.eventType == \"referral\" ? $data.$item.urgency.value + \" referral to service \" + $data.$item.specialty.value : \"\"}}\n        {{$data.$item.eventType == \"alerts-added\" ?  $data.$item.type.value : \"\"}}\n        {{$data.$item.eventType == \"alerts-removed\" ?  $data.$item.displayText : \"\"}}\n      \t{{$data.$item.eventType == \"allergies\" ?  $data.$item.substance : \"\"}}\n    </div>\n    <div ng-bind-html=\"$data.$item.timeLineDisplay\" class=\"eventDescription\" >\n        {{$data.$item.eventType == \"notes\" || $data.$item.eventType == \"appointments\" ? $data.$item.timeLineDisplay : \"\"}}\t\n    </div>\n</div>"}]},{"name":"list_alerts","type":"content","item-type":"list","_auto_id_":"59c4e049-44a8-484f-a361-9da7e3341e52","search":"","classes":"","expressions":{"show":"$store.variables.visit_view_mode == \"Alerts\""},"model":"$store.variables.selected_visit.patientData.displayAlerts","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_alerts_html","_auto_id_":"a24f026a-52eb-4e5b-88b9-8f6eabfa8974","content":"<!-- HTML Template for tablet size devices and above -->\n<div id=\"alertRowHidden-{{$data.$item.id}}\" class=\"card_holder\">\n  <div class=\"alert_type\">{{$data.$item.type.value}}</div>\n  <div class=\"date\"><span>Date</span>{{$data.$item.date | date:mediumDate}}</div>\n  <div class=\"flex_row line_after\">\n    <div class=\"priority\"><span>Priority</span>{{$data.$item.priority.value }}</div>\n    <div class=\"ended\"><span>Ended</span>{{$data.$item.removalDate == undefined ? \"No\" : \"Yes\"}}</div>\n  </div> \n  <div class=\"line_after {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n    <div class=\"removal_date\"><span>Removal date</span>{{$data.$item.removalDate | date:mediumDate}}</div>\n    <div class=\"removal_comment\"><span>Comment</span>{{$data.$item.removalComment == \"\" ? \"No Comment\" : $data.$item.removalComment}}</div>    \n  </div>\n  <div class=\"alert_text\">{{$data.$item.text}}</div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.displayAlerts.length > 0"}}],"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"debugger;\nif(cti.store.variables.alertToRemove) {\n  //var visibleString = 'alertRowVisible-' + cti.store.variables.alertToRemove.id;\n  var hiddenString = 'alertRowHidden-' + cti.store.variables.alertToRemove.id;\n\n  //var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  if(hidden == null) {\n    delete cti.store.variables.alertToRemove;\n    return false;\n  }\n\n  //visible.classList.remove('selected');\n  hidden.classList.remove('selected');\n  \n  if($data.$item.id != cti.store.variables.alertToRemove.id) {\n    cti.store.variables.alertToRemove = $data.$item;\n\n    //var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n    var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n    //var visible = document.getElementById(visibleString);\n    var hidden = document.getElementById(hiddenString);\n\n    //visible.classList.add('selected');\n    hidden.classList.add('selected');\n\n\tcti.store.variables.alerts = [];\n\tcti.store.variables.alerts.push(cti.store.variables.alertToRemove);\n  } else {\n    delete cti.store.variables.alertToRemove;\n  }\n} else {\n  cti.store.variables.alertToRemove = $data.$item;\n\n  //var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n  var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n  //var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  //visible.classList.add('selected');\n  hidden.classList.add('selected');\n\n  cti.store.variables.alerts = [];\n  cti.store.variables.alerts.push(cti.store.variables.alertToRemove);\n}\n\ncti.utils.updatePage();"},"_auto_id_":"c4a000a5-4299-406d-9279-628dbb9d493c"}]},{"name":"image_alerts","type":"media","item-type":"image-viewer","_auto_id_":"7c9dd3e0-26a7-4ec5-ac1a-9bd497d6f567","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.visit_view_mode == \"Alerts\" && $store.variables.selected_visit.patientData.alerts.length == 0"},"fileName":"thin-0550_attention_error_alert_caution.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_alerts_nodata_html","_auto_id_":"a2fed7eb-ec78-4f41-86f4-c7d13c937fbd","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Patient Alerts</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Patient Alerts</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.visit_view_mode == \"Alerts\" && $store.variables.selected_visit.patientData.alerts.length == 0"}},{"name":"list_appointments","type":"content","item-type":"list","_auto_id_":"375d377f-9b5b-4914-89db-72a9578f7c17","search":"","classes":"","expressions":{"show":"$store.variables.visit_view_mode == \"Appointments\""},"model":"$store.variables.selected_visit.patientData.appointmentHistory","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_appointments_html","_auto_id_":"a8e478ed-b5a7-45d4-b2bf-13b372ac056e","content":"<div class=\"card_holder\">\n  <div class=\"line_after\">\n    <div class=\"appt_type\">{{$data.$item.type}}</div>\n    <div >{{$data.$item.hcpSurname}}, {{$data.$item.hcpForename}}  {{$data.$item.hcpTitle != '' ? '(' : ''}}{{$data.$item.hcpTitle}}{{$data.$item.hcpTitle != '' ? ')' : ''}}</div>\n  </div>\n  <div class=\"{{$data.$item.comment == '' ? '' : 'line_after'}}\">\n    <div class=\"date\"><span>Date</span>{{$data.$item.date | date:'d MMM y h:mm'}} ({{$data.$item.intendedDuration}} Minutes)</div>\n    <div><span>Setting</span>{{$data.$item.clinic}}</div>\n    <div><span>Location</span>{{$data.$item.location}}</div>\n    <div><span>Setting</span></div>\n    <div class=\"{{$data.$item.cancellationReason == '' ? 'display-none' : 'Yes'}}\">\n      <span>Cancellation</span>{{$data.$item.cancellationReason != \"\" ? $data.$item.cancellationReason : \"Not Applicable\"}}\n    </div>\n    <div class=\"{{$data.$item.outcome == '' ? 'display-none' : 'Yes'}}\">\n      <span>Outcome</span>{{$data.$item.outcome != \"\" ? $data.$item.outcome : \"Not Applicable\"}}\n    </div>\n  </div>\n  <div class=\"{{$data.$item.comment == '' ? 'display-none' : 'Yes'}}\">   \n    <span>Comments</span>{{$data.$item.comment != \"\" ? $data.$item.comment : \"Not Applicable\"}}\t\t\n  </div>\n</div> "}],"actions":[]},{"name":"image_appointments","type":"media","item-type":"image-viewer","_auto_id_":"156021cc-159f-4588-979e-422eeb147e03","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.visit_view_mode == \"Appointments\" && $store.variables.selected_visit.patientData.appointmentHistory.length == 0"},"fileName":"thin-0023_calendar_month_day_planner_events.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_apps_nodata_html","_auto_id_":"1a8a9b7a-18dc-4105-bc87-6040da56958c","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Appointment History</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Appointment History</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.visit_view_mode == \"Appointments\" && $store.variables.selected_visit.patientData.appointmentHistory.length == 0"}},{"name":"list_referrals","type":"content","item-type":"list","_auto_id_":"183518b8-415d-45dd-aa54-ab144576c1ad","search":"","classes":"","model":"$store.variables.selected_visit.patientData.referrals","theme":"","expressions":{"show":"$store.variables.visit_view_mode == \"Referrals\""},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_referrals_html","_auto_id_":"feff52a7-7778-4a68-97e7-86f410d8205f","content":"<div class=\"card_holder\">\n  <div class=\"flex_row\">\n    <div class=\"referral\">Referred to {{$data.$item.specialty.value}}</div>\n    <div ng-if=\"$data.$item.associatedDocuments.associatedDocument.fileType\" class=\"doc_link_holder fa {{$data.$item.associatedDocuments.associatedDocument.fileType == 'image/jpeg' ? 'fa-camera' : 'fa-file-text-o'}}\" onclick=\"cti.fn_load_document(this.id)\" id=\"{{$data.$item.associatedDocuments.associatedDocument}}\"></div>\n  </div>  \n    <div class=\"service\"><span>Date</span>{{$data.$item.referralDate | date:'d MMM y h:mm'}}</div>\n    <div class=\"service\"><span>Team/HCP</span>{{$data.$item.team.value}}</div>\n    <div class=\"referrer\"><span>By</span>{{$data.$item.referrer}}</div>\n    <div class=\"referrer\"><span>Source</span>{{$data.$item.source}}</div>   \n</div>"}]},{"name":"image_referrals","type":"media","item-type":"image-viewer","_auto_id_":"013e9a56-ff59-4fc7-a992-bd5495c1b7dc","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.visit_view_mode == \"Referrals\" && $store.variables.selected_visit.patientData.referrals.length == 0"},"fileName":"thin-0825_stetoscope_doctor_hospital_ill.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_referral_nodata_html","_auto_id_":"aa6d9d74-603c-4a34-b145-e28ad7c848ff","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Referral Information</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Referral Information</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.visit_view_mode == \"Referrals\" && $store.variables.selected_visit.patientData.referrals.length == 0"}},{"name":"list_notes","type":"content","item-type":"list","_auto_id_":"c07b4af9-38cc-49d9-9eca-5fa92364788b","search":"","classes":"","expressions":{"show":"$store.variables.visit_view_mode == \"Progress Notes\""},"model":"$store.variables.selected_visit.patientData.progressNotes","actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_notes_html","_auto_id_":"2e6a70f2-b096-4b24-84e3-7dc88468d6be","content":"<div class=\"card_holder\">\n    <div class=\"line_after flex_row\">\n        <div class=\"note_type left half\">{{$data.$item.progressNoteType.value}}</div>\n        <div class=\"sub_type right half\">{{$data.$item.progressNoteSubType.value}}</div>\n        <div class=\"speciality full\"><span>Specialty</span>{{$data.$item.specialty.value}}</div>\n    </div>\n    <div class=\"line_after\">\n        <div class=\"{{$data.$item.associatedDocuments != undefined ? 'documents' : 'hide'}}\">\n            <p class=\"fa {{$data.$item.associatedDocuments.associatedDocument.fileType == 'image/jpeg' ? 'fa-camera' : 'fa-file-text-o'}}\" onclick=\"cti.fn_load_document(this.id)\" id=\"{{$data.$item.associatedDocuments.associatedDocument}}\"></p>\n        </div>\n        <div class=\"date\"><span>Date</span>{{$data.$item.dateTime | date:'dd MMM yyyy HH:mm'}}</div>\n        <div class=\"hcp\"><span>HCP</span>{{$data.$item.enteredBy.value}}</div>\n        <div class=\"validated\"><span>Validated</span>{{$data.$item.verifyDate == undefined ? \"No\" : \"Yes\"}}</div>\n        <div class=\"significant\"><span>Significant</span>{{$data.$item.isSignificant == \"0\" ? \"No\" : \"Yes\"}}</div>\n        <div class=\"third_party\"><span>Third party</span>{{$data.$item.isThirdParty == undefined ? \"No\" : \"Yes\"}}</div>\n        <div class=\"risk\"><span>Risk</span>{{$data.$item.isRiskRelated == \"0\" ? \"No\" : \"Yes\"}}</div>\n    </div>\n        <div class=\"note\">{{$data.$item.noteText}}</div>\n</div>","expressions":{}}]},{"name":"image_notes","type":"media","item-type":"image-viewer","_auto_id_":"18c1f515-3db6-4399-a5ca-1a3f058cc15c","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.visit_view_mode == \"Progress Notes\" && $store.variables.selected_visit.patientData.progressNotes.length == 0"},"fileName":"thin-0003_write_pencil_new_edit.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_notes_nodata_html","_auto_id_":"7837f386-1073-4c9a-90c2-4dbe564e9dd8","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Progress Notes</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Progress Notes</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.visit_view_mode == \"Progress Notes\" && $store.variables.selected_visit.patientData.progressNotes.length == 0"}},{"name":"list_documents","type":"content","item-type":"list","_auto_id_":"c0ebffd2-00e9-4ee8-990c-50801aa56d32","search":"","classes":"","model":"$store.variables.selected_visit.patientData.documents","theme":"","expressions":{"show":"$store.variables.visit_view_mode == \"Documents\""},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_documents_html","_auto_id_":"3674b3b2-7a6a-46d7-b046-10acb5bd8d0e","content":"<div class=\"card_holder \" onclick=\"cti.fn_load_document(this.id)\" id=\"{{$data.$item}}\">\n  <div class=\"title\" >{{$data.$item.title}}<div class=\"doc_link_holder fa {{$data.$item.fileType == 'image/jpeg' ? 'fa-camera' : 'fa-file-text-o'}}\" ></div></div>\n  <div class=\"date\"><span>Date</span>{{$data.$item.documentDate | date:mediumDate}}</div>\n  <div class=\"type\"><span>Type</span>{{$data.$item.documentType.value}}</div>\n</div>","expressions":{}}]},{"name":"image_documents","type":"media","item-type":"image-viewer","_auto_id_":"e2f9b008-f789-452f-991f-7eabd7414d65","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.visit_view_mode == \"Documents\" && $store.variables.selected_visit.patientData.documents.length == 0"},"fileName":"thin-0073_documents_files_paper_text_archive_copy.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_docs_nodata_html","_auto_id_":"01800e72-3e3d-46a6-bfd4-bfad4cac1b6c","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Documents Available</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Documents Available</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.visit_view_mode == \"Documents\" && $store.variables.selected_visit.patientData.documents.length == 0"}},{"name":"list_allergies","type":"content","item-type":"list","_auto_id_":"e398cdf1-13bd-4a03-a506-b9cd438d845d","search":"","classes":"","model":"$store.variables.selected_visit.patientData.allergies","theme":"","expressions":{"show":"$store.variables.visit_view_mode == \"Allergies\""},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_allergies_html","_auto_id_":"5f5232ae-71ac-4ed2-8179-383f46932775","content":"<div class=\"card_holder\" >\n    <div class=\"line_after\">   \n        <div class=\"substance\">{{$data.$item.substance}} - {{$data.$item.reactionSeverity}}</div>\n        <div class=\"type\"><span>Type</span>{{$data.$item.reactionType}}</div>\n    </div>\n    <div class=\"{{$data.$item.reaction != '' ? 'line_after' : ''}}\">  \n        <div class=\"year\"><span>Identified in</span>{{$data.$item.yearOfIdentification}}</div>\n        <div class=\"reporter\"><span>Reported by</span>{{$data.$item.reportedBy}}</div>\n    </div>\n    <div class=\"reaction {{$data.$item.reaction != '' ? '' : 'hide'}}\"><span>Reaction</span>{{$data.$item.reaction}}</div>\n</div>","expressions":{}}]},{"name":"image_allergies","type":"media","item-type":"image-viewer","_auto_id_":"ddb4a011-620d-4cb9-8a0c-8a4d4bee6ac3","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.visit_view_mode == \"Allergies\" && $store.variables.selected_visit.patientData.allergies.length == 0"},"fileName":"thin-0816_microscope_laboratory.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_allergy_nodata_html","_auto_id_":"6fd0b167-39c5-456c-8ea5-6ddc422f420e","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Allergies Identified</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Allergies Identified</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.visit_view_mode == \"Allergies\" && $store.variables.selected_visit.patientData.allergies.length == 0"}},{"name":"list_contacts","type":"content","item-type":"list","_auto_id_":"5e04bcee-e2bb-4e38-8289-22749fbb546c","search":"","classes":"list_contact","model":"$store.variables.selected_visit.patientData.contacts","theme":"","expressions":{"show":"$store.variables.visit_view_mode == \"Contacts\""},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_contacts_html","_auto_id_":"4daa8568-e49d-42d8-8c8d-2ad3689415b0","content":"<div class=\"card_holder\" >\n  <div class=\"line_after\">   \n    <div class=\"contact_name\">{{$data.$item.name}}</div>\n    <div class=\"relationship\"><span>Relationship</span>{{$data.$item.contactRelationship.value}}</div>\n    <div class=\"type\"><span>Type</span>{{$data.$item.contactType.value}}</div>\n  </div>\n  <div class=\"icon phones {{$data.$item.emailAddress != '' ? 'line_after' : ''}}\" onclick=\"cti.fn_call_contact(this.id)\" id=\"{{$data.$item.mainPhone}}\">\n    <span>Phone</span>{{$data.$item.mainPhone}}\n  </div>\n  <div class=\"{{$data.$item.emailAddress != '' ? '' : 'hide'}}\" >\n    <div class=\"email\"><span>Email</span>{{$data.$item.emailAddress}}</div>\n  </div>\n</div>","expressions":{}}]},{"name":"image_contacts","type":"media","item-type":"image-viewer","_auto_id_":"2e52b13f-6c1b-4039-afdc-6ac78bc16b24","scaleImage":true,"maxWidth":50,"maxHeight":50,"expressions":{"show":"$store.variables.visit_view_mode == \"Contacts\" && $store.variables.selected_visit.patientData.contacts.length == 0"},"fileName":"thin-0301_address_book_contacts.png","actions":[],"classes":"no-data-image"},{"type":"content","item-type":"html","name":"list_contacts_nodata_html","_auto_id_":"c4b96676-45da-4e67-9bb0-fbdf28ff5cf9","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Key Contacts</strong>\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatCenter\">\n    <strong>No Contacts Available</strong>\n  </div>\n</div>","expressions":{"show":"$store.variables.visit_view_mode == \"Contacts\" && $store.variables.selected_visit.patientData.contacts.length == 0"}},{"name":"list_patient","type":"content","item-type":"list","_auto_id_":"bd7144fb-37ad-4873-8c1f-f9f0b3ed0532","search":"","classes":"","model":"$store.variables.selected_visit.patientData.patient","theme":"","expressions":{"show":"$store.variables.visit_view_mode == \"Patient Demographics\""},"actions":[],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_patient_html","_auto_id_":"eee9a914-67e3-4243-8ea6-b902b1c7fbc0","content":"<div class=\"card_holder\">\n  <div class=\"line_after\">\n    <div class=\"contact_name\">\n      {{$data.$item.surname}}, {{$data.$item.firstname}}  {{$data.$item.title != '' ? '(' : ''}}{{$data.$item.title}}{{$data.$item.title != '' ? ')' : ''}}\n    </div>\n    <div class=\"dob\">\n      <span>DOB</span>{{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} (aged {{'$store.variables.selected_visit.age'\n      | store}})\n    </div>\n    <div class=\"gp\"><span>Current GP</span>{{'$store.variables.selected_visit.gpDetails'|store}}</div>\n    <div class=\"nhs\"><span>NHS Number</span>{{$data.$item.nhsNumFormatted}}</div>\n    <div class=\"client_id\"><span>Client ID</span>{{$data.$item.clientId.value}}</div>\n  </div>\n  <div class=\"line_after icon location\">\n    <div class=\"short_address\">{{'$store.variables.selected_visit.addressFormatted'|store}}</div>\n    <div class=\"p_code\">{{'$store.variables.selected_visit.postCode'|store}}</div>\n  </div>\n  <div class=\"{{$data.$item.eveningPhoneNumber != undefined || $data.$item.officePhoneNumber != undefined || $data.$item.mobilePhoneNumber != undefined ? 'line_after' : ''}}\">\n    <div class=\"gender\"><span>Gender</span>{{$data.$item.gender.value}}</div>\n    <div class=\"ethnic\"><span>Ethnicity</span>{{$data.$item.ethnicity.value}}</div>\n    <div class=\"language\"><span>Language</span>{{$data.$item.language.value != undefined ? $data.$item.language.value : \"Not Specified\"}}</div>\n    <div class=\"nationality\"><span>Nationality</span>{{$data.$item.nationality.value != undefined ? $data.$item.nationality.value : \"Not Specified\"}}</div>\n  </div>\n  <div ng-if=\"$data.$item.eveningPhoneNumber != undefined || $data.$item.officePhoneNumber != undefined || $data.$item.mobilePhoneNumber != undefined\" class=\"phones icon\">\n    <div class=\"mobile\" ng-if=\"$data.$item.mobilePhoneNumber != ''\" onclick=\"cti.fn_call_contact(this.id)\" id=\"{{$data.$item.mobilePhoneNumber}}\"><span>Mob</span>{{$data.$item.mobilePhoneNumber}}</div>\n    <div class=\"office\" ng-if=\"$data.$item.officePhoneNumber != ''\" onclick=\"cti.fn_call_contact(this.id)\" id=\"{{$data.$item.officePhoneNumber}}\"><span>Day</span>{{$data.$item.officePhoneNumber}}</div>\n    <div class=\"evening\" ng-if=\"$data.$item.eveningPhoneNumber != ''\" onclick=\"cti.fn_call_contact(this.id)\" id=\"{{$data.$item.eveningPhoneNumber}}\"><span>Eve</span>{{$data.$item.eveningPhoneNumber}}</div>\n  </div>\n</div>","expressions":{}}]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"2baa0651-777f-4107-ab35-2297559e002a","attributes":{},"expressions":{},"actions":[]}],"expressions":{"show":"$store.variables.orientation == 'landscape' || $store.variables.visit_view_mode != 'Menu'"}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_start_visit","type":"button","item-type":"button","_auto_id_":"80c283cb-764f-4015-b9b2-9624c7936cf0","content":"START VISIT","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.arrivalTime = new Date();\ncti.store.variables.selected_visit.status = 'started';\ncti.utils.updatePage();"},"_auto_id_":"1a999863-7e4c-4d54-934d-594c462d2de5","actions":[]}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime == undefined && $store.variables.visit_view_mode != 'Appointments') && $store.variables.selected_visit.status != \"complete\""},"classes":"default"},{"name":"button_add_note_1","type":"button","item-type":"button","_auto_id_":"3d4a8938-2b3d-4918-acb8-83e706c2611e","content":"ADD NOTE","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Appointments' && $store.variables.visit_view_mode != 'Alerts') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Note","isConditional":false},"_auto_id_":"274b90b9-6705-4a28-9f49-896153bc2eb7"}]},{"name":"button_add_alert","type":"button","item-type":"button","_auto_id_":"c17af3d4-d8ea-4271-9032-02af2792ca04","content":"ADD ALERT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Appointments') || $store.variables.selected_visit.status == \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Alert","isConditional":false},"_auto_id_":"0cc4ce77-fbe9-40e2-a742-d07bdf022c81"}]},{"name":"button_end_visit","type":"button","item-type":"button","_auto_id_":"d51a2646-b835-4fd4-8d25-494dcd2e058f","content":"END VISIT","theme":"default","expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode != 'Appointments' && $store.variables.visit_view_mode != 'Alerts') && $store.variables.selected_visit.status != \"complete\""},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Outcome","isConditional":false},"_auto_id_":"1d51707f-4a32-449c-b345-63f91344df10"}],"classes":"default"},{"name":"button_team_planner","type":"button","item-type":"button","_auto_id_":"c0bf9da6-8f7a-4101-a40e-ea4232a864a7","content":"ADD TO TEAM PLANNER","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.Team_Planner = {group_activities:[]};\ndelete cti.store.variables.selected_visit.repeat;\ndelete cti.store.pages.Team_Planner;\n$success();"},"_auto_id_":"daebffa0-bbb1-4209-8f69-9c4fc19e7644"},{"event":"click","type":"go-to-page","data":{"name":"Team_Planner","isConditional":false},"_auto_id_":"eeb4d187-7225-4817-935f-d88ce185bb66"}],"expressions":{"show":"$store.variables.visit_view_mode == 'Appointments' && $store.variables.selected_visit.status != \"complete\""},"classes":"default hide"},{"name":"button_hcp_diary","type":"button","item-type":"button","_auto_id_":"f84b5674-ab9b-4a19-bdbf-708aae61669d","content":"ADD TO HCP DIARY","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.HCP_Diary = {group_activities:[]};\ndelete cti.store.pages.HCP_Diary;\n$success();"},"_auto_id_":"5be2c616-772b-4005-9ded-677b27199517"},{"event":"click","type":"go-to-page","data":{"name":"HCP_Diary","isConditional":false},"_auto_id_":"82364630-2f57-44c2-b0ac-d012925393cf"}],"expressions":{"show":"$store.variables.visit_view_mode == 'Appointments' && $store.variables.selected_visit.status != \"complete\" && 0"},"classes":"default hide"},{"name":"button_end_date_alert","type":"button","item-type":"button","_auto_id_":"9f8c107e-c954-4dda-8e79-60165bb0cfba","content":"END DATE ALERT","theme":"default","actions":[{"event":"click","type":"go-to-page","data":{"name":"RemoveAlert","isConditional":false},"_auto_id_":"87493912-2849-4866-9e47-c884795d3081"}],"expressions":{"show":"($store.variables.selected_visit.arrivalTime != undefined && $store.variables.visit_view_mode === 'Alerts') || $store.variables.selected_visit.status == \"complete\"","disabled":"$store.variables.alertToRemove === undefined"}}],"_auto_id_":"6a2151df-ed54-4163-9974-8fa5950a3fe1","expressions":{"show":"$store.variables.visit_view_mode != \"Appointments\""}}]},{"start":false,"name":"Note","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"574ae9fa-e98d-4f0c-9b13-8f9c39ed63d8","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"fb775062-c3b9-4ab0-a179-697ad70d7d9a"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>New Progress Note</h4>","_auto_id_":"8e7121ed-8185-4c7e-a977-d7d697f3f201"}],"_auto_id_":"aedd7dab-f725-478d-b806-71246d3f4056","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"43d28d6e-9dad-416f-a9c3-acab5308a4ed","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"142364dd-4c2c-4a97-b153-75403576119c","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"noteType","type":"choice","item-type":"select","_auto_id_":"4d218db5-fcad-4818-8715-fedc398e3fca","label":"Note Type: ","required":false,"options":[{"label":"TypeA - *** USE FOR DEMO ***","value":"nt1"},{"label":"Child Health Administration","value":"CH"},{"label":"Child Development Services","value":"CHDEVSER"},{"label":"Community Paediatrics","value":"COMPAED"},{"label":"CPA Review","value":"CPA"},{"label":"Child Protection","value":"CS"},{"label":"Diabetics","value":"DIABN"},{"label":"Dietetics","value":"DIET"},{"label":"District Nursing","value":"DN"},{"label":"EPathways Manual Completion Reason","value":"EPATHWAY"},{"label":"Geriatric Medicine","value":"GM"},{"label":"General Medical Services","value":"GMP"},{"label":"Health Visiting","value":"HV"},{"label":"Community Beds","value":"INP"},{"label":"Intermediate Care","value":"INTCARE"},{"label":"Looked after Children","value":"LACN"},{"label":"LAC Review","value":"LACReview"},{"label":"MDT Meeting","value":"MDT"},{"label":"Occupational Therapy","value":"OT"},{"label":"Paediatrics","value":"PAED"}],"message":"This is a required field","expressions":{},"description":"","validators":[],"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"debugger;\nvar noteTypes = cti.store.api.api_rio.getnotetypes.data.progressNoteTypes.uiNoteTypes;\nvar code = cti.store.pages.Note.noteType;\n\nif(code) {\n  var hasSubNotes = false;\n  \n  for(var i in noteTypes) {\n    if(noteTypes[i].code === code.value) {\n      cti.store.variables.uiSubNoteTypes = noteTypes[i].subNoteType;\n      hasSubNotes = true;\n      break;\n    }\n  }\n  \n  if(!hasSubNotes) {\n    cti.store.variables.uiSubNoteTypes = undefined;\n  }\n} else {\n  cti.store.variables.uiSubNoteTypes = undefined;\n} \n\ncti.utils.updatePage();"},"_auto_id_":"e0b7f991-52cf-4bb9-947f-eadba092efd8"}],"option-source":"$store.api.api_rio.getnotetypes.data.progressNoteTypes.uiNoteTypes","label-property":"value","value-property":"code"},{"name":"subType","type":"choice","item-type":"select","_auto_id_":"2cd6b280-5e60-41ad-86a1-50184351fe5d","label":"Sub Note Type:","required":false,"options":[{"label":"Option 1","value":1},{"label":"Option 2","value":2},{"label":"Option 3","value":3}],"expressions":{},"actions":[],"option-source":"$store.variables.uiSubNoteTypes","label-property":"value","value-property":"code"},{"name":"specialty","type":"choice","item-type":"select","_auto_id_":"42141468-e96b-4aae-8d1c-0f990dc8d399","label":"Specialty:","required":false,"options":[{"label":"General Surgery","value":"100"},{"label":"General Medical Practice","value":"600"},{"label":"Community Medicine","value":"900"}],"expressions":{},"option-source":"$store.api.api_rio.getnotespecialites.data.userSpecialties.userSpecialty","label-property":"value","value-property":"code"},{"name":"noteText","type":"user-input","item-type":"text","_auto_id_":"09bada34-11ae-4ac8-9268-084fc607bf70","label":"Note: ","required":true,"multiline":true,"debounce":250,"message":"This is a required field","expressions":{},"validators":[],"actions":[]},{"name":"row_media","type":"area","item-type":"row","_auto_id_":"8d80ecca-3cc1-46e2-a57e-a5808501cba5","content":[{"name":"button_take_photo","type":"button","item-type":"take-photo-button","_auto_id_":"54bc98ec-1a34-45e0-92bb-7fbd55878a8f","extends":{"type":"button","item-type":"button"},"content":"Take photo","actions":[{"event":"click","type":"take-photo","data":{"quality":75,"multiple":false,"mediaId":"btnPhoto"}}],"left-icon":"fa-camera","theme":"minimal","expressions":{"show":"($store.media.btnPhoto == undefined || $store.media.btnPhoto.images.length == 0) && ($store.media.btnAudio == undefined || $store.media.btnAudio.audio.length == 0)"}},{"name":"image_viewer","type":"media","item-type":"image-viewer","_auto_id_":"1d2f3e49-13d6-4fa7-a94d-9acbc6716e32","scaleImage":true,"maxWidth":150,"maxHeight":80,"model":"$store.media.btnPhoto.images[0]","actions":[{"event":"click","type":"delete-media","data":{"model":"$store.media.btnPhoto.images[{{0}}]"},"_auto_id_":"832b0877-4245-489e-bb7e-5f82c11a085e"}],"expressions":{"show":"$store.media.btnPhoto != undefined && $store.media.btnPhoto.images != undefined && $store.media.btnPhoto.images.length > 0"}},{"name":"button_delete_photo","type":"button","item-type":"button","_auto_id_":"b8810e2c-f3f6-4ffb-9bf8-0f80e3b39ee9","content":"","theme":"minimal","left-icon":"fa-trash","actions":[{"event":"click","type":"delete-media","data":{"model":"$store.media.btnPhoto.images[{{0}}]"},"_auto_id_":"c4cef8f2-7c17-462f-b158-1d94501521bf"}],"expressions":{"show":"$store.media.btnPhoto != undefined && $store.media.btnPhoto.images != undefined && $store.media.btnPhoto.images.length > 0"}},{"name":"record_audio","type":"capture","item-type":"record-audio","_auto_id_":"c54a0586-dd04-4526-b17e-374ea5b5c47e","label":"Record Audio: ","required":false,"smallRecorder":false,"multiple":false,"mediaId":"btnAudio","actions":[],"expressions":{"show":"($store.media.btnPhoto == undefined || $store.media.btnPhoto.images.length == 0) && ($store.media.btnAudio == undefined || $store.media.btnAudio.audio.length == 0)"}},{"name":"audio_player","type":"media","item-type":"audio","_auto_id_":"219c3468-9822-486e-b301-798f12e2012f","actions":[],"model":"$store.media.btnAudio.audio[0]","expressions":{"show":"$store.media.btnAudio != undefined && $store.media.btnAudio.audio != undefined && $store.media.btnAudio.audio.length > 0"}},{"name":"button_delete_audio","type":"button","item-type":"button","_auto_id_":"b4fc083f-0b8f-46c4-ba2c-389cb764aed2","content":"","theme":"minimal","actions":[{"event":"click","type":"delete-media","data":{"model":"$store.media.btnAudio.audio[{{0}}]"},"_auto_id_":"d6fbb8e1-433a-4483-862c-da47bebea8a3"}],"expressions":{"show":"$store.media.btnAudio != undefined && $store.media.btnAudio.audio != undefined && $store.media.btnAudio.audio.length > 0"},"left-icon":"fa-trash"}],"expressions":{}},{"name":"button_advanced","type":"button","item-type":"button","_auto_id_":"fcca4009-6088-4f6d-9c8d-5fd4bbc39b5c","content":"{{'$store.variables.show_advanced_note == false ? \"Show Advanced...\" : \"Hide Advanced\"' | store}}","theme":"default","actions":[{"type":"if","data":{},"_auto_id_":"7116dd7e-e8a9-40e8-ac4e-6b89879c7908","operations":[{"type":"value","content":"{{$store.variables.show_advanced_note}}","$selected":false},{"type":"operator","content":"==","$selected":false},{"type":"value","content":"{{true}}","$selected":false}]},{"event":"click","type":"set-variable","data":{"name":"show_advanced_note","value":"{{false}}"},"_auto_id_":"6849c85a-c9e7-4313-acd6-653076a146a4"},{"type":"otherwise","data":{},"_auto_id_":"998e33a7-a010-41ce-a1e2-51b4fcc48170"},{"event":"click","type":"set-variable","data":{"name":"show_advanced_note","value":"{{true}}"},"_auto_id_":"97fc2265-d9e5-4de7-a6ae-5b38249785c0"},{"type":"end-if","data":{},"_auto_id_":"8e59ce99-6e9c-4429-85b5-8ac3510e17a7"}],"expressions":{}},{"name":"group_advanced","type":"area","item-type":"group","_auto_id_":"b442d6ae-9df3-4a2d-8bc1-8714121ce4be","content":[{"name":"flagSignificantEvent","type":"choice","item-type":"switch","_auto_id_":"8c82bed5-6c9c-4d50-a6cb-fff9cb9d9704","label":" Significant Event:","required":false,"on-text":"YES","off-text":"NO","expressions":{},"validators":[],"actions":[]},{"name":"flagThirdParty","type":"choice","item-type":"switch","_auto_id_":"fdedb618-eab1-4e79-9c09-f99298feb915","label":"Contains third party information:","required":false,"on-text":"YES","off-text":"NO","expressions":{}},{"name":"flagClientConceal","type":"choice","item-type":"switch","_auto_id_":"e0f14df2-96a1-4fbb-89de-2f07f464fb56","label":"Conceal from Client:","required":false,"on-text":"YES","off-text":"NO","expressions":{}}],"repeat":false,"expressions":{"show":"$store.variables.show_advanced_note == true"}},{"name":"group_riskType","type":"area","item-type":"group","_auto_id_":"3171b3a2-5054-4f05-a757-f7cb890cba93","content":[{"name":"riskType","type":"choice","item-type":"select","_auto_id_":"ff5c8da3-775d-4f1b-9e1c-fb046339d3f2","label":"Risk Type:","required":false,"options":[{"label":"Allergy","value":"AL"},{"label":"Child on Register","value":"CPR"},{"label":"Do Not Divulge Address","value":"DNDA"}],"expressions":{},"validators":[],"actions":[],"option-source":"$store.api.api_rio.getnoterisktypes.data.riskTypes.riskType","label-property":"value","value-property":"code"}],"repeat":true,"expressions":{"show":"$store.variables.show_advanced_note == true"}},{"name":"list_riskType","type":"content","item-type":"list","_auto_id_":"92d67849-20d0-416f-ad04-fbf662050e6c","search":"","classes":"","expressions":{"show":"$store.variables.show_advanced_note == true"},"model":"$store.repeater.Note.group_riskType","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.Note.group_riskType.splice( $data.$item.$index, 1);"},"_auto_id_":"c45fd1c6-0e22-4f6e-b383-fb21788bd144","actions":[]}],"dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_riskType_html","_auto_id_":"33d670e0-fbe3-440d-8616-387fa672d650","content":"<i class=\"fa fa-trash\"></i> {{$data.$item.riskType.label}}"}]}],"_auto_id_":"64340310-2804-4c93-b044-39494e2dcfc1"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"fa853d0d-0c16-4a8b-9ab9-4465aa9a606f","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"call-actionflow","data":{"name":"AddProgressNote"},"_auto_id_":"6f9df8b6-10cf-49ea-96da-019aca8edd5c"}],"classes":"default"},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"00c0ae9d-eba0-4154-9c80-c0e7d0b5b940","attributes":{},"expressions":{}}],"_auto_id_":"2da640d2-c23a-422c-b66a-61037c061ef0","expressions":{}}]},{"start":false,"name":"Alert","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"c6e2fa5d-ee91-436a-b0e4-03d24818fcd0","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"c315294e-24fd-43e2-a37e-951cb05d21ee"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>New Alert</h4>","_auto_id_":"9ca4c0ad-35ca-43ac-a202-a4b73d793b9a"}],"_auto_id_":"8c162f27-11fe-44a6-af57-6f80a3f71751"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"4e166671-4c1e-45ea-b640-24abc0f6a06a","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"ca69cb99-ca2a-4fdd-ad3d-c636ec79111b","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"type","type":"choice","item-type":"select","_auto_id_":"37d9d790-a909-4bd0-aef7-edd5e66c1da1","label":"Type:","required":true,"options":[],"expressions":{},"option-source":"$store.api.api_rio.alerttypes.data","label-property":"value","value-property":"code","message":"This is a required field"},{"name":"priority","type":"choice","item-type":"select","_auto_id_":"973cfe47-0984-4b8c-a57b-48fce8bfc06f","label":"Priority:","required":true,"options":[],"expressions":{},"label-property":"value","value-property":"code","option-source":"$store.api.api_rio. alertpriorities.data","validators":[],"actions":[],"message":"This is a required field"},{"name":"description","type":"user-input","item-type":"text","_auto_id_":"244258f7-6554-44b0-aaaa-40190a3bb565","label":"Description:","required":true,"multiline":true,"debounce":250,"message":"This is a required field","expressions":{},"maxlength":500,"validators":[]}],"_auto_id_":"0a6cdff1-761e-4d35-87f6-b482d0e8decd","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"9310bbc6-a2b2-4834-9a58-c6f86445beaf","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"call-actionflow","data":{"name":"AddAlert"},"_auto_id_":"4a8e29ac-a8e9-4fa5-8e7d-d3671dba6777"}],"classes":"default"},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"cfa45b78-d92d-4a2a-bb10-6d36c196cc99","attributes":{},"expressions":{}}],"_auto_id_":"9eddd62a-53bb-4a7a-8898-fec5ab8d4ccf","expressions":{}}]},{"start":false,"name":"Outcome","config":[{"name":"Page Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"fc3ca296-c8bf-4b48-92b4-ef79ed7d1675","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"cti.fn_populate_duration_dl()\ncti.fn_calc_visit_duration()\n\n$success()"},"_auto_id_":"6e899ada-8966-49a3-a41c-f4fbcf4d4ea2"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"7655f35f-28f4-4d0b-9d6b-e82c411de8bf","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Outcome","componentInstanceId":"934dc2c9-8ceb-4c95-9028-84b6a629479e","function":"toggle"},"_auto_id_":"40999e63-f8f2-48da-b245-b35dbf98535d"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>End Visit<h4>","_auto_id_":"b56b6549-6d87-4ce9-8aaf-53e8e43cc6dd"}],"_auto_id_":"bfa4fc5e-4017-4ee8-a775-6d18820e8a6d"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"f6785ce4-30a0-4bc2-ab57-7be3d928a029","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"c341bde3-ec7c-4a17-b9cb-450d5155e578","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"arrivalTime","type":"user-input","item-type":"time","_auto_id_":"13fd198a-4cc0-45fb-bd03-d2ed86b0b23b","label":"Arrived At: ","required":true,"options":{"interval":15,"min":"07:00","max":"22:00"},"left-icon":"fa-clock-o","expressions":{},"validators":[],"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"function setTime() {\n  var startDate = cti.store.variables.selected_visit.arrivalTime;\n  var arrivalTime = moment(startDate).format(\"HH:mm\");\n  var arrivalTimeHours = moment(arrivalTime, \"HH:mm\").format(\"HH\");\n  var arrivalTimeMinutes = moment(arrivalTime, \"HH:mm\").format(\"mm\");\n  var minsArrivalTime = parseInt(arrivalTimeMinutes);\n  var arrivalTimeLabel = \"\";\n\n  if(minsArrivalTime < 15) { arrivalTimeLabel = arrivalTimeHours+\":00\"; }\n  else if(minsArrivalTime >= 15 && minsArrivalTime < 30) { arrivalTimeLabel = arrivalTimeHours+\":15\"; }\n  else if(minsArrivalTime >= 30 && minsArrivalTime < 45) { arrivalTimeLabel = arrivalTimeHours+\":30\"; } \n  else if(minsArrivalTime >= 45 && minsArrivalTime < 60) { arrivalTimeLabel = arrivalTimeHours+\":45\"; }\n\n  cti.store.pages.Outcome.arrivalTime = arrivalTimeLabel;\n}\n\nvar arrivalTime = cti.store.pages.Outcome.arrivalTime;\nvar currentTime = moment().format(\"HH:mm\");\n\nif(currentTime < arrivalTime) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Time Error.\", \n    \"text\" : \"The Patient Arrival Time can not be after the current time.\"\n  });\n  setTime();\n}\n\ncti.utils.updatePage();"},"_auto_id_":"8a9866d1-9056-4cad-a16c-9252ae2fff5a"}],"message":"This is a required field"},{"name":"actualTime","type":"user-input","item-type":"time","_auto_id_":"9cb1a369-f743-448a-aa91-df3dbbc46647","label":"Seen At: ","required":true,"options":{"interval":15,"min":"07:00","max":"22:00"},"left-icon":"fa-clock-o","expressions":{},"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"function setTime() {\n  var startDate = cti.store.pages.Outcome.arrivalTime;\n  var arrivalTime = moment(startDate, \"HH:mm\").format(\"HH:mm\");\n  var arrivalTimeHours = moment(arrivalTime, \"HH:mm\").format(\"HH\");\n  var arrivalTimeMinutes = moment(arrivalTime, \"HH:mm\").format(\"mm\");\n  var minsArrivalTime = parseInt(arrivalTimeMinutes);\n  var arrivalTimeLabel = \"\";\n\n  if(minsArrivalTime < 15) { arrivalTimeLabel = arrivalTimeHours+\":00\"; }\n  else if(minsArrivalTime >= 15 && minsArrivalTime < 30) { arrivalTimeLabel = arrivalTimeHours+\":15\"; }\n  else if(minsArrivalTime >= 30 && minsArrivalTime < 45) { arrivalTimeLabel = arrivalTimeHours+\":30\"; } \n  else if(minsArrivalTime >= 45 && minsArrivalTime < 60) { arrivalTimeLabel = arrivalTimeHours+\":45\"; }\n\n  cti.store.pages.Outcome.actualTime = arrivalTimeLabel;\n}\n\nvar arrivalTime = cti.store.pages.Outcome.arrivalTime;\nvar actualTime = cti.store.pages.Outcome.actualTime;\nvar currentTime = moment().format(\"HH:mm\");\n\nif(actualTime < arrivalTime) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Time Error.\", \n    \"text\" : \"The Patients Seen At Time can not be before the Patients Arrival Time.\"\n  });\n  setTime();\n} else if(actualTime > currentTime) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: Time Error.\", \n    \"text\" : \"The Patients Seen At Time can not be after the current time.\"\n  });\n  setTime();\n} else {\n  var now = moment().format(\"HH:mm\");\n  var time = moment.utc(moment(now,\"HH:mm\").diff(moment(actualTime,\"HH:mm\"))).format(\"HH:mm\");\n  var mins = moment(time, \"HH:mm\").format(\"m\");\n  var hours = moment(time, \"HH:mm\").format(\"H\");\n\n  cti.store.pages.Outcome.duration_hours = {\"label\": hours, \"value\": hours };\n  cti.store.pages.Outcome.duration_minutes = {\"label\": mins, \"value\": mins };\n}\n\ncti.utils.updatePage();"},"_auto_id_":"df3415dc-af99-45af-bf4f-9a0c093e26ae"}],"message":"This is a required field"},{"name":"html_duration_label","type":"content","item-type":"html","_auto_id_":"db6b40af-0a7b-4b68-9f9e-7656502786bf","content":"<label>Duration:</label>","expressions":{}},{"name":"row_duration","type":"area","item-type":"row","_auto_id_":"5c6a6db0-d81d-4eed-a1e6-42aa3a50553a","content":[{"name":"duration_hours","type":"choice","item-type":"select","_auto_id_":"035cdab9-df86-4900-a01c-2a36e5c542de","label":"Hours:","required":true,"options":[],"searchable":false,"expressions":{},"option-source":"$store.variables.duration_hours","label-property":"label","value-property":"value","message":"This is a required field"},{"name":"duration_minutes","type":"choice","item-type":"select","_auto_id_":"36ffe205-2954-481a-a452-7bcbb02c63cc","label":"Minutes:","required":true,"options":[],"expressions":{},"searchable":false,"option-source":"$store.variables.duration_minutes","label-property":"label","value-property":"value","message":"This is a required field"}],"expressions":{}},{"name":"group_activities","type":"area","item-type":"group","_auto_id_":"b7266429-c3a6-42a9-bd44-4ffa5c451437","content":[{"name":"activity","type":"choice","item-type":"select","_auto_id_":"8087e4d3-a4a3-45ae-af06-2bf70f6d9293","label":"Activity:","required":false,"options":[{"label":"Activity A","value":"activitya"},{"label":"Activity B","value":"activityb"}],"expressions":{},"validators":[],"actions":[],"option-source":"$store.variables.selected_visit.attendees.attendee.possibleActivities.possibleActivity","label-property":"value","value-property":"code","message":"This is a required field","searchable":true},{"name":"button_add_activity","type":"button","item-type":"button","_auto_id_":"60969fb4-08f5-490f-8ff3-912ff480dc41","content":"Add","theme":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"debugger;\nif(cti.store.pages.Outcome == undefined || cti.store.pages.Outcome.activity == undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: You must select a valid Activity.\", \n    \"text\" : \"You must select a valid activity from the Activites drop down list.\"\n  });\n} else {\n  if(cti.store.variables.o_activities == undefined) {\n    cti.store.variables.o_activities = []\n  }\n  \n  cti.store.variables.o_activities.push(cti.store.pages.Outcome.activity)\n  cti.store.pages.Outcome.activity = undefined\n}\ncti.utils.updatePage();"},"_auto_id_":"7109c067-a6a9-46b6-90cb-376633f142c6"}],"expressions":{},"classes":"button-add-activity"}],"repeat":false,"expressions":{}},{"name":"list_activities","type":"content","item-type":"list","_auto_id_":"9d9dba26-3ecf-4cb8-8e6d-b94eb1368043","search":"","classes":"","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.o_activities.splice( $data.$item.$index, 1);"},"_auto_id_":"bbe4fc5c-f452-46fc-a4af-7bf5461c5d7e"}],"expressions":{},"model":"$store.variables.o_activities","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_activities_html","_auto_id_":"adcfe111-3f87-4025-a94d-8226ad8bcf05","content":"<i class=\"fa fa-times-circle-o\"></i> {{$data.$item.label}}","expressions":{}}]},{"name":"outcome","type":"choice","item-type":"select","_auto_id_":"bf5c40c5-cea0-409d-962c-cc683cd8cfcd","label":"Outcome:","required":true,"options":[{"label":"Outcome A","value":"outcomea"},{"label":"Outcome B","value":"outcomeb"},{"label":"Did Not Attend","value":"dna"}],"expressions":{},"message":"This is a required field","option-source":"$store.variables.selected_visit.attendees.attendee.possibleOutcomes.possibleOutcome","label-property":"value","value-property":"code"},{"name":"comments","type":"user-input","item-type":"text","_auto_id_":"798cc828-4f58-4383-928a-e5ce261bfba7","label":"Comments:","required":false,"multiline":true,"debounce":250,"message":"This is a required field","expressions":{},"maxlength":500,"validators":[]},{"name":"popupBack","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"23f8d005-924d-47b1-b772-2e9e61ee467f","content":"<h2>Cancel Outcome</h2>\n<p>You are about to cancel the outcome for this appointment. Any information you have entered will be lost.</p>\n<p>Do you want to continue? </p>","expressions":{}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"4279672c-7c31-478f-ae0c-a2a5f1ff9142","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_end_visit_1","type":"button","item-type":"button","_auto_id_":"4e441df0-eada-44dc-a9b2-501e191c4854","content":"YES","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.v_submitOutcome_clear = true;\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"});\n$success();"},"_auto_id_":"9b42511c-ff6e-4f78-8642-b0c866c28a9f"},{"event":"click","type":"call-component-function","data":{"page":"Outcome","componentInstanceId":"934dc2c9-8ceb-4c95-9028-84b6a629479e","function":"toggle"},"_auto_id_":"5ccfee4f-0d52-4983-b2b2-c33e41ef69a9"}],"classes":"default"},{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"7c1a516f-3f77-4c80-9021-ae9a61def75b","content":"NO","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Outcome","componentInstanceId":"934dc2c9-8ceb-4c95-9028-84b6a629479e","function":"toggle"},"_auto_id_":"dbe0b83a-ace4-4a7a-935a-5dec433d2853"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"934dc2c9-8ceb-4c95-9028-84b6a629479e","attributes":{},"expressions":{},"actions":[]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"969def8c-6b77-4cbe-a5fc-c5c94926bfeb","attributes":{},"expressions":{}}],"_auto_id_":"28bd24ea-93a2-4a58-b565-eccd5ab9b85b"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"bf92feb7-0674-4b0d-80c6-9337c64c705d","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"debugger;\nif(cti.store.variables.o_activities == undefined || cti.store.variables.o_activities.length == 0) {\n  // Users can submit a DNA outcome with activites, so logic check for that here ...\n  if(cti.store.pages.Outcome.outcome.label.indexOf('DNA') === -1) {\n    cti.utils.callAction(\"show-notification\", {\n      \"name\": \"notification_warning\", \n      \"title\" : \"Warning: No Activites Selected.\", \n      \"text\" : \"You must select at least 1 activity from the Activites drop down list.\"\n    });\n  } else {\n    // ... and trigger the embedded actionflow call if valid\n  \t$success();\n  }\n} else {\n  // Success triggers the embedded actionflow call on this inline function\n  $success();\n}"},"_auto_id_":"1f178f4f-6b31-4bd5-8c5b-7b9711b83ef6","actions":[{"event":"success","type":"call-actionflow","data":{"name":"SubmitOutcome"},"_auto_id_":"9eedc773-1575-4717-9a28-23c6aaeb119c"}]}],"classes":"default"}],"_auto_id_":"c68b7cfa-b3c7-4bbd-806b-f293ed966490","expressions":{}}]},{"start":false,"name":"Wound_Care","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"f1750afd-e9e7-4ad1-a56f-e399cc7a4987","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"8ae226d7-21c2-4496-ac42-cf705407d96c"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Wound Care Assessment</h4>","_auto_id_":"a2792d41-6105-46d8-9c0a-5e1c6226346b"}],"_auto_id_":"899c80d3-7a37-470e-8134-5a38b218beb4","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"8319b7a3-10ca-49c4-83aa-08a63a45798e","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"6281bab0-52a3-4721-a104-ca3461770b03","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"select_wound_location","type":"choice","item-type":"select","_auto_id_":"4445ed77-23d4-4ba1-8c60-8ef91d16d9cf","label":"Where is the wound located?","required":false,"options":[{"label":"Abdomen","value":"Abdomen"},{"label":"Arms","value":"Arms"},{"label":"Back","value":"Back"},{"label":"Feet","value":"Feet"},{"label":"Groin","value":"Groin"},{"label":"Hands","value":"Hands"},{"label":"Head / Neck","value":"Head / Neck"},{"label":"Legs","value":"Legs"},{"label":"Shoulders","value":"Shoulders"},{"label":"Torso","value":"Torso"}],"expressions":{}},{"name":"radio_wound_new","type":"choice","item-type":"radio","_auto_id_":"8fc42263-9b39-4451-bf67-f14b4affd849","label":"Is the wound new?","required":false,"options":[{"label":"Yes","value":"Yes"},{"label":"No","value":"No"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"actions":[]},{"name":"select_wound_type","type":"choice","item-type":"select","_auto_id_":"04eaa08f-e60c-47cb-b62f-b43680a13b2b","label":"Wound Type:","required":false,"options":[{"label":"Burn / Scald","value":"Burn / Scald"},{"label":"Diabetic Foot Ulcer","value":"Diabetic Foot Ulcer"},{"label":"Skin Tear / Laceration","value":"Skin Tear / Laceration"}],"expressions":{},"actions":[]},{"name":"select_skin_condition","type":"choice","item-type":"select","_auto_id_":"b2e27278-faac-4bbe-82b5-b319addbfa85","label":"Condition of surrounding skin:","required":false,"options":[{"label":"Dry / Cracked","value":"Dry / Cracked"},{"label":"Healthy / Intact","value":"Healthy / Intact"},{"label":"Oedematous","value":"Oedematous"},{"label":"Macerated","value":"Macerated"}],"expressions":{},"actions":[]}],"_auto_id_":"2178ba7d-baea-4e26-89c2-160f308da1d4"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"55bd13a2-eaaf-4fe4-a32b-fc724b992d90","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.wound_care = true;\n$success();"},"_auto_id_":"068fa947-2223-468f-8f04-5c9369d2d5bb"},{"event":"click","type":"go-back","data":{},"_auto_id_":"8c47b001-7354-4ea4-80f6-fbb5832377e8"}],"classes":"default"}],"_auto_id_":"558324fb-aca6-448f-a12d-52d48eecb472","expressions":{}}]},{"start":false,"name":"Team_Planner","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"d0f89f6b-a405-4730-bf85-076ce0d00208","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"222d30ac-82a7-46ca-8ab7-f44728f18d7e"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Team Planner</h4>","_auto_id_":"707563f9-7dd4-460d-a6ae-726e102fb88c"}],"_auto_id_":"d34672e4-5581-4347-935c-26626ac655c3","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"5dc4f407-e2f4-4d8c-92da-9a7a978b3476","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"721d54ce-667a-4132-9b8a-3034b01bbdf1","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"select_team","type":"choice","item-type":"select","_auto_id_":"d9110ef6-3efb-41c3-845a-44e064c27986","label":"Team: ","required":true,"options":[],"expressions":{},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.authenticate.profile.userProfile.teams.team","label-property":"value","value-property":"code","actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"var selectedTeam = cti.store.pages.Team_Planner.select_team.value;\n\nfor(var i in cti.store.api.api_rio.teamplannerreferencedata.data) {\n  if(cti.store.api.api_rio.teamplannerreferencedata.data[i].code === selectedTeam) {\n    cti.store.variables.v_teamActivities = cti.store.api.api_rio.teamplannerreferencedata.data[i].activities.activity;\n    break;\n  }\n}\n\nvar referrals = cti.store.variables.selected_visit.patientData.referrals;\nvar referralsList = [];\n\nfor(var i in referrals) {\n  if(referrals[i].team.code === selectedTeam) {\n    var obj = {\n      \"id\" : referrals[i].referralId,\n      \"referrer\" : referrals[i].referrer,\n      \"referralCode\" : referrals[i].referralSource.code,\n      \"referralValue\" : referrals[i].referralSource.value\n    }\n\n    referralsList.push(obj);\n  }\n}\n\ncti.store.variables.referrals = referralsList;\n\nif(cti.store.variables.referrals.length === 0) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: No Referrals Available\", \n    \"text\" : \"There are no Referrals available for the selected team.\"\n  }); \n}\n\ncti.utils.updatePage();"},"_auto_id_":"aa7c37cf-2cb7-477c-a3af-99715f5fcef7"}]},{"name":"select_referral","type":"choice","item-type":"select","_auto_id_":"27c15797-b1b1-40a7-9a62-bb8a85d1b893","label":"Referral:","required":true,"options":[{"label":"Distring Nursing referral","value":"Distring Nursing referral"}],"expressions":{},"classes":"compact silver","validators":[],"option-source":"$store.variables.referrals","label-property":"referralValue","value-property":"id","message":"This is a required field"},{"name":"date_planner","type":"user-input","item-type":"date","_auto_id_":"b44f09df-97b7-4131-8806-16f85a05dff6","label":"Date: ","required":true,"expressions":{},"classes":"compact silver date_icon_left","message":"This is a required field"},{"name":"radio_time","type":"choice","item-type":"radio","_auto_id_":"449c4a2b-3372-4696-889f-4b3938ce5a33","label":"Time: ","required":true,"options":[{"label":"AM","value":"AM"},{"label":"PM","value":"PM"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"classes":"compact silver","message":"This is a required field"},{"name":"button_repeat","type":"button","item-type":"button","_auto_id_":"d34c2afe-2373-4810-b603-56747b35a6cd","content":"{{'$store.variables.selected_visit.repeat == undefined ? \"Repeat: No Repeat\" : $store.variables.selected_visit.repeat'|store}}","theme":"minimal","right-icon":"fa-plus-circle","actions":[{"event":"click","type":"call-component-function","data":{"page":"Team_Planner","componentInstanceId":"a6484396-13a0-4914-b523-f69b985e2650","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"969d0ea9-5b1e-4c4f-ac4b-ed2f8ba017ff"}],"expressions":{},"classes":"compact silver"},{"name":"group_activities","type":"area","item-type":"group","_auto_id_":"12a87f02-b3ae-432a-a191-9c18758c3b47","content":[{"name":"activity","type":"choice","item-type":"select","_auto_id_":"faa7f1a2-3f1f-4d62-a669-2860d6cb920c","label":"Activities: ","required":true,"options":[],"expressions":{},"searchable":true,"validators":[],"actions":[],"message":"This is a required field","option-source":"$store.variables.v_teamActivities","label-property":"value","value-property":"code"}],"repeat":true,"expressions":{}},{"name":"list_activities","type":"content","item-type":"list","_auto_id_":"a486b601-249d-4f89-aaa9-2959148f085a","search":"","classes":"","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.Team_Planner.group_activities.splice( $data.$item.$index, 1);"},"_auto_id_":"17792c9b-65c3-4929-b572-a3a95e2af42e"}],"expressions":{},"model":"$store.repeater.Team_Planner.group_activities","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_activities_html","_auto_id_":"40609651-2cd6-4e69-8950-0eb558d6e80a","content":"<i class=\"fa fa-times-circle-o\"></i> {{$data.$item.activity.label}}","expressions":{}}]},{"name":"comments","type":"user-input","item-type":"text","_auto_id_":"bd01fe18-dc58-432b-835b-4d1ef6748f35","label":"Comments: ","required":true,"multiline":true,"debounce":250,"expressions":{},"message":"This is a required field"},{"name":"popup_repeat_visit","type":"component","item-type":"web-component","content":[{"name":"html_heading","type":"content","item-type":"html","_auto_id_":"0075cfc8-d0ac-4659-9244-8f0482111c02","content":"<h4>Repeat Visit</h4><p>When do you want the visit to repeat?</p>","expressions":{}},{"name":"number_appointments","type":"user-input","item-type":"number","_auto_id_":"fa5e1bdc-b429-4e10-8f9d-a371fe6d2d97","label":"Number of appointments: ","required":false,"decimals":2,"expressions":{},"message":"This is a required field"},{"name":"radio_repeat","type":"choice","item-type":"radio","_auto_id_":"78408653-893b-49c4-9ba1-bc85b1bb1d6c","label":"","required":false,"options":[{"label":"Daily","value":"Daily"},{"label":"Weekly","value":"Weekly"},{"label":"Monthly","value":"Monthly"},{"label":"Yearly","value":"Yearly"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"Daily\""},"validators":[],"classes":""},{"name":"radio_daily","type":"choice","item-type":"radio","_auto_id_":"13996756-5a55-41d2-97e2-1f0cb4c9c6c0","label":"","required":false,"options":[{"label":"Every weekday","value":"Every weekday"},{"label":"Daily every...","value":"Daily every"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Daily\"","default":"\"Every weekday\""}},{"name":"radio_monthly","type":"choice","item-type":"radio","_auto_id_":"eaf12008-4169-493b-bdc8-cb30d8b04a79","label":"","required":false,"options":[{"label":"Day","value":"Day"},{"label":"The","value":"The"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Monthly\"","default":"\"Day\""}},{"name":"radio_yearly","type":"choice","item-type":"radio","_auto_id_":"fe6cbea4-8d78-4b43-a32f-fc1ae8d86b4d","label":"","required":false,"options":[{"label":"Every","value":"Every"},{"label":"The","value":"The"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"Every\"","show":"$store.pages.Team_Planner.radio_repeat === \"Yearly\""}},{"name":"select_daily_interval","type":"choice","item-type":"select","_auto_id_":"64a66abe-8606-4651-b622-357fda892a2b","label":"","required":false,"options":[{"label":"1 day","value":1},{"label":"2 days","value":2},{"label":"3 days","value":3},{"label":"4 days","value":"4"},{"label":"5 days","value":"5"},{"label":"6 days","value":"6"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Daily\" && $store.pages.Team_Planner.radio_daily === \"Daily every\""}},{"name":"select_weekly_interval","type":"choice","item-type":"select","_auto_id_":"23fc1ed7-7cd4-47ae-be1c-7274433b63c6","label":"","required":false,"options":[{"label":"Recur every 1 week on","value":1},{"label":"Recur every 2 weeks on","value":2},{"label":"Recur every 3 weeks on","value":3}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Weekly\"","default":"1"}},{"name":"checkbox_weekly_days","type":"choice","item-type":"checkbox","_auto_id_":"bf592956-222c-4a90-86ff-4033941161f0","label":"","required":false,"options":[{"label":"Monday","id":1},{"label":"Tuesday","id":2},{"label":"Wednesday","id":3},{"label":"Thursday","id":"4"},{"label":"Friday","id":"5"},{"label":"Saturday","id":"6"},{"label":"Sunday","id":"7"}],"icon-selected":"fa-check-square-o","icon-unselected":"fa-square-o","expressions":{"default":"{}","show":"$store.pages.Team_Planner.radio_repeat === \"Weekly\""},"validators":[]},{"name":"select_month_day","type":"choice","item-type":"select","_auto_id_":"7f01e51f-652c-4812-9a28-ae5b5002143a","label":"","required":false,"options":[{"label":"1 of","value":1},{"label":"2 of","value":2},{"label":"3 of","value":3},{"label":"4 of","value":"4"},{"label":"5 of","value":"5"},{"label":"6 of","value":"6"},{"label":"7 of","value":"7"},{"label":"8 of","value":"8"},{"label":"9 of","value":"9"},{"label":"10 of","value":"10"},{"label":"11 of","value":"11"},{"label":"12 of","value":"12"},{"label":"13 of","value":"13"},{"label":"14 of","value":"14"},{"label":"15 of","value":"15"},{"label":"16 of","value":"16"},{"label":"17 of","value":"17"},{"label":"18 of","value":"18"},{"label":"19 of","value":"19"},{"label":"20 of","value":"20"},{"label":"21 of","value":"21"},{"label":"22 of","value":"22"},{"label":"23 of","value":"23"},{"label":"24 of","value":"24"},{"label":"25 of","value":"25"},{"label":"26 of","value":"26"},{"label":"27 of","value":"27"},{"label":"28 of","value":"28"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Monthly\" && $store.pages.Team_Planner.radio_monthly === \"Day\""}},{"name":"select_position","type":"choice","item-type":"select","_auto_id_":"30744e65-894f-48a7-8e00-9be900289f06","label":"","required":false,"options":[{"label":"First","value":"First"},{"label":"Second","value":"Second"},{"label":"Third","value":"Third"},{"label":"Fourth","value":"Fourth"},{"label":"Last","value":"Last"}],"expressions":{"show":"($store.pages.Team_Planner.radio_repeat === \"Monthly\" && $store.pages.Team_Planner.radio_monthly === \"The\") || ($store.pages.Team_Planner.radio_repeat === \"Yearly\" && $store.pages.Team_Planner.radio_yearly === \"The\")"}},{"name":"select_weekday","type":"choice","item-type":"select","_auto_id_":"b71893a0-2d8a-4e9e-b208-c82dfcb80cce","label":"","required":false,"options":[{"label":"Monday of","value":1},{"label":"Tuesday of","value":2},{"label":"Wednesday of","value":3},{"label":"Thursday of","value":"4"},{"label":"Friday of","value":"5"},{"label":"Saturday of","value":"6"},{"label":"Sunday of","value":"7"}],"expressions":{"show":"($store.pages.Team_Planner.radio_repeat === \"Monthly\" && $store.pages.Team_Planner.radio_monthly === \"The\") || ($store.pages.Team_Planner.radio_repeat === \"Yearly\" && $store.pages.Team_Planner.radio_yearly === \"The\")"}},{"name":"select_month_interval","type":"choice","item-type":"select","_auto_id_":"911cbcad-dc9c-401d-b12f-4e2f6907307b","label":"","required":false,"options":[{"label":"every month","value":1},{"label":"every 2 months","value":2},{"label":"every 3 months","value":3},{"label":"every 4 months","value":"4"},{"label":"every 5 months","value":"5"},{"label":"every 6 months","value":"6"},{"label":"every 7 months","value":"7"},{"label":"every 8 months","value":"8"},{"label":"every 9 months","value":"9"},{"label":"every 10 months","value":"10"},{"label":"every 11 months","value":"11"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Monthly\""}},{"name":"select_month","type":"choice","item-type":"select","_auto_id_":"48fc4146-bf5c-444a-bc13-8c8acafde6bc","label":"","required":false,"options":[{"label":"January","value":"1"},{"label":"February","value":2},{"label":"March","value":"3"},{"label":"April","value":"4"},{"label":"May","value":"5"},{"label":"June","value":"6"},{"label":"July","value":"7"},{"label":"August","value":"8"},{"label":"September","value":"9"},{"label":"October","value":"10"},{"label":"November","value":"11"},{"label":"December","value":"12"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Yearly\""}},{"name":"select_year_month_day","type":"choice","item-type":"select","_auto_id_":"171cefa7-e81f-45a0-ad4d-37337c46faa4","label":"","required":false,"options":[{"label":"1st","value":1},{"label":"2nd","value":2},{"label":"3rd","value":3},{"label":"4th","value":"4"},{"label":"5th","value":"5"},{"label":"6th","value":"6"},{"label":"7th","value":"7"},{"label":"8th","value":"8"},{"label":"9th","value":"9"},{"label":"10th","value":"10"},{"label":"11th","value":"11"},{"label":"12th","value":"12"},{"label":"13th","value":"13"},{"label":"14th","value":"14"},{"label":"15th","value":"15"},{"label":"16th","value":"16"},{"label":"17th","value":"17"},{"label":"18th","value":"18"},{"label":"19th","value":"19"},{"label":"20th","value":"20"},{"label":"21st","value":"21"},{"label":"22nd","value":"22"},{"label":"23rd","value":"23"},{"label":"24th","value":"24"},{"label":"25th","value":"25"},{"label":"26th","value":"26"},{"label":"27th","value":"27"},{"label":"28th","value":"28"}],"expressions":{"show":"$store.pages.Team_Planner.radio_repeat === \"Yearly\" && $store.pages.Team_Planner.radio_yearly === \"Every\""}},{"name":"button_bar","type":"area","item-type":"button-bar","_auto_id_":"d066fe0a-0996-420b-9e11-399273b30dd2","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_cancel","type":"button","item-type":"button","_auto_id_":"aae66a09-826d-426a-b65f-ad0b30b174da","content":"CANCEL","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"Team_Planner","componentInstanceId":"a6484396-13a0-4914-b523-f69b985e2650","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"a3494145-38a4-4c88-9178-4a2019aaa331"},{"event":"click","type":"inline-function","data":{"sync":true,"code":"delete cti.store.variables.selected_visit.repeat;"},"_auto_id_":"3343c6ad-505e-43ee-8800-12ed6b92464a"}]},{"name":"button_add","type":"button","item-type":"button","_auto_id_":"79acb490-8350-4439-b9a3-48bf3f972fc8","content":"ADD REPEAT","theme":"default","expressions":{},"classes":"default","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var p = cti.store.pages.Team_Planner;\nvar s = p.radio_repeat + \": \";\nvar validationError = false;\nvar validationErrorMessage = \"\";\n\nif (p.radio_repeat === \"Daily\") {\n  s += p.radio_daily;\n  if (p.radio_daily != undefined) {\n    if (p.radio_daily === \"Daily every\") {\n      if(p.select_daily_interval != undefined) {\n        s += \" \" + p.select_daily_interval.label;\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Daily Interval value.\"\n      }\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Daily Interval type.\"\n  }\n} else if (p.radio_repeat === \"Weekly\") {\n  if(p.select_weekly_interval != undefined) {\n    if(p.checkbox_weekly_days != undefined) {\n      var mon = true, \n          tue = true,\n          wed = true, \n          thu = true,\n          fri = true,\n          sat = true,\n          sun = true;\n\n      s += p.select_weekly_interval.label + \" \";\n\n      if (p.checkbox_weekly_days[1]) {\n        s += \"Monday, \";\n      } else { mon = false; }\n      if (p.checkbox_weekly_days[2]) {\n        s += \"Tuesday, \";\n      } else { tue = false; }\n      if (p.checkbox_weekly_days[3]) {\n        s += \"Wednesday, \";\n      } else { wed = false; }\n      if (p.checkbox_weekly_days[4]) {\n        s += \"Thursday, \";\n      } else { thu = false; }\n      if (p.checkbox_weekly_days[5]) {\n        s += \"Friday, \";\n      } else { fri = false; }\n      if (p.checkbox_weekly_days[6]) {\n        s += \"Saturday, \";\n      } else { sat = false; }\n      if (p.checkbox_weekly_days[7]) {\n        s += \"Sunday, \";\n      } else { sun = false; }\n\n      if(!mon && !tue && !wed && !thu && !fri && !sat && !sun) {\n        validationError = true;\n        validationErrorMessage = \"Please select the days in which you would like the Weekly Interval to occur.\"\n      } else {\n        s = s.substring(0, s.length - 2);\n      }\n    } else {\n      validationError = true;\n      validationErrorMessage = \"Please select the days in which you would like the Weekly Interval to occur.\"\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Weekly Recurring type.\"\n  }\n} else if (p.radio_repeat === \"Monthly\") {\n  if(p.radio_monthly != undefined) {\n  \ts += p.radio_monthly + \" \";\n    \n  \tif(p.radio_monthly === \"Day\") {\n      if(p.select_month_day != undefined) {\n    \ts += p.select_month_day.label + \" \";\n        \n        if(p.select_month_interval != undefined) {\n          s += p.select_month_interval.label + \" \";\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Monthly Interval value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Day in the Month.\"\n      }\n    } else {\n      if(p.select_position != undefined) {\n      \ts += p.select_position.label + \" \";\n        if(p.select_weekday != undefined) {\n          s += p.select_weekday.label + \" \";\n          if(p.select_month_interval != undefined) {\n      \t\ts += p.select_month_interval.label + \" \";\n          } else {\n            validationError = true;\n            validationErrorMessage = \"Please select a Monthly Interval value.\"\n          }\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Day value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Position value.\"\n      }\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Monthly Interval type.\"\n  }\n} else if (p.radio_repeat === \"Yearly\") {\n  if(p.radio_yearly != undefined) {\n  \ts += p.radio_yearly + \" \";\n    \n  \tif(p.radio_yearly === \"Every\") {\n      if(p.select_month != undefined) {\n    \ts += p.select_month.label + \" \";\n        if(p.select_year_month_day != undefined) {\n    \t  s += p.select_year_month_day.label + \" \";\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Year/Month value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Month value.\"\n      }\n    } else {\n      if(p.select_position != undefined) {\n      \ts += p.select_position.label + \" \";\n        if(p.select_weekday != undefined) {\n          s += p.select_weekday.label + \" \";\n          if(p.select_month != undefined) {\n      \t\ts += p.select_month.label + \" \";\n          } else {\n            validationError = true;\n            validationErrorMessage = \"Please select a Month value.\"\n          }\n        } else {\n          validationError = true;\n          validationErrorMessage = \"Please select a Day value.\"\n        }\n      } else {\n        validationError = true;\n        validationErrorMessage = \"Please select a Position value.\"\n      }\n    }\n  } else {\n    validationError = true;\n    validationErrorMessage = \"Please select a Yearly Interval type.\"\n  }\n} else {\n  validationError = true;\n  validationErrorMessage = \"Please select a type of Interval Appointment.\"\n}\n\nif(cti.store.pages.Team_Planner.number_appointments === undefined) {\n  validationError = true;\n  validationErrorMessage = \"Please enter a number of Repeat Appointments.\"\n}\n\nif(validationError) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Validation Error on Team Planner\", \n    \"text\" : validationErrorMessage\n  }); \n} else {\n  cti.store.variables.selected_visit.repeat = s;\n  $success();\n}"},"_auto_id_":"90ca09e2-537e-40e4-802b-1fa119f691e8"},{"event":"click","type":"call-component-function","data":{"page":"Team_Planner","componentInstanceId":"a6484396-13a0-4914-b523-f69b985e2650","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"1a952d46-e3b2-4700-8a71-f670af0da5ab"}]}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"a6484396-13a0-4914-b523-f69b985e2650","attributes":{"id":"popup_repeat_visit"},"expressions":{},"actions":[]}],"_auto_id_":"c56178e8-9fa2-49db-b0fd-a05df5713434"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"d29cf0d6-8d8a-4ce8-a652-4d557e6f6878","content":"SAVE TO TEAM PLANNER","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.repeater.Team_Planner.group_activities.length === 0) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Validation Error on Team Planner\", \n    \"text\" : \"Please select at least 1 valid Activity from the list above.\"\n  }); \n} else {\n  $success();\n}"},"_auto_id_":"51e41175-81c4-4360-9262-37141a35573f"},{"event":"click","type":"call-actionflow","data":{"name":"AddTPAppointment"},"_auto_id_":"f01585b1-8278-420d-b4ab-144a15fbe2f5"}],"classes":"default"}],"_auto_id_":"cd297035-6794-4b13-b0dd-030ec5ad3076","expressions":{}}]},{"start":false,"name":"HCP_Diary","config":[{"name":"Page Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"0796e390-7d76-4413-b7c5-4e6e9cec4b80","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"//Set a default for the switch questions\n\nif(cti.store.pages.HCP_Diary.switch_carer_appointment === undefined){\n  cti.store.pages.HCP_Diary.switch_carer_appointment = false;\n}\n\nif(cti.store.pages.HCP_Diary.switch_proxy_contact === undefined){\n  cti.store.pages.HCP_Diary.switch_proxy_contact = false;\n}\n\nif(cti.store.pages.HCP_Diary.switch_f2f_contact === undefined){\n  cti.store.pages.HCP_Diary.switch_f2f_contact = false;\n}\n\n\nif(cti.store.pages.HCP_Diary.switch_non_client === undefined){\n  cti.store.pages.HCP_Diary.switch_non_client = false;\n}\n\n//Set a default for the duration slider\n\nif(cti.store.pages.HCP_Diary.slider_duration === undefined){\n  cti.store.pages.HCP_Diary.slider_duration = 15;\n}\n\n$success()"},"_auto_id_":"79759872-eda5-458d-900b-4d8ec44f1388","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"e46de49c-ea60-476d-9c9d-3e2fc9da0ab3","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"749c0ada-3a78-4699-a7a1-f364dd6b750a"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>HCP DIARY</h4>","_auto_id_":"414eb33d-be0c-4a45-9816-de509ac6d68b"}],"_auto_id_":"63897979-b131-4154-bb64-61aff683f8ac","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"ffc31e25-e0f8-4403-9959-0d2842910192","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"abb54e77-979f-49f0-846a-e3f7be62d552","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"date_planner","type":"user-input","item-type":"date","_auto_id_":"ec4c4665-1887-4438-9751-a2f3149414b8","label":"Date: ","required":true,"left-icon":"fa-calendar","expressions":{},"classes":"compact silver date_icon_left","message":"This is a required field","validators":[],"actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"if (cti.store.pages.HCP_Diary.date_planner === null) {\n  cti.store.variables.v_availableSlots = null\n  return false\n}\n\n// Get the selected date from the date question and record the selected day of the week\ncti.store.variables.v_selectedAppointmentDate = moment(cti.store.pages.HCP_Diary.date_planner)\n\ncti.store.variables.v_selectedDayOfWeek = cti.store.variables.v_selectedAppointmentDate.day() - 1 // moment defaults to a Sunday start of week, which I disagree with.\n\nvar fourWeeks = moment()\n  .add(4, 'weeks')\n  .format('YYYY-MM-DD')\nvar maxDaysFromNow = moment(fourWeeks).diff(moment(), 'days')\nvar selectedDaysFromNow = cti.store.variables.v_selectedAppointmentDate.diff(moment(), 'days')\n\nif (selectedDaysFromNow < maxDaysFromNow && selectedDaysFromNow >= 0) {\n  cti.store.variables.v_isValidAppointmentDate = true\n} else {\n  cti.store.variables.v_isValidAppointmentDate = false\n  cti.utils.callAction('show-notification', { name: 'notification_error', title: 'Invalid Date Selection', text: 'Appointments cannot be booked for past dates and can only be booked up to 4 weeks from the current date.' })\n  return false;\n}\n\nvar selectedDayBusySlots = cti.store.api.api_rio.busydiaryslots.data.filter(e => {\n  return e.startDateTime.substr(0, 10) === cti.store.variables.v_selectedAppointmentDate.format('YYYY-MM-DD')\n})\n\ncti.store.variables.v_availableSlots = cti.fn_merge_busy_slots(selectedDayBusySlots, cti.store.variables.v_selectedDayOfWeek)\n\n// Check to see if we have any valid slots and warn user if we do\nif(cti.store.variables.v_availableSlots.length === 0) {\n  cti.store.variables.v_isValidAppointmentDate = false\n  cti.utils.callAction('show-notification', { \n    name: 'notification_error', \n    title: 'No Diary Slots Available', \n    text: 'You have selected a date that does not contain any valid Diary slots. Please select an alternative date and try again.' \n  })\n}\n\n// Reset the intended duration value as each time the date changes the time will do also\ncti.store.pages.HCP_Diary.select_intended_duration = undefined;\ncti.store.variables.v_intended_durations = undefined;\n\n// Reset start time as we have a new date value\ncti.store.pages.HCP_Diary.select_start_time = undefined;\n\n$success()"},"_auto_id_":"b4724479-6b3d-4a3c-bda3-a9b9a4ba045e"}]},{"name":"select_start_time","type":"choice","item-type":"select","_auto_id_":"1fe024fe-df36-4258-bbe3-aa23be9b0987","label":"Start Time:","required":true,"options":[],"expressions":{"disabled":"$store.variables.v_isValidAppointmentDate === false || $store.variables.v_isValidAppointmentDate === undefined"},"classes":"compact silver","option-source":"$store.variables.v_availableSlots","label-property":"value","value-property":"code","message":"This is a required field","actions":[{"event":"change","type":"inline-function","data":{"sync":true,"code":"var startTime = cti.store.pages.HCP_Diary.select_start_time.value;\nvar templates = cti.store.variables.v_diary_template;\n\nvar weekday = new Array(7);\nweekday[1]=\"Monday\";\nweekday[2]=\"Tuesday\";\nweekday[3]=\"Wednesday\";\nweekday[4]=\"Thursday\";\nweekday[5]=\"Friday\";\nweekday[6]=\"Saturday\";\nweekday[0]=\"Sunday\";\n\nvar day = weekday[cti.store.variables.v_selectedDayOfWeek];\n\nfor(var i in templates) {\n  if(templates[i].name == day) {\n    var sessions = templates[i].sessions;\n    break;\n  }\n}\n\nfor(var x in sessions) {\n  var sessionStartHours = moment(sessions[x].startTime, 'HH:mm:ss').format('HH');\n  \n  var sessionEndHours = moment(sessions[x].endTime, 'HH:mm:ss').format('HH');\n  var sessionEndMins = moment(sessions[x].endTime, 'HH:mm:ss').format('mm');\n\n  var hours = moment(startTime, 'HH:mm:ss').format('HH');\n  var mins = moment(startTime, 'HH:mm:ss').format('mm');\n\n  if(hours >= sessionStartHours && (hours < sessionEndHours || hours === sessionEndHours && sessionEndMins <= 30)) {\n    var obj = {\n      label: sessions[x].slotLength + ' minutes',\n      value: sessions[x].slotLength\n    };\n    cti.store.variables.v_intended_durations = []\n    cti.store.variables.v_intended_durations.push(obj);\n    break;\n  }\n}\n\nif(cti.store.pages.HCP_Diary.select_intended_duration === undefined) {\n  cti.store.pages.HCP_Diary.select_intended_duration = {\n    code: cti.store.variables.v_intended_duration.label,\n    value: cti.store.variables.v_intended_duration.value\n  }\n}\n\ncti.utils.updatePage();"},"_auto_id_":"4faa6586-9974-4dfa-a4ce-f9333acd15c4"}]},{"name":"select_intended_duration","type":"choice","item-type":"select","_auto_id_":"57ac3028-9122-4191-a269-56069235550f","label":"Duration: ","required":true,"options":[{"label":"Option 1","value":1},{"label":"Option 2","value":2},{"label":"Option 3","value":3}],"message":"This is a required field","expressions":{"disabled":"$store.pages.HCP_Diary.select_start_time === undefined"},"classes":"compact silver","option-source":"$store.variables.v_intended_durations","label-property":"label","value-property":"value","actions":[]},{"name":"select_location","type":"choice","item-type":"select","_auto_id_":"7f5e325d-c5e7-4b90-85c9-e533c7a2aceb","label":"Location:","required":true,"options":[],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.locations.location","label-property":"value","value-property":"code"},{"name":"select_urgency","type":"choice","item-type":"select","_auto_id_":"820223ea-5af0-45b4-a713-fc8165fc16b9","label":"Urgency:","required":true,"options":[],"expressions":{"default":"\"Routine\"","show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.urgencies.urgency","label-property":"value","value-property":"code"},{"name":"select_type","type":"choice","item-type":"select","_auto_id_":"fd529a25-703c-4a55-a5c8-9f89674ece85","label":"Type:","required":true,"options":[],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"validators":[],"classes":"compact silver","message":"This is a required field","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.types.type","label-property":"value","value-property":"code"},{"name":"group_activities","type":"area","item-type":"group","_auto_id_":"29123cd3-d854-4b85-8b30-cb0687e6cf9c","content":[{"name":"activity","type":"choice","item-type":"select","_auto_id_":"098dcae3-f51c-4865-a6d7-a43fb194fadb","label":"Activities: ","required":true,"options":[],"expressions":{},"searchable":true,"validators":[],"actions":[],"message":"This is a required field","option-source":"$store.variables.selected_visit.attendees.attendee.possibleActivities.possibleActivity","label-property":"value","value-property":"code"}],"repeat":true,"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"}},{"name":"list_activities","type":"content","item-type":"list","_auto_id_":"f97601e9-ee34-483f-ad1f-024a65fd1dc2","search":"","classes":"","actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.repeater.HCP_Diary.group_activities.splice( $data.$item.$index, 1);"},"_auto_id_":"f8d1265d-a944-449b-bbb9-320d526218de","actions":[]}],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"},"model":"$store.repeater.HCP_Diary.group_activities","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_activities_html","_auto_id_":"8fb67b88-ac1b-41fb-8dc2-3cfd46e82e05","content":"<i class=\"fa fa-times-circle-o\"></i> {{$data.$item.activity.label}}","expressions":{}}]},{"name":"text_comment","type":"user-input","item-type":"text","_auto_id_":"91982ce5-ef12-431c-9c2e-3fb8143cc28b","label":"Comments: ","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"}},{"name":"button_advanced","type":"button","item-type":"button","_auto_id_":"1055d6ca-a7b0-4706-a5a6-95aab987720e","content":"{{'$store.variables.show_advanced_appt == false ? \"Show Advanced...\" : \"Hide Advanced\"' | store}}","theme":"default","actions":[{"type":"if","data":{},"_auto_id_":"bc9c4786-b2d5-4f33-8113-ef5652a5910e","operations":[{"type":"value","content":"{{$store.variables.show_advanced_appt}}","$selected":false},{"type":"operator","content":"==","$selected":false},{"type":"value","content":"{{true}}","$selected":false}]},{"event":"click","type":"set-variable","data":{"name":"show_advanced_appt","value":"{{false}}"},"_auto_id_":"7979911a-2851-4ee6-b0ec-5c4c892c8a2b"},{"type":"otherwise","data":{},"_auto_id_":"edd0d113-0f3d-4d86-bf14-f08d38163a7c"},{"event":"click","type":"set-variable","data":{"name":"show_advanced_appt","value":"{{true}}"},"_auto_id_":"c976359b-6965-44a4-9420-c9286b6b82c0"},{"type":"end-if","data":{},"_auto_id_":"4534722a-7c81-4e51-8460-bee47d988d3c"}],"expressions":{"show":"$store.pages.HCP_Diary.select_intended_duration != undefined"}},{"name":"group_advanced","type":"area","item-type":"group","_auto_id_":"cce59bce-a4c1-4095-971c-9853a7c3f4e7","content":[{"name":"switch_carer_appointment","type":"choice","item-type":"switch","_auto_id_":"aa366737-95e9-4ac9-afe9-3ef5ba4932f7","label":"Carer appointment:","required":false,"on-text":"YES","off-text":"NO","expressions":{},"classes":"","actions":[]},{"name":"switch_proxy_contact","type":"choice","item-type":"switch","_auto_id_":"bdbf1e50-dfc6-4f6d-98c5-4fdf6ad3e9f9","label":"Proxy Contact:","required":false,"on-text":"YES","off-text":"NO","expressions":{}},{"name":"switch_f2f_contact","type":"choice","item-type":"switch","_auto_id_":"5af96a2a-d8a0-4fa5-a931-9736a9be6f6d","label":"Face to face contact:","required":false,"on-text":"YES","off-text":"NO","expressions":{},"validators":[],"actions":[]},{"name":"switch_non_client","type":"choice","item-type":"switch","_auto_id_":"fd4cd68c-2762-4b15-8e2b-798579502465","label":"Non Client Appointment","required":false,"on-text":"YES","off-text":"NO","expressions":{},"validators":[]},{"name":"contact_comment","type":"user-input","item-type":"text","_auto_id_":"ed14366a-046a-4ea9-93a9-02050eb303ab","label":"Comments for Contact:","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"select_transport_required","type":"choice","item-type":"select","_auto_id_":"fade7e55-9ad1-4a8f-a0c8-c9c1a61d5dad","label":"Transport:","required":false,"options":[],"expressions":{"default":"\"Not Required\""},"validators":[],"classes":"compact","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.transportRequired.transport","label-property":"value","value-property":"code"},{"name":"transport_comment","type":"user-input","item-type":"text","_auto_id_":"c168d5a9-fd6d-4022-9e9e-15cb8882421d","label":"Comments for Transport:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.HCP_Diary.select_transport_required.label !== 'Not Required' && $store.pages.HCP_Diary.select_transport_required !== null && $store.pages.HCP_Diary.select_transport_required !== undefined"}},{"name":"select_interpret_required","type":"choice","item-type":"select","_auto_id_":"50894af2-2dc6-4b64-a1dd-461197f1d4f5","label":"Interpreter:","required":false,"options":[],"expressions":{"default":"\"Not Required\""},"validators":[],"actions":[],"classes":"compact","option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.interpreterRequired.interpreter","label-property":"value","value-property":"code"},{"name":"select_interpret_language","type":"choice","item-type":"select","_auto_id_":"0dcead91-42d6-49a9-a2d1-421758209b8d","label":"Language:","required":false,"options":[],"option-source":"$store.api.api_rio.getbookingrefdata.data.appointmentBookingReferenceData.interpreterLanguages.interpreterLanguage","label-property":"value","value-property":"code","validators":[],"actions":[],"expressions":{"show":"$store.pages.HCP_Diary.select_interpret_required.label !== \"Not Required\" && $store.pages.HCP_Diary.select_interpret_required !== null && $store.pages.HCP_Diary.select_interpret_required !== undefined"},"classes":"compact"},{"name":"interpreter_comment","type":"user-input","item-type":"text","_auto_id_":"0d624bc6-7dd2-4583-bb93-35b3e325af15","label":"Comments for Interpreter:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.HCP_Diary.select_interpret_required.label !== \"Not Required\" && $store.pages.HCP_Diary.select_interpret_required !== null && $store.pages.HCP_Diary.select_interpret_required !== undefined"}}],"repeat":false,"expressions":{"show":"$store.variables.show_advanced_appt"}}],"_auto_id_":"c6133f8c-6bc5-49d7-b81e-bbd9411b4ab9"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"2a01b0b5-af5f-4a05-8a63-b41ec2051d0f","content":"SAVE TO HCP DIARY","theme":"default","expressions":{"disabled":"$form.invalid || $store.repeater.HCP_Diary == undefined || $store.repeater.HCP_Diary.group_activities == undefined || $store.repeater.HCP_Diary.group_activities.length == 0"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.v_appointmentToAdd_clear = true\n$success();"},"_auto_id_":"91023662-d736-4d28-8413-af9801f0693c"},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"ac2bfbcb-cd49-4ca2-bdd2-8320b8f6897a"}],"classes":"default"}],"_auto_id_":"4d751443-d3d0-4883-a9ee-332ccc895bbc","expressions":{}}]},{"start":false,"name":"Document","config":[{"name":"Page Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"91062a97-05ac-49c4-b7ef-afd3501891f5","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"var userAssetLocation = cti.store.schema.assetDir || 'user-assets/';\nvar base64Data = \"data:\" + cti.store.variables.v_selectedDocument.fileType + \";base64,\" + cti.store.variables.v_selectedDocument.base64;\n\n// Check fileType of document...\nif(cti.store.variables.v_selectedDocument.fileType == \"image/jpeg\") {\n  // ... if type of jpeg process under the embed tag\n  // Grab the page div element for display\n  var imageDiv = document.getElementById('image');\n  imageDiv.classList.add(\"doc-image-class\");\n\n  var img = document.createElement('img');\n  img.id = \"embed-doc\";\n  img.style.width = \"100%\"\n  img.style.height = \"100%\"\n  img.src = base64Data;\n  img.type = cti.store.variables.v_selectedDocument.fileType;\n  imageDiv.appendChild(img);\n  \n} else if(cti.store.variables.v_selectedDocument.fileType == \"application/pdf\") {\n  var pdfDiv = document.getElementById('pdf');\n  pdfDiv.classList.add(\"doc-image-class\");\n  \n  base64Data = base64Data.replace(/^[^,]+,/, '');\n  var pdfData = atob(base64Data);\n\n  PDFJS.workerSrc = userAssetLocation+'pdf.worker.js'\n  \n  var loadingTask = PDFJS.getDocument({data: pdfData});\n  loadingTask.promise.then(function(pdf) {\n    console.log('PDF loaded');\n    \n    var pageNumber = 1;\n    pdf.getPage(pageNumber).then(function(page) {\n      console.log('Page loaded');\n      \n      // Customised viewport setting\n      var desiredWidth = screen.width - 20;\n      var viewport = page.getViewport(1);\n      var scale = desiredWidth / viewport.width;\n      var scaledViewport = page.getViewport(scale);\n\n      // Prepare canvas using PDF page dimensions\n      var canvas = document.getElementById('the-canvas');\n      var context = canvas.getContext('2d');\n      canvas.height = scaledViewport.height;\n      canvas.width = scaledViewport.width;\n\n      // Render PDF page into canvas context\n      var renderContext = {\n        canvasContext: context,\n        viewport: scaledViewport\n      };\n      var renderTask = page.render(renderContext);\n      renderTask.then(function () {\n        console.log('Page rendered');\n      });\n    });\n  }, function (reason) {\n    // PDF loading error\n    console.error(reason);\n  });\n}\n\ncti.utils.updatePage();\n$success()"},"_auto_id_":"2255c66d-69d1-4f42-a198-87595f970bbc"}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"6ea69e86-a655-4e4f-add6-0ec2b428552e","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.v_selectedDocument.fileType == \"application/pdf\") {\n  var canvas = document.getElementById('the-canvas');\n  var context = canvas.getContext('2d');\n  context.clearRect(0, 0, canvas.width, canvas.height);\n} else if(cti.store.variables.v_selectedDocument.fileType == \"image/jpeg\") {\n  var imageDiv = document.getElementById('image');\n  var embed = document.getElementById('embed-doc');\n  \n  if(embed != null) {\n    imageDiv.removeChild(embed);\n  }\n}\n\ndelete cti.store.variables.v_selectedDocument;\ndelete cti.store.variables.v_documentGetPayload;\n\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"});"},"_auto_id_":"df0f1085-9cdc-46a2-816d-04444f992339"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Document Display</h4>","_auto_id_":"39f47d4d-1c7b-4f68-bc0a-95cd7a6bfc4e"}],"_auto_id_":"ef48c7c0-14ce-4d25-9167-727ecd297244"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"79a2680a-94a6-4c5b-989f-7ca610d96f22","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"dee23685-9558-46c5-975b-44bb7a5b105a","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_pdf_area","type":"content","item-type":"html","_auto_id_":"aa2d1039-c696-4a54-9867-8fa69caa5f8a","content":"<div id=\"pdf\">\n  <canvas id=\"the-canvas\"></canvas>\n</div>","expressions":{"show":"$store.variables.v_selectedDocument.fileType == \"application/pdf\""}},{"name":"html_image_area","type":"content","item-type":"html","_auto_id_":"4745da57-c104-4470-85dc-1af1ca810a81","content":"<div id=\"image\"></div>","expressions":{"show":"$store.variables.v_selectedDocument.fileType == \"image/jpeg\""}}],"_auto_id_":"e80131df-c65a-44f3-ac50-78ca4d645b81"}]},{"start":false,"name":"Enter_PIN","config":[],"content":[{"name":"header","type":"area","item-type":"static","_auto_id_":"9464c549-196e-4755-909d-053346e36dd7","content":[{"name":"html_splash","type":"content","item-type":"html","_auto_id_":"5bb67f4c-a423-4270-9de7-9f140c22ca83","content":"<div class=\"header\">\n  <div class=\"logo\"/>\n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_instructions","type":"content","item-type":"html","_auto_id_":"96c2a1d5-5c2b-41ca-80c2-0f2db09dad12","content":"<div class=\"splash\">\n  <div class=\"riologo\"/>\n</div>\n<h3>Enter App Pin</h3>\n<h5>Please enter your app PIN below</h5>","expressions":{}},{"name":"group_login","type":"area","item-type":"group","_auto_id_":"9d696345-8cf6-462d-ae3e-526bb53b3abf","content":[{"name":"pwdUserPIN","type":"user-input","item-type":"password","_auto_id_":"175e85e9-f629-40c1-b432-999dde3c857c","label":"","required":false,"message":"This is a required field","expressions":{},"placeholder":"Enter your app PIN","actions":[],"validators":[],"classes":"minimal"},{"name":"button_submit_pin","type":"button","item-type":"button","_auto_id_":"e5cd7fbe-6b75-41f9-a786-f474d8907da6","content":"Enter Pin","theme":"minimal","expressions":{"disabled":"$store.pages.Enter_PIN.pwdUserPIN === undefined || $store.pages.Enter_PIN.pwdUserPIN === \"\""},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.pages.Enter_PIN.pwdUserPIN == cti.store.variables.v_userPIN){\n  cti.store.pages.Enter_PIN.pwdUserPIN = \"\";\n  //cti.utils.callAction(\"go-to-page\", {\"name\" : \"Visits\"});\n  cti.store.variables.pin_login = true\n  cti.fn_toggle_spinner('open', 'Fetching Appointments, please wait...')\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetVisitList\" });\n}else{\n  cti.store.pages.Enter_PIN.pwdUserPIN = \"\";\n  cti.store.variables.v_pinAttempts = cti.store.variables.v_pinAttempts + 1;\n\n  if(cti.store.variables.v_pinAttempts >= 3){\n    delete cti.store.variables.v_userPIN;\n    delete cti.store.variables.v_isAuthenticated;\n    cti.store.variables.v_pinAttempts = 0; \n    cti.store.pages.Login.password = \"\";\n    cti.utils.callAction(\"go-to-page\", {\"name\" : \"Login\"});\n  }\n}"},"_auto_id_":"aa2149ec-a8cb-4cc7-a595-9a3448b2dbbb"}],"classes":"default"},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"2d5e8e92-2c5a-4788-bbe8-652b26531d85","attributes":{},"expressions":{}}],"repeat":false,"expressions":{}}],"_auto_id_":"2773108f-bfd8-42ae-aafe-20fd771e60e9"}]},{"start":false,"name":"Set_PIN","config":[],"content":[{"name":"header","type":"area","item-type":"static","_auto_id_":"b1b736a7-4de4-4294-9dfb-b073f331c718","content":[{"name":"html_splash","type":"content","item-type":"html","_auto_id_":"9a9f552f-09f5-452f-92d2-58d9d7d11b71","content":"<div class=\"header\">\n  <div class=\"logo\"/>\n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable","type":"area","item-type":"scrollable","content":[{"name":"html_instructions","type":"content","item-type":"html","_auto_id_":"62697f54-a4ae-48b7-93b8-0ca17c4473d9","content":"<div class=\"splash\">\n  <div class=\"riologo\"/>\n</div>\n<h3>Set App Pin</h3>\n<h5>Set a PIN code for this app below</h5>","expressions":{}},{"name":"group_login","type":"area","item-type":"group","_auto_id_":"6c155373-9bcd-4d1d-bf38-5249d78e2d43","content":[{"name":"txtPIN","type":"user-input","item-type":"text","_auto_id_":"b67fd058-2955-4fb7-a7e3-a50f9d4eae4e","label":"","required":false,"multiline":false,"debounce":250,"expressions":{},"validators":[],"actions":[],"classes":"minimal"},{"name":"button_set_pin","type":"button","item-type":"button","_auto_id_":"db5bf87b-fd89-47f2-b8d5-9c3e417bd5e7","content":"Set Pin","theme":"minimal","expressions":{"disabled":"$store.pages.Set_PIN.txtPIN === undefined"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.pages.Set_PIN.txtPIN != \"\"){\n    cti.store.variables.v_userPIN = cti.store.pages.Set_PIN.txtPIN;\n    cti.store.pages.Set_PIN.txtPIN = \"\";\n    \n    cti.store.variables.v_pinAttempts = 0;\n    \n    $success();\n}"},"_auto_id_":"17233199-44e8-4745-81a4-ba194a920062","actions":[]},{"event":"click","type":"go-to-page","data":{"name":"Visits","isConditional":false},"_auto_id_":"f0f60487-fba2-405e-85fd-1e93de1ad3f8"}],"classes":"default"}],"repeat":false,"expressions":{}}],"_auto_id_":"ec836e81-9291-4beb-bc57-26ebe2f31adb"}]},{"start":false,"name":"RemoveAlert","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"ee2d7609-4df1-4b58-86af-25d67b5b8d8e","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"RemoveAlert","componentInstanceId":"e7fa22a5-a954-4f24-9001-44e2be773bfb","function":"toggle"},"_auto_id_":"2a12690b-7f17-4b72-9f0e-d591b5c46726"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Remove Alert</h4>","_auto_id_":"40d763ce-8915-4d04-8ef2-ae9b18db581f"}],"_auto_id_":"7e576a4c-d9a9-4bee-8cfc-68aa99ae95c1"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"69d4943d-2475-4c13-be88-b959b1dbfbaa","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"17cba1a3-ff9b-4425-ba97-cce5d4566d67","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable_results","type":"area","item-type":"scrollable","content":[{"name":"list_alerts","type":"content","item-type":"list","_auto_id_":"32056676-01de-4ce5-b64e-02f85d1bc957","search":"","classes":"","expressions":{},"model":"$store.variables.alerts","dataSource":"dynamic","data":"[]","listItemClasses":"","content":[{"type":"content","item-type":"html","name":"list_alerts_html","_auto_id_":"24f2a90c-afe2-455e-a6fb-0cd33b3688d2","content":"<!-- HTML Template for tablet size devices and above -->\n<div class=\"row hidden-xs hidden-top-row\">   \n  <div class=\"floatLeft\">\n    <strong>Date:</strong> <span class=\"highlight\">{{$data.$item.date | date:'yyyy-MM-dd HH:mm'}}</span>\n  </div>\n  <div class=\"floatRight\">\n    <strong>Priority:</strong> {{$data.$item.priority.value }}\n  </div>\n</div>\n<div class=\"row hidden-xs hidden-middle-row\">   \n  <div class=\"floatLeft\">\n    <strong>Type:</strong> {{$data.$item.type.value}}\t\n  </div>\n  <div class=\"floatRight\">\n    <strong>Ended:</strong> {{$data.$item.removalDate == undefined ? \"No\" : \"Yes\"}}\t\n  </div>\n</div>\n<div class=\"row hidden-xs hidden-middle-row {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n  <div class=\"floatLeft\">\n    <strong>Removal Date:</strong> {{$data.$item.date | date:mediumDate}}\n  </div>\n  <div class=\"floatRight\">\n    <strong>Removal Comment:</strong> {{$data.$item.removalComment == \"\" ? \"No Comment\" : $data.$item.removalComment}}\t\n  </div>\n</div>\n<div class=\"row hidden-xs hidden-bottom-row\">   \n  <div class=\"floatLeft\">\n    {{$data.$item.text}}\n  </div>\n</div>\n\n<!-- HTML Template for smaller mobile devices -->\n<div class=\"row visible-xs visible-top-row\">   \n  <div class=\"floatLeft\">\n    <strong>Date:</strong> <span class=\"highlight\">{{$data.$item.date | date:'yyyy-MM-dd HH:mm'}}</span>\n  </div>\n  <div class=\"floatRight\">\n    <strong>Priority:</strong> {{$data.$item.priority.value }}\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row\">   \n  <div class=\"floatLeft\">\n    <strong>Type:</strong> {{$data.$item.type.value}}\t\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row\">   \n  <div class=\"floatLeft\">\n    <strong>Ended:</strong> {{$data.$item.removalDate == undefined ? \"No\" : \"Yes\"}}\t\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n  <div class=\"floatLeft\">\n    <strong>Removal Date:</strong> {{$data.$item.date | date:mediumDate}}\n  </div>\n</div>\n<div class=\"row visible-xs visible-middle-row {{$data.$item.removalDate == undefined ? 'display-none' : 'Yes'}}\">   \n  <div class=\"floatLeft\">\n    <strong>Removal Comment:</strong> {{$data.$item.removalComment == \"\" ? \"No Comment\" : $data.$item.removalComment}}\t\n  </div>\n</div>\n<div class=\"row visible-xs visible-bottom-row\">   \n  <div class=\"floatLeft\">\n    {{$data.$item.text}}\n  </div>\n</div>","expressions":{"show":"$store.variables.selected_visit.patientData.displayAlerts.length > 0"}}],"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.alertToRemove) {\n  var visibleString = 'alertRowVisible-' + cti.store.variables.alertToRemove.id;\n  var hiddenString = 'alertRowHidden-' + cti.store.variables.alertToRemove.id;\n\n  var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  if(visible == null) {\n    delete cti.store.variables.alertToRemove;\n    return false;\n  }\n  if(hidden == null) {\n    delete cti.store.variables.alertToRemove;\n    return false;\n  }\n\n  visible.classList.remove('selected');\n  hidden.classList.remove('selected');\n  \n  if($data.$item.id != cti.store.variables.alertToRemove.id) {\n    cti.store.variables.alertToRemove = $data.$item;\n\n    var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n    var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n    var visible = document.getElementById(visibleString);\n    var hidden = document.getElementById(hiddenString);\n\n    visible.classList.add('selected');\n    hidden.classList.add('selected');\n  } else {\n    delete cti.store.variables.alertToRemove;\n  }\n} else {\n  debugger;\n  cti.store.variables.alertToRemove = $data.$item;\n\n  var visibleString = 'alertRowVisible-' + {{$data.$item.id}};\n  var hiddenString = 'alertRowHidden-' + {{$data.$item.id}};\n\n  var visible = document.getElementById(visibleString);\n  var hidden = document.getElementById(hiddenString);\n\n  visible.classList.add('selected');\n  hidden.classList.add('selected');\n}\n\ncti.utils.updatePage();"},"_auto_id_":"3f279233-c78a-4c4c-8871-432771f6bfae"}]}],"_auto_id_":"e88b14df-d716-44bf-ac0d-716c8e0dcccf","expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"77818705-adf6-4fa1-a65a-3785927a523f","content":[{"name":"date","type":"user-input","item-type":"date","_auto_id_":"34a9c373-2012-44aa-b5ea-f0da85e88ec4","label":"End Date: ","required":true,"left-icon":"fa-calendar","expressions":{},"message":"This is a required field","validators":[]},{"name":"description","type":"user-input","item-type":"text","_auto_id_":"91de92e7-4531-4cec-882d-395d5fa371e6","label":"Comment:","required":true,"multiline":true,"debounce":250,"message":"This is a required field","expressions":{},"maxlength":500,"validators":[]},{"name":"popupBack","type":"component","item-type":"web-component","content":[{"name":"html_warning","type":"content","item-type":"html","_auto_id_":"f634de34-4a62-4105-9f22-63b8149450bf","content":"<h2>Cancel Alert Removal</h2>\n<p>You are about to cancel the Alert Removal for this Alert. Any information entered on this page will be cleared down.</p>\n<p>Are you sure you want to continue? </p>","expressions":{}},{"name":"button_bar_mobile","type":"area","item-type":"button-bar","_auto_id_":"d72f0b67-951e-40e6-83ef-28201c80a0de","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_add_note","type":"button","item-type":"button","_auto_id_":"554d55db-7d4e-466d-9996-5907b55b14c6","content":"BACK","theme":"default","expressions":{},"actions":[{"event":"click","type":"call-component-function","data":{"page":"RemoveAlert","componentInstanceId":"e7fa22a5-a954-4f24-9001-44e2be773bfb","function":"toggle"},"_auto_id_":"e4ef41d2-5def-46ab-b553-02c526662755"}]},{"name":"button_end_visit_1","type":"button","item-type":"button","_auto_id_":"27d9b7ac-2c2e-4f38-b170-db4b747155d4","content":"CANCEL ALERT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.v_alertToRemove_clear = true;\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"});\n$success();"},"_auto_id_":"62ec4d93-ee85-42de-81ec-1f76b32bdfb6"},{"event":"click","type":"call-component-function","data":{"page":"RemoveAlert","componentInstanceId":"e7fa22a5-a954-4f24-9001-44e2be773bfb","function":"toggle"},"_auto_id_":"31fc3747-52a2-42c2-acd1-cd31315f41de"}],"classes":"default"}],"expressions":{}}],"componentId":"606531b4-9a85-4f06-b7ce-52e3902da20a","_auto_id_":"e7fa22a5-a954-4f24-9001-44e2be773bfb","attributes":{},"expressions":{}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"0d4dead3-fdd3-4b55-a095-01e3d96b9f3f","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"if(cti.store.variables.alertToRemove) {\n  var createdDate = moment(cti.store.variables.alertToRemove.date).format(\"YYYY-MM-DD\");\n  var removeDate = moment(cti.store.pages.RemoveAlert.date).format(\"YYYY-MM-DD\");\n  if(createdDate > removeDate) {\n      cti.utils.callAction(\n        \"show-notification\", {\n          \"name\": \"notification_warning\",\n          \"title\": \"Incorrect Date Entered\",\n          \"text\": \"Please select an End Date that is not older than the Alert's created date.\"\n        }\n      );\n  } else {\n    // Calls embedded CallActionFlow attached to this inline-function\n    delete cti.store.variables.alerts;\n    cti.store.variables.alertSent = true;\n    $success();\n  }\n} else {\n  cti.utils.callAction(\n    \"show-notification\", {\n      \"name\": \"notification_warning\",\n      \"title\": \"No Alert Selected\",\n      \"text\": \"Please select the Alert you wish to remove from the list above.\"\n    }\n  );\n}"},"_auto_id_":"7ec838b7-0288-47a3-8571-75755a6a74b6","actions":[{"event":"success","type":"call-actionflow","data":{"name":"RemoveAlert"},"_auto_id_":"451aa864-21e9-40a7-a77d-b08d88d6152b"}]}],"classes":"default"},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"a5effb9b-1fa7-48a0-97be-2f2e784a06b1","attributes":{},"expressions":{}}],"_auto_id_":"bf77a799-9db0-4319-b305-0f12d4a658f4","expressions":{}}]},{"start":false,"name":"DialogForm","config":[{"name":"Page Loaded Event","type":"event","item-type":"onloaded","_auto_id_":"5cbe6a00-87bb-4969-9215-21c5dbbb145d","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"console.log('DialogForm On-Loaded Event hit')\n//var accordionItems = new Array();\n//Grab page items we want in the accordian\n/*var elems = document.getElementsByClassName('accord')*/\n// Hide them all\n/*for (var i = 0; i <elems.length; i++) {\n  elems[i].classList.add('hideme');\n}*/\n//debugger;\n$success()"},"_auto_id_":"4fa5cbde-28a1-44c9-b063-a7707da55077","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"d2c7b9cd-3113-4a14-8513-e0ea58e5c41c","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"2f7bea81-864b-4e44-87da-a535ebd44ad8"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"925d692c-133e-4e49-84b7-6cd08dff1101"}],"_auto_id_":"ceb144a6-e675-41e5-844b-5ecc54ec20ea","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"213b8241-adb7-4dc7-99c4-ffcd0e061b95","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"8de7d314-3090-4fbb-b740-f41492741f35","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"61b8fbe4-ee65-4fe4-8883-cf758348416b","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"f546eadf-2d83-4c68-baa5-2a292a51aec9","content":[{"name":"mentalHealthTitle","type":"content","item-type":"html","_auto_id_":"7729b82b-33c9-44ca-b282-c46431d2260a","content":"<h2>Mental health</h2>\n<div class=\"rio_slider\" id=\"DialogMentalHealthSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"mentalHealthGroup","type":"area","item-type":"group","_auto_id_":"d9833b9b-e1c2-4e6e-be31-cefd3dfb377a","content":[{"name":"MHSat1","type":"choice","item-type":"slider","_auto_id_":"8a884d70-6bac-475e-bf5c-05bd161cf120","label":"How satisfied are you with your mental health? ","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"message":"This is a required field","validators":[],"actions":[],"expressions":{}},{"name":"MHSatHelp","type":"choice","item-type":"radio","_auto_id_":"ad87e982-8b13-4679-9955-e440ca4b4b5b","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"actions":[],"validators":[]},{"name":"MHSatActions","type":"user-input","item-type":"text","_auto_id_":"8ef977a3-c64a-4621-9dee-ac9a501f9ded","label":"Mental health goals and actions:","required":false,"multiline":true,"debounce":250,"validators":[],"actions":[],"expressions":{"show":"$store.pages.DialogForm.MHSatHelp == '1'"},"placeholder":""}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"physicalHealthTitle","type":"content","item-type":"html","_auto_id_":"3ce64613-78cb-4690-970a-75c33738a406","content":"<h2>Physical health</h2>\n<div class=\"rio_slider\" id=\"DialogPhysicalHealthSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"physicalHealthGroup","type":"area","item-type":"group","_auto_id_":"3908afc0-fdcc-4d20-b65e-f475ffbcf6c3","content":[{"name":"PHSatPL","type":"choice","item-type":"slider","_auto_id_":"7e730a0a-2402-46da-8f19-368a0ae6a9f3","label":"How satisfied are you with your physical health?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"PHSatHelp","type":"choice","item-type":"radio","_auto_id_":"9880d6a3-04b1-49fc-964f-b2eba61fbe8d","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"PHSatActions","type":"user-input","item-type":"text","_auto_id_":"1fb7d239-c620-40b7-a840-6b500ad8779f","label":"Physical health goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.PHSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"jobSituationTitle","type":"content","item-type":"html","_auto_id_":"0fcf6423-c95b-4727-b2f6-2d504220ce4d","content":"<h2>Job situation</h2>\n<div class=\"rio_slider\" id=\"jobSituationSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"jobSituationGroup","type":"area","item-type":"group","_auto_id_":"db49bdc1-49b0-42e8-bfda-f79b6d5c66ea","content":[{"name":"JSSatPL","type":"choice","item-type":"slider","_auto_id_":"2e04b895-39d1-4de0-9a0a-f821c486893f","label":"How satisfied are you with your job situation?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"JSSatHelp","type":"choice","item-type":"radio","_auto_id_":"b67b2856-ce5e-4225-8fe9-937c04f741aa","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[]},{"name":"JSSatActions","type":"user-input","item-type":"text","_auto_id_":"36443384-0ffc-425f-adc9-cab8e7e249b3","label":"Job situation goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.JSSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"accommodationTitle","type":"content","item-type":"html","_auto_id_":"cb8f9c2d-3c47-4220-ad2b-7b13663f6dc0","content":"<h2>Accommodation</h2>\n<div class=\"rio_slider\" id=\"accommodationSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"accommodationGroup","type":"area","item-type":"group","_auto_id_":"6f7f9936-debe-437d-9114-e6b16da4ac62","content":[{"name":"ACSatPL","type":"choice","item-type":"slider","_auto_id_":"d810da54-0c96-4003-986f-af6c42f43f8b","label":"How satisfied are you with your accommodation?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"ACSatHelp","type":"choice","item-type":"radio","_auto_id_":"aca4ab46-928d-4192-930e-142f2d872b24","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"ACSatActions","type":"user-input","item-type":"text","_auto_id_":"1cff6ccd-935b-4353-985b-7919731bbecc","label":"Accomodation goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.ACSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"leisureActivitiesTitle","type":"content","item-type":"html","_auto_id_":"32d871cc-3e4f-4f08-bed7-45ea4b588065","content":"<h2>Leisure activities</h2>\n<div class=\"rio_slider\" id=\"leisureActivitiesSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"leisureActivitiesGroup","type":"area","item-type":"group","_auto_id_":"2686ddc2-cdbd-4108-86f4-3b8e33e6f74e","content":[{"name":"LASatPL","type":"choice","item-type":"slider","_auto_id_":"633f0a33-0cc1-4174-980a-f4e21c65358f","label":"How satisfied are you with your leisure activities?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"LASatHelp","type":"choice","item-type":"radio","_auto_id_":"cb0d0878-8f94-4a11-ae52-739e939e5fc1","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"LASatActions","type":"user-input","item-type":"text","_auto_id_":"00299002-9ec3-4fd9-ba78-5b61d615976f","label":"Leisure activity goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.LASatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"partnerFamilyTitle","type":"content","item-type":"html","_auto_id_":"84143bda-614d-4421-9eb6-ed28e55abe9c","content":"<h2>Partner / family</h2>\n<div class=\"rio_slider\" id=\"partnerFamilySummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"partnerFamilyGroup","type":"area","item-type":"group","_auto_id_":"83b820ce-43fb-415b-8830-1a396da5f67f","content":[{"name":"RSSatPL","type":"choice","item-type":"slider","_auto_id_":"515e707b-e412-479b-ad6c-0fb89e9764c7","label":"How satisfied are you with your relationship with your partner / family?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"RSSatHelp","type":"choice","item-type":"radio","_auto_id_":"b5081810-f34b-4abf-9d6b-f09e849fedda","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"RSSatActions","type":"user-input","item-type":"text","_auto_id_":"1f90392a-123d-4241-8981-503f0bbb9936","label":"Relationship with partner/family goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.RSSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"friendshipsTitle","type":"content","item-type":"html","_auto_id_":"06ec2143-90bd-4bc6-a4ac-70fabde61a3e","content":"<h2>Friendships</h2>\n<div class=\"rio_slider\" id=\"friendshipsSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"friendshipsGroup","type":"area","item-type":"group","_auto_id_":"eb611866-ab52-4a31-9dab-fcc0751f8521","content":[{"name":"FSSatPL","type":"choice","item-type":"slider","_auto_id_":"9d06030b-cbfa-487e-9568-862d60684aa5","label":"How satisfied are you with your friendships?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"FSSatHelp","type":"choice","item-type":"radio","_auto_id_":"8c4410cb-6306-405f-8a68-ee9684f32fcf","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"FSSatActions","type":"user-input","item-type":"text","_auto_id_":"690ca610-e4fc-4935-bc0d-2c6a9d4c7d42","label":"Friendship goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.FSSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"personalSafetyTitle","type":"content","item-type":"html","_auto_id_":"1b5202c3-2361-4c5a-a378-f3889f059c91","content":"<h2>Personal safety</h2>\n<div class=\"rio_slider\" id=\"personalSafetySummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"personalSafetyGroup","type":"area","item-type":"group","_auto_id_":"27a3b1d8-11fd-471b-a0a7-6b2f2de59afb","content":[{"name":"PSSatPL","type":"choice","item-type":"slider","_auto_id_":"cd797c62-13d9-46d8-9ec1-ecbc89bbdd3c","label":"How satisfied are you with your personal safety?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"PSSatHelp","type":"choice","item-type":"radio","_auto_id_":"78a04f86-4b0e-42c2-91d3-50a74d1ef953","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"PSSatActions","type":"user-input","item-type":"text","_auto_id_":"8324c9b9-77c7-4e4e-8b1d-7e6822fed2c6","label":"Personal safety goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.PSSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"financesGroup","type":"area","item-type":"group","_auto_id_":"96a65de2-ad66-4009-8e41-8c611af108ea","content":[{"name":"financesTitle","type":"content","item-type":"html","_auto_id_":"c01e0071-1700-45f5-b036-2706ee15471e","content":"<h2>Finances</h2>\n<div class=\"rio_slider\" id=\"financesSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"FISatPL","type":"choice","item-type":"slider","_auto_id_":"228e9d37-53dd-4cbb-b02f-cca2ff6b2ed8","label":"How satisfied are you with your finances?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"FISatHelp","type":"choice","item-type":"radio","_auto_id_":"98ee2975-6e99-4e69-b5b2-aa49e0fc5dfc","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"FISatActions","type":"user-input","item-type":"text","_auto_id_":"a3b99795-1364-4fe4-906d-27c6c14541e6","label":"Finance goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.FISatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"identityTitle","type":"content","item-type":"html","_auto_id_":"8d7b1ebc-e4ab-4996-a599-5fecaf7b02db","content":"<h2>Identity</h2>\n<div class=\"rio_slider\" id=\"identitySummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"identityGroup","type":"area","item-type":"group","_auto_id_":"504e7a35-db92-475e-94a3-a70916ec99f6","content":[{"name":"CNSatPL","type":"choice","item-type":"slider","_auto_id_":"daf7137d-6f36-4260-94a7-7997f4eecc39","label":"How satisfied are you with your expression of identitiy?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"CNSatHelp","type":"choice","item-type":"radio","_auto_id_":"8a4c7862-4ffe-4e8e-a0ea-15cd2eb0d9cb","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"CNSatActions","type":"user-input","item-type":"text","_auto_id_":"053a91c3-b34d-4bef-900a-54f112318860","label":"Identity goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.CNSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"substanceAlcoholGroup","type":"area","item-type":"group","_auto_id_":"f6515537-f847-4e06-8baf-6c01e0ed74c0","content":[{"name":"substanceAlcoholTitle","type":"content","item-type":"html","_auto_id_":"8163acbd-052e-4bee-9b4f-2d5f427ea652","content":"<h2>Substance / alcohol</h2>\n<div class=\"rio_slider\" id=\"substanceAlcoholSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"SUSatPL","type":"choice","item-type":"slider","_auto_id_":"0ae1cd75-5a6e-4925-ad72-3c07f06bf428","label":"How satisfied are you with your alcohol / substance use?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"SUSatHelp","type":"choice","item-type":"radio","_auto_id_":"105b9290-e748-477d-8fee-14256c0c962f","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"SUSatActions","type":"user-input","item-type":"text","_auto_id_":"8e83524e-fa58-46ff-aec0-8fc6596fe225","label":"Substance/alcohol goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.SUSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"medicationTitle","type":"content","item-type":"html","_auto_id_":"351e860e-aa22-411c-af84-48c49d64f5ba","content":"<h2>Medication</h2>\n<div class=\"rio_slider\" id=\"medicationSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"medicationGroup","type":"area","item-type":"group","_auto_id_":"4f8419cc-f899-467e-969c-6f7cfb40c145","content":[{"name":"MDSatPL","type":"choice","item-type":"slider","_auto_id_":"d5089ae3-2c03-43c1-9a78-abadadf66a5a","label":"How satisfied are you with your medication?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"MDSatHelp","type":"choice","item-type":"radio","_auto_id_":"df22a37d-c6c0-4426-8ae9-3cf65aa8f93c","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"MDSatActions","type":"user-input","item-type":"text","_auto_id_":"c2e4c15e-d5f8-4b99-b2da-bf94e0c8f33f","label":"Medication goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.MDSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"practicalHelpTitle","type":"content","item-type":"html","_auto_id_":"127cdb5e-8ef4-4985-86e0-893f3e907a2a","content":"<h2>Practical Help</h2>\n<div class=\"rio_slider\" id=\"practicalHelpSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"practicalHelpGroup","type":"area","item-type":"group","_auto_id_":"ce65eff8-2ec5-4279-bf8a-961217f6707e","content":[{"name":"PRSatPL","type":"choice","item-type":"slider","_auto_id_":"73e690dc-ad2e-4480-8605-fd7e38a51490","label":"How satisfied are you with the practical help you receive?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{}},{"name":"PRSatHelp","type":"choice","item-type":"radio","_auto_id_":"89b1a719-1f93-4fd3-87c6-2dba8d5e3c95","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"PRSatActions","type":"user-input","item-type":"text","_auto_id_":"51464007-8097-40d6-b60b-69ee4a84fc80","label":"Practical help goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.PRSatHelp == '1'"},"validators":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"mhpMeetingsTitle","type":"content","item-type":"html","_auto_id_":"86a61481-8206-4e44-bb22-32a4a3d1122c","content":"<h2>Meetings</h2>\n<div class=\"rio_slider\" id=\"meetingsSummary\"></div>","expressions":{},"classes":"summary-title closed"},{"name":"mhpMeetingsGroup","type":"area","item-type":"group","_auto_id_":"f7a9bfc9-b30a-43c4-a3fe-831709dfeb1a","content":[{"name":"MPSatPL","type":"choice","item-type":"slider","_auto_id_":"0a73643d-2cb3-45b5-bc42-9f63aae8eef0","label":"How satisfied are you with your meetings with mental health professionals?","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{},"validators":[],"actions":[]},{"name":"MPSatHelp","type":"choice","item-type":"radio","_auto_id_":"0ecb144c-261b-4047-8162-b35314da4d59","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"MPSatActions","type":"user-input","item-type":"text","_auto_id_":"9c4c5997-c5a8-4b2a-a681-9b32e8debf12","label":"Meetings with mental health professionals goals and actions:","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.DialogForm.MPSatHelp == '1'"},"validators":[],"actions":[]}],"repeat":false,"expressions":{},"classes":"accord"},{"name":"StageTreat","type":"choice","item-type":"select","_auto_id_":"b4b1fd07-04cb-4247-a5f7-8cc0bc995a33","label":"Is this a CPA Review?","required":true,"options":[{"label":"Yes","value":"03CRP"},{"label":"No","value":"05"}],"expressions":{},"message":"This is a required field"},{"name":"StageTreat1","type":"choice","item-type":"select","_auto_id_":"8900f475-a146-4ba3-ab11-a109137790e1","label":"Stage of Treatment:","required":true,"options":[{"label":"Assessment","value":"01ASS"},{"label":"Review","value":"02Rev"},{"label":"Discharge (from CPA or Trust)","value":"03Dis"}],"expressions":{},"message":"This is a required field"},{"name":"InCareDec","type":"choice","item-type":"select","_auto_id_":"77c89d88-07c9-4e2d-9faf-a8a593e48e16","label":"Initial Care Decision:","required":true,"options":[{"label":"Short term support to max independence","value":"01az"},{"label":"Long term support -  nursing care","value":"02az"},{"label":"Long term support - residential care","value":"03az"},{"label":"Long term support - community / prison","value":"04az"},{"label":"100% NHS funded care","value":"05az"},{"label":"End of life","value":"06az"},{"label":"Ongoing low level support","value":"07az"},{"label":"Short term support (other)","value":"08az"},{"label":"Signposted to other services","value":"09az"},{"label":"No services provided - deceased","value":"10az"},{"label":"No services provided - other reason","value":"11az"}],"expressions":{},"message":"This is a required field"},{"name":"SUCap","type":"choice","item-type":"select","_auto_id_":"5d448b96-9f5c-4cf0-926a-59d25f7a972d","label":"Service User response:","required":true,"options":[{"label":"Service user agreed assessment","value":"01SUA"},{"label":"Service user declined assessment","value":"02SUDA"},{"label":"SU lacks capacity - carer completed","value":"03SULCCARE"},{"label":"SU lacks capacity - clinician completed","value":"04SULCCLIN"},{"label":"SU declined-carer completed(CAMHS only)","value":"05SUDCAMHS"}],"expressions":{},"message":"This is a required field"},{"name":"MHRecovery","type":"user-input","item-type":"text","_auto_id_":"e26f708a-a0dc-4872-b7e4-b245047729ed","label":"What recovery means to me?","required":true,"multiline":true,"debounce":250,"expressions":{},"message":"This is a required field"},{"name":"MHMatters","type":"user-input","item-type":"text","_auto_id_":"6c0247bc-8bd4-4fff-8ec5-308d9f4cba8c","label":"What matters to me?","required":true,"multiline":true,"debounce":250,"expressions":{},"message":"This is a required field"},{"name":"MHSkills","type":"user-input","item-type":"text","_auto_id_":"75403f25-14e7-44cd-bdcb-c9322fbec25b","label":"My skills, strengths and experiences that will help me achieve my goals?","required":true,"multiline":true,"debounce":250,"expressions":{},"message":"This is a required field"},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"9d5457cc-7f71-4cbe-8c0d-90b00fb51d48","attributes":{},"expressions":{}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"1c2326f4-aba9-4cb4-a872-18a0b54ae39e","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"//cti.store.variables.selected_visit.dialog_form_status = true;\n//cti.store.variables.selected_visit.dialog_form_object.status = \"complete\";\ncti.utils.callAction(\"call-actionflow\", { name: \"SubmitDialogForm\" })\n"},"_auto_id_":"395200e1-5768-413f-a758-a33ec6707f00","actions":[]}],"classes":"default"}],"_auto_id_":"892851ef-3b40-49ab-bf11-933b18016074","expressions":{}}]},{"start":false,"name":"LifestyleForm","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"b75151e1-05f7-415e-ac0e-86420109a6ca","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"19efd10b-4a7a-4745-b6d7-dec8461d0dd7"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Lifestyle Form</h4>","_auto_id_":"29a365fa-2c67-4fc8-8521-e2888f5906b4"}],"_auto_id_":"4dec850f-8ad9-4077-801c-8b862b2ab30c","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"1b34ec00-e0ff-44b0-99e8-07e792e90714","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"0f9378d4-bf5b-44ae-82df-e7741f018472","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"c57f3e50-e181-4291-a499-7044dfe941f6","content":[{"name":"answerAccuratelyBanner","type":"content","item-type":"html","_auto_id_":"c3f266cb-7040-43f6-a6e0-2b1e6795059d","content":"<p>Please answer this assessment as accurately and completely as possible.</p>","expressions":{},"classes":"banner-dark"},{"name":"Smoking","type":"area","item-type":"group","_auto_id_":"c713ff1b-8ff4-408c-a2fb-18b0ecf5c928","content":[{"name":"lssmoked","type":"choice","item-type":"radio","_auto_id_":"aa106ac7-0616-426a-86ba-44aef832d431","label":"Have you ever smoked?","required":true,"options":[{"label":"Not assessed","value":"SS01"},{"label":"No","value":"SS02"},{"label":"Ex-smoker","value":"SS03"},{"label":"Current smoker","value":"SS04"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"SS01\""},"message":"This is a required field","classes":"question_primary"},{"name":"Smoker","type":"area","item-type":"group","_auto_id_":"12571a5c-01ca-49e4-87d0-3cbcf5080b5d","content":[{"name":"lscigperday","type":"user-input","item-type":"number","_auto_id_":"a40505a4-6005-4736-8c57-128d7ba41b58","label":"Cigarettes per day","required":false,"decimals":2,"expressions":{}},{"name":"smokeadvice","type":"choice","item-type":"radio","_auto_id_":"23c00347-7093-4003-a514-45af0030f6a6","label":"Very brief advice given?","required":false,"options":[{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"02\""}},{"name":"Refsmoke","type":"choice","item-type":"radio","_auto_id_":"3dcfed9f-1898-4e01-a98b-ad88146ed81d","label":"Referred to smoking cessation services?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"StopSmoke","type":"choice","item-type":"radio","_auto_id_":"2dd02ed2-d99a-4541-8882-48d4ddc7ddef","label":"Stop smoking medication given?","required":false,"options":[{"label":"Medication not offered","value":"01az"},{"label":"Medication offered & accepted","value":"02az"},{"label":"Medication offered but declined","value":"03az"},{"label":"Not medically appropriate","value":"04az"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[]},{"name":"smokeintoffer","type":"choice","item-type":"radio","_auto_id_":"84426402-bf75-404e-a9a5-d70e4e114585","label":"Other intervention offered?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[]},{"name":"smokefreetext1","type":"user-input","item-type":"text","_auto_id_":"d5ce8b45-966e-4e14-a985-8b1304f2ee02","label":"Details of any other intervention offered","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.LifestyleForm.smokeintoffer == \"03\" || $store.pages.LifestyleForm.smokeintoffer == \"04\""},"validators":[],"actions":[]}],"repeat":false,"expressions":{"show":"$store.pages.LifestyleForm.lssmoked == \"SS04\""}}],"repeat":false,"expressions":{},"classes":"question_group"},{"name":"Diet","type":"area","item-type":"group","_auto_id_":"2680ea4b-88dd-45eb-8ec3-3792fe486019","content":[{"name":"diethealthy","type":"choice","item-type":"radio","_auto_id_":"006d961d-a9d2-4546-b150-ae79d8d5cb92","label":"Do you think you eat a healthy diet?","required":true,"options":[{"label":"Not assessed","value":"01"},{"label":"Not at all","value":"02"},{"label":"Some of the time","value":"03"},{"label":"Most of the time","value":"04"},{"label":"Nearly all the time","value":"05"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"01\""},"message":"This is a required field","classes":"question_primary"},{"name":"lsdietcomment","type":"user-input","item-type":"text","_auto_id_":"250a438c-12f4-4574-ab45-2e2b7453637c","label":"Please give more detail","required":false,"multiline":true,"debounce":250,"expressions":{},"validators":[],"actions":[]},{"name":"dietintervention","type":"choice","item-type":"radio","_auto_id_":"7f7f74de-cd62-4ae3-8c7c-32e426e0823f","label":"Intervention offered?","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"01\""}},{"name":"dietintdetails","type":"user-input","item-type":"text","_auto_id_":"dd31244f-0975-435d-bd71-90191a303ceb","label":"Details of intervention offered","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.LifestyleForm.dietintervention == \"03\" || $store.pages.LifestyleForm.dietintervention == \"04\""}}],"repeat":false,"expressions":{},"classes":"question_group"},{"name":"Exercise","type":"area","item-type":"group","_auto_id_":"89ebc629-152c-49e1-9d86-9ea0046accb1","content":[{"name":"regularexercise","type":"choice","item-type":"radio","_auto_id_":"91fafd43-6316-4c32-b043-ad99ca9e8f63","label":"Do you exercise regularly?","required":false,"options":[{"label":"Not assessed","value":"00"},{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{"default":"\"00\""},"validators":[],"classes":"question_primary"},{"name":"exercise_repeater","type":"area","item-type":"group","_auto_id_":"6cefd525-ba6a-4826-8ba6-32589a2251df","content":[{"name":"Intensity","type":"choice","item-type":"radio","_auto_id_":"030ab7c6-339a-45de-9764-6b1770321b36","label":"Intensity","required":false,"options":[{"label":"Low","value":"01"},{"label":"Medium","value":"02"},{"label":"High","value":"03"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[]},{"name":"misperweek","type":"user-input","item-type":"number","_auto_id_":"dd2e8a27-3798-49ee-9fcb-a075e2cba803","label":"Minutes per week","required":false,"decimals":2,"expressions":{}}],"repeat":true,"expressions":{"show":"$store.pages.LifestyleForm.regularexercise == \"01\""}},{"name":"exintoffer","type":"choice","item-type":"radio","_auto_id_":"89b551c4-1802-4078-8f2a-85fd7dafd2f6","label":"Intervention offered","required":false,"options":[{"label":"Intervention not offered","value":"01"},{"label":"Intervention not required","value":"02"},{"label":"Offered and accepted","value":"03"},{"label":"Offered but declined","value":"04"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[]},{"name":"intdetails","type":"user-input","item-type":"text","_auto_id_":"eb5dbc66-6ad3-4c75-a2c4-2cdb1b5acad6","label":"Details of intervention offered","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$store.pages.LifestyleForm.exintoffer == \"03\" || $store.pages.LifestyleForm.exintoffer == \"04\""},"validators":[],"actions":[]}],"repeat":false,"expressions":{},"classes":"question_group"},{"name":"exercise_repeat_displayer","type":"content","item-type":"list","_auto_id_":"ad241fec-a51a-4870-9eef-7c723e6fbe91","static":false,"model":"$store.repeater.LifestyleForm.exercise_repeater","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"exercise_displayer","type":"content","item-type":"html","_auto_id_":"51fc2c5e-b185-48b1-99e4-c3e87474d862","content":"<div class=\"drug_node\">{{ $data.$item.intensity.label}}</div>\n<div class=\"drug_node\">{{ $data.$item.misperweek}}</div>","expressions":{}}],"dataSource":"dynamic","expressions":{},"actions":[],"classes":"exercise_repeater"},{"name":"Alcohol","type":"area","item-type":"group","_auto_id_":"302b8737-b716-41b8-9f6b-4d41ce6e6fb2","content":[{"name":"alcCurrentUser","type":"choice","item-type":"radio","_auto_id_":"69b570a0-9c22-4996-af24-94e5c528ab6c","label":"Are you a current alcohol user? ","required":false,"options":[{"label":"Yes","value":"01"},{"label":"No","value":"02"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[],"actions":[],"classes":"question_primary"},{"name":"Drinks","type":"area","item-type":"group","_auto_id_":"f64e0e01-6b04-4f43-adbc-33484ff809d6","content":[{"name":"withdrawal","type":"choice","item-type":"radio","_auto_id_":"b822859a-bcab-4bb2-a220-54abdec3baa3","label":"Is there evidence of alcohol withdrawal?","required":false,"options":[{"label":"Yes","value":"1"},{"label":"No","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[]},{"name":"alcHowOften","type":"choice","item-type":"select","_auto_id_":"a47bd49a-7af3-4520-9548-f7740acd238f","label":"How often do you have an alcoholic drink?","required":false,"options":[{"label":"Never","value":"0"},{"label":"Monthly or less","value":"1"},{"label":"2-4 times per month","value":"2"},{"label":"2-3 times per week","value":"3"},{"label":"4+ per week","value":"4"}],"expressions":{}},{"name":"alcHowManyUnits","type":"choice","item-type":"select","_auto_id_":"b8077f7f-6ed8-4156-890e-1de6897db9f5","label":"How many units of alcohol do you consume on a typical day when drinking?","required":false,"options":[{"label":"1-2","value":"0"},{"label":"3-4","value":"1"},{"label":"5-6","value":"2"},{"label":"7-9","value":"3"},{"label":"10+","value":"4"}],"expressions":{}},{"name":"alcExceedUnits","type":"choice","item-type":"select","_auto_id_":"171310ea-4c27-4b78-b0c6-5889717e85c6","label":"How often do you exceed 6 or more units on a single occasion?","required":false,"options":[{"label":"Never","value":"0"},{"label":"Less than monthly","value":"1"},{"label":"Monthly","value":"2"},{"label":"Weekly","value":"3"},{"label":"Daily or almost daily","value":"4"}],"validators":[],"expressions":{}},{"name":"alcIntervention","type":"choice","item-type":"select","_auto_id_":"67797f24-09f5-4df7-ace4-40dcc01fa212","label":"Intervention","required":false,"options":[{"label":"None required","value":"01az"},{"label":"Brief advice given","value":"02az"},{"label":"Self-referred to alcohol services","value":"03az"},{"label":"Referral to alcohol services made","value":"04az"},{"label":"Referral offered but declined","value":"05az"}],"validators":[],"expressions":{},"actions":[]},{"name":"alcintdetail","type":"user-input","item-type":"text","_auto_id_":"cc0e9bc5-24ac-4267-89d2-7d018e5c8ebb","label":"Details of service offered","required":false,"multiline":true,"debounce":250,"expressions":{},"validators":[],"actions":[]}],"repeat":false,"expressions":{"show":"$store.pages.LifestyleForm.alcCurrentUser != \"02\""}}],"repeat":false,"expressions":{},"classes":"question_group"},{"name":"Drugs","type":"area","item-type":"group","_auto_id_":"142a7198-57ee-4d82-abc8-dbac14003759","content":[{"name":"recdruguse","type":"choice","item-type":"radio","_auto_id_":"1c0b55e2-003a-4e70-89ac-25fb79044efb","label":"Have you ever used recreational drugs?","required":false,"options":[{"label":"Not assessed","value":"1na"},{"label":"No","value":"2no"},{"label":"In the past","value":"3tp"},{"label":"Current user","value":"4cu"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"validators":[],"actions":[],"classes":"question_primary"},{"name":"drugs_group","type":"area","item-type":"group","_auto_id_":"a7c34f5d-35a9-4b49-afdf-7db9d177c8ae","content":[{"name":"drugname","type":"choice","item-type":"select","_auto_id_":"b3d5801c-2534-4555-a057-ec59bcb12f58","label":"Drug name:","required":false,"options":[{"label":"Amphetamines","value":"01"},{"label":"Cannabis","value":"02"},{"label":"Powder cocaine","value":"03"},{"label":"Crack cocaine","value":"04"},{"label":"Heroin","value":"05"},{"label":"Ketamine","value":"08"},{"label":"Legal highs","value":"10"},{"label":"Not used","value":"00"},{"label":"Ecstasy","value":"06"},{"label":"Khat","value":"07"},{"label":"Crystal meth","value":"09"},{"label":"Other","value":"99"}],"expressions":{},"validators":[]},{"name":"otherdrug","type":"user-input","item-type":"text","_auto_id_":"eb5716a4-b32a-4c40-b420-3dbec87c7c79","label":"If 'Other' enter name","required":false,"multiline":false,"debounce":250,"expressions":{"show":"$store.pages.LifestyleForm.drugname.value == \"99\""},"validators":[],"actions":[]},{"name":"currentuse","type":"choice","item-type":"radio","_auto_id_":"212bbcb4-fa19-41b0-80fb-b9fa95d22ed6","label":"Currently using?","required":false,"options":[{"label":"Yes","value":"1"},{"label":"No","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{}},{"name":"useperweek","type":"user-input","item-type":"text","_auto_id_":"5dd1f6d7-fc84-4de7-92fe-4270a53fc115","label":"Quantity used in average week","required":false,"multiline":false,"debounce":250,"expressions":{}},{"name":"modeofuse","type":"user-input","item-type":"text","_auto_id_":"6ed5c866-77ab-4b55-8d78-ef9ab8d19b79","label":"Mode of user (e.g. smoked, injected)","required":false,"multiline":false,"debounce":250,"expressions":{},"validators":[]}],"repeat":true,"expressions":{"show":"$store.pages.LifestyleForm.recdruguse == \"4cu\""}}],"repeat":false,"expressions":{},"classes":"question_group"},{"name":"drugs_repeat_displayer","type":"content","item-type":"list","_auto_id_":"2f63d225-5ca6-4550-974d-e523176da119","static":false,"model":"$store.repeater.LifestyleForm.drugs_group","data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"drug_displayer","type":"content","item-type":"html","_auto_id_":"010029ce-4a09-4268-b81b-843c863dd409","content":"<div class=\"drug_node\">{{ $data.$item.otherdrug || $data.$item.drugname.label}}</div>\n<div class=\"drug_node\">{{ $data.$item.currentuse }}</div>\n<div class=\"drug_node\">{{ $data.$item.useperweek }}</div>\n<div class=\"drug_node\">{{ $data.$item.modeofuse }}</div>","expressions":{}}],"dataSource":"dynamic","expressions":{},"actions":[],"classes":"drug_repeater"}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"bbae7713-5268-4343-8d84-78a7ab94f07d","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.store.variables.selected_visit.lifestyle_form_status = true;\ncti.store.variables.selected_visit.lifestyle_form_object.status = \"complete\";\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"});"},"_auto_id_":"75c262fd-318a-4b72-96d1-f976a4ab21b0","actions":[]}],"classes":"default"}],"_auto_id_":"e29deb1d-94fb-4afb-ac3c-ced3d34dc9be","expressions":{}}]},{"start":false,"name":"SafetyForm","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"568d4edd-3bf9-4576-9ea6-54db2df16336","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"1df89465-4282-4741-b424-f0acb2def786"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>My Safety Plan</h4>","_auto_id_":"4d685c20-2ab5-49dd-ac46-128c7970b2a3"}],"_auto_id_":"791a1753-ff6e-41c2-8773-9c72a6fe299b"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"e72735bc-e836-4634-bd89-d9916caf06c5","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"5e7cd98a-191f-485e-8e32-9536e16b2cf4","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable_results","type":"area","item-type":"scrollable","content":[{"name":"sf_triggers","type":"user-input","item-type":"text","_auto_id_":"c35442a7-cf26-478a-9f7d-10de8a846e21","label":"Triggers: ","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_triggers_actionplan","type":"user-input","item-type":"text","_auto_id_":"570e08e0-9173-44bb-8ca2-c3b779219525","label":"Triggers action plan:","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_earlyws","type":"user-input","item-type":"text","_auto_id_":"86ae04bf-eafa-4f56-8160-859f2fd567af","label":"How do I know when things are getting worse? (Early warning signs)","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_earlyws_actionplan","type":"user-input","item-type":"text","_auto_id_":"44de0f59-9abc-4d23-b01b-f87ee17ea557","label":"When things are getting worse action plan:","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_getworse","type":"user-input","item-type":"text","_auto_id_":"53124c75-ab69-49d1-b907-854a74fb892e","label":"How do I know when things have got worse? (e.g. in crisis, feeling unsafe)","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_getworse_actionplan","type":"user-input","item-type":"text","_auto_id_":"aca2518d-9956-4b5e-a4b7-fd8fd3cefb51","label":"When things have got worse action plan:","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_assisteddecision","type":"user-input","item-type":"text","_auto_id_":"91d3046a-0075-4604-8eba-2be07d3393e6","label":"What I would like you to do for me when I am unable to make decisions for myself?","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_advancedirective","type":"choice","item-type":"switch","_auto_id_":"c8c89b0c-cea9-45e2-8b94-d00ca9b9ffdd","label":"This is my Advance Directive: ","required":false,"on-text":"","off-text":"","expressions":{},"validators":[],"actions":[]},{"name":"sf_contact","type":"user-input","item-type":"text","_auto_id_":"1e55f629-399b-4192-bbae-444ac8dd1fd6","label":"How can I best be contacted?","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_contactreach","type":"user-input","item-type":"text","_auto_id_":"f0c91a66-eb1e-443b-a79a-ceee93fc2341","label":"Who can be contacted if I can't be reached?","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_crisisnumber","type":"user-input","item-type":"text","_auto_id_":"432ac1c2-ed67-4f41-bdf5-354c285325ec","label":"My local crisis line number is:","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_outofcrisis","type":"user-input","item-type":"text","_auto_id_":"c176c369-97b0-4b3d-8766-2436fb6d38c3","label":"How will I know when I am out of crisis?","required":false,"multiline":true,"debounce":250,"expressions":{}},{"name":"sf_serviceuseragreedplan","type":"choice","item-type":"switch","_auto_id_":"62629de2-deff-4809-b2be-8f82eadb0fac","label":"Service user agreed plan? ","required":false,"on-text":"","off-text":"","expressions":{},"validators":[],"actions":[]},{"name":"activity_spinner","type":"component","item-type":"web-component","content":[],"componentId":"0d99e205-ae61-431d-85d1-6a3702fa694b","_auto_id_":"d850b6e1-4e68-42da-a9c1-3e42e31e789a","attributes":{},"expressions":{}}],"_auto_id_":"37cc478e-f7ac-42a6-b178-e0cebdad579d","expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"4fea0139-dcdc-44af-a1e4-7282b9cc8b6b","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"//cti.store.variables.selected_visit.safety_form_status = true;\n//cti.store.variables.selected_visit.safety_form_object.status = \"complete\";\n//cti.utils.callAction(\"go-to-page\", {\"name\":\"Visit\"});\n// TODO: Tidy up expired code\ncti.utils.callAction(\"call-actionflow\", { name: \"SubmitSafetyForm\" })"},"_auto_id_":"902b36f3-dcb8-463c-940f-a9536cb9e3d2","actions":[]}],"classes":"default"}],"_auto_id_":"00c11f50-00d9-4d4a-88cf-121e9ae04c5f","expressions":{}}]},{"start":false,"name":"PreDialogForm","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"b75151e1-05f7-415e-ac0e-86420109a6ca","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"19efd10b-4a7a-4745-b6d7-dec8461d0dd7"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Assessment</h4>","_auto_id_":"29a365fa-2c67-4fc8-8521-e2888f5906b4"}],"_auto_id_":"4dec850f-8ad9-4077-801c-8b862b2ab30c","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"1b34ec00-e0ff-44b0-99e8-07e792e90714","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"0f9378d4-bf5b-44ae-82df-e7741f018472","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"c57f3e50-e181-4291-a499-7044dfe941f6","content":[{"name":"gettingStartedBanner","type":"content","item-type":"html","_auto_id_":"c3f266cb-7040-43f6-a6e0-2b1e6795059d","content":"<p>Getting Started</p>","expressions":{},"classes":"banner-dark"},{"name":"preDialogText","type":"content","item-type":"html","_auto_id_":"b2a023fb-c2b3-4ca3-98e5-6468a280a579","content":"<p>This form must be completed at point of entry into the service, at regular intervals throughout clinical contact and at discharge.</p>\n<p>In all scenarios the answer to the question 'Does the service user want help?' should be completed by the service user.</p>\n<p>Occasionally the clinician's view may be different to that of the service user or the service user may lack the capacity to decide.<br />\nIn both cases the box most likely to represent the service user's views should be ticked.</p>\n<p>The free text box should then be used to provide reasons for the service user's view followed by the views of the professional or family if different.</p>\n<p>When discussing and creating an action plan please follow steps 1-3 for each area you agree to discuss today:</p>\n<p><strong>Step 1: Understanding</strong> - why this rating and not a lower one? - what is working?</p>\n<p><strong>Step 2: Looking forward</strong> - best case scenario? - smallest improvement?</p>\n<p><strong>Step 3: Considering options</strong> - what can the patient do? - what can the clinician do? - what can others do?</p>","expressions":{}}],"expressions":{}},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_begin","type":"button","item-type":"button","_auto_id_":"bbae7713-5268-4343-8d84-78a7ab94f07d","content":"BEGIN ASSESSMENT","theme":"default","expressions":{},"actions":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogForm\"});"},"_auto_id_":"75c262fd-318a-4b72-96d1-f976a4ab21b0","actions":[]}],"classes":"default"}],"_auto_id_":"e29deb1d-94fb-4afb-ac3c-ced3d34dc9be","expressions":{}}]},{"start":false,"name":"DialogPlus_Form","config":[{"name":"On-Load Event","type":"event","item-type":"onload","_auto_id_":"516d475d-774c-4a85-b6aa-6777de9acc5a","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"if ($store.variables.v_dialog_plus_questions == '' ||  $store.variables.v_dialog_plus_questions == undefined ) {\n$store.variables.v_dialog_plus_questions = [ { \"id\": \"MHSat1\", \"title\": \"Mental health\", \"question\": \"How satisfied are you with your mental health?\", \"extra\": \"\", \"help\": \"MHSatHelp\", \"actions\": \"MHSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"PHSatPL\", \"title\": \"Physical health\", \"question\": \"How satisfied are you with your physical health?\", \"extra\": \"(this could include health generally, long or short term conditions, hospital / GP appointments, access to specialist support such as physiotherapy, dental care etc)\", \"help\": \"PHSatHelp\", \"actions\": \"PHSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"JSSatPL\", \"title\": \"Job situation\", \"question\": \"How satisfied are you with your job situation?\", \"extra\": \"(this could include school, college, education, training or voluntary work)\", \"help\": \"JSSatHelp\", \"actions\": \"JSSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"ACSatPL\", \"title\": \"Accommodation\", \"question\": \"How satisfied are you with your accommodation?\", \"extra\": \"(this could include your home or the ward environment if you are an inpatient)\", \"help\": \"ACSatHelp\", \"actions\": \"ACSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"LASatPL\", \"title\": \"Leisure activities\", \"question\": \"How satisfied are you with your leisure activities?\", \"extra\": \"(this could include hobbies, exercise, socialising etc)\", \"help\": \"LASatHelp\", \"actions\": \"LASatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"RSSatPL\", \"title\": \"Partner / family\", \"question\": \"How satisfied are you with your relationship with your partner / family?\", \"extra\": \"this could include issues relating to children, such as childcare, or informal carers\", \"help\": \"RSSatHelp\", \"actions\": \"RSSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"FSSatPL\", \"title\": \"Friendships\", \"question\": \"How satisfied are you with your friendships?\", \"extra\": \"this could include meeting new people and forming new friendships, support from a befriender\", \"help\": \"FSSatHelp\", \"actions\": \"FSSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"PSSatPL\", \"title\": \"Personal Safety\", \"question\": \"How satisfied are you with your personal safety?\", \"extra\": \"this could include safeguarding concerns, concerns about safety in the home / community or on the ward if you are an inpatient\", \"help\": \"PSSatHelp\", \"actions\": \"PSSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"FISatPL\", \"title\": \"Finances\", \"question\": \"How satisfied are you with your finances?\", \"extra\": \"this could include rent arrears, debt, issues with welfare benefits, budgeting, savings or access to money (such as appointeeship)\", \"help\": \"FISatHelp\", \"actions\": \"FISatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"CNSatPL\", \"title\": \"Personal identity\", \"question\": \"How satisfied are you with your expression of identity?\", \"extra\": \"this could include religious / faith beliefs, access to religious or spiritual support, cultural needs or issues (food, cultural practices, identified or unmet cultural needs), gender, sexuality, se\", \"help\": \"CNSatHelp\", \"actions\": \"CNSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"SUSatPL\", \"title\": \"Substance / alcohol\", \"question\": \"How satisfied are you with your substance / alcohol use?\", \"extra\": \"this could include amount consumed, frequency, impact on finances, impact on mental or physical health, harm reduction, support from GP or drug / alcohol agencies\", \"help\": \"SUSatHelp\", \"actions\": \"SUSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"MDSatPL\", \"title\": \"Medication\", \"question\": \"How satisfied are you with your medication?\", \"extra\": \"this could include type, dose, frequency, information provided, impact on physical health, interactions with physical health medication, support / independence in medication management, pharmacy arrangements etc\", \"help\": \"MDSatHelp\", \"actions\": \"MDSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"PRSatPL\", \"title\": \"Practical help\", \"question\": \"How satisfied are you with the practical help you receive?\", \"extra\": \"this could include help from a support worker, housing officer or paid carer\", \"help\": \"PRSatHelp\", \"actions\": \"PRSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" }, { \"id\": \"MPSatPL\", \"title\": \"Meetings\", \"question\": \"How satisfied are you with your meetings with mental health professionals?\", \"extra\": \"this could include frequency of appointments, access to mental health professionals, level or type of support, rapport, ward round arrangements etc\", \"help\": \"MPSatHelp\", \"actions\": \"MPSatActions\", \"result\": \"\", \"help_result\": \"\", \"actions_result\": \"\" } ]\n}\n$success()"},"_auto_id_":"67988d4a-e475-46df-b407-3178c0265777","actions":[]}]}],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"f146e5f3-ad85-459d-ba46-f9be6c9ea521","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"22991602-8e53-4c58-a6a9-cea5005bd33f"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>Dialog Form</h4>","_auto_id_":"ab514101-02ae-45f2-ae4d-4c8ca0fae61f"}],"_auto_id_":"cbe23532-4356-4f57-96da-9b42213f050f","expressions":{}},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"8f09d8ef-ee8c-4763-a79c-39634fd5b69d","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"6b294662-2592-45eb-b15d-79336bc261ea","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"question_counter","type":"content","item-type":"html","_auto_id_":"1f764052-518d-4332-b4da-89179e65c087","content":"<div id='q_count'>Question {{ '$store.pages.DialogPlus_Form.active_question_display ' | store}} of {{ '$store.variables.v_dialog_plus_questions.length' | store}}</div>","expressions":{"show":"$store.pages.DialogPlus_Form.active_question_display > -10"},"classes":"blackbar"},{"name":"question_totaliser","type":"content","item-type":"html","_auto_id_":"aee23522-d5ed-490b-a1a9-0ab2d0ff7f60","content":"<div id='q_count'>{{ '$store.variables.v_dialog_plus_questions.length' | store }} Questions</div>","expressions":{"show":"$store.pages.DialogPlus_Form.active_question_display == -10"},"classes":"blackbar"}],"expressions":{}},{"name":"scrollable_items","type":"area","item-type":"scrollable","_auto_id_":"4dbaab75-0ca0-47ab-a043-053d0b5d47ce","content":[{"name":"active_question","type":"user-input","item-type":"number","_auto_id_":"e78f292d-8aec-4758-8140-ee12a0675bd0","label":"","required":false,"decimals":0,"expressions":{"default":"-10"},"classes":"hideme","validators":[],"actions":[]},{"name":"active_question_display","type":"user-input","item-type":"number","_auto_id_":"5fc28d58-1640-4bed-9062-a6134dc3af19","label":"","required":false,"decimals":0,"expressions":{"default":"-10"},"description":"","validators":[],"actions":[],"classes":"hideme"},{"name":"question_list","type":"content","item-type":"list","_auto_id_":"a6a2fe73-9397-48e5-910c-0d2b5391d2fe","static":false,"data":"[]","autoscroll":false,"search":"","order":false,"pagination":false,"content":[{"name":"title_result_holder","type":"area","item-type":"group","_auto_id_":"7b7f66df-fec0-4676-b36b-269bd1ec28f6","content":[{"name":"question_title","type":"content","item-type":"html","_auto_id_":"3c03393d-f37e-42d4-adaf-7831c0154bdf","content":"<div id='{{$data.$index}}' onclick=cti.fn_DialogForm_Toggler(this.id)>\n\t<h3>{{ $data.$item.title }}</h3>\n</div>","expressions":{},"classes":"flex-title"},{"name":"result_indicator","type":"content","item-type":"html","_auto_id_":"25f7523e-3a71-4c19-9355-a017aae55fd0","content":"<div class='rio-slider '>\n  <span style='flex: 0 0 calc({{$parent.$parent.$data.$item.result}}/7 * 100%)'></span></div>\n","expressions":{},"classes":"flex-indicator"}],"repeat":false,"expressions":{"show":"$store.pages.DialogPlus_Form.active_question != {{ $data.$index }}"},"classes":"flex-row {{ $data.$index  }}"},{"name":"input_group","type":"area","item-type":"group","_auto_id_":"dcf6be9b-7ca1-4600-a7bd-4b333245cd82","content":[{"name":"result","type":"choice","item-type":"slider","_auto_id_":"9fbfdcf6-0f05-4fc1-9834-66ee9ef03564","label":"{{ $data.$item.question }}","required":false,"dual":false,"default":0,"min":1,"max":7,"step":1,"expressions":{"default":"0"},"classes":"initalHide result","modelLocationOverride":"","actions":[],"description":"{{ $data.$item.extra }}","validators":[]},{"name":"help_result","type":"choice","item-type":"radio","_auto_id_":"ab120423-4104-4900-8a06-ffd63c4cbbb0","label":"Does the service user want help?","required":false,"options":[{"label":"YES","value":"1"},{"label":"NO","value":"2"}],"icon-selected":"fa-dot-circle-o","icon-unselected":"fa-circle-o","expressions":{},"classes":"help_result"},{"name":"actions_result","type":"user-input","item-type":"text","_auto_id_":"3f68a0bf-9d51-4684-a8f1-9737116ee84c","label":"","required":false,"multiline":true,"debounce":250,"expressions":{"show":"$parent.$parent.$data.$item.help_result == '1'"},"modelLocationOverride":"","validators":[],"actions":[],"default":"","classes":"actions"}],"repeat":false,"expressions":{"show":"$store.pages.DialogPlus_Form.active_question == {{ $data.$index }}"},"classes":""}],"dataSource":"dynamic","actions":[],"expressions":{},"model":"$store.variables.v_dialog_plus_questions","classes":"dialogPlus"}],"expressions":{},"classes":"nopadding"},{"name":"footer","type":"area","item-type":"button-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_save","type":"button","item-type":"button","_auto_id_":"7009375c-08ca-4b8b-89e1-7ae5807c8a63","content":"SAVE","theme":"default","expressions":{"disabled":"$form.invalid;"},"actions":[],"classes":"default"}],"_auto_id_":"47460500-acd2-4a77-8ce6-0e28a3f66fe0","expressions":{}}]},{"start":false,"name":"SafetyForm_View","config":[],"content":[{"name":"title_bar","type":"area","item-type":"title-bar","extends":{"type":"area","item-type":"row"},"content":[{"name":"button_back","type":"button","item-type":"button","_auto_id_":"a6f7fea7-9cec-4c9d-a804-c3ff7a885ebf","content":"","theme":"minimal","left-icon":"fa-chevron-left","expressions":{},"actions":[{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"c9e7073e-381d-4b43-a623-266723c423e4"}]},{"name":"title","type":"content","item-type":"title","content":"<h4>My Safety Plans</h4>","_auto_id_":"95e2cc7e-a377-4991-9da8-0d65007e39f1"}],"_auto_id_":"3cd3a3f2-597f-4674-b949-87f38c0f6c64"},{"name":"static_banner","type":"area","item-type":"static","_auto_id_":"4c085f67-050a-4631-860a-213c6a72bccd","content":[{"name":"html_banner","type":"content","item-type":"html","_auto_id_":"3fa19fd3-1a43-4442-b178-9a85a75f5f43","content":"<div class=\"patientBanner\" id=\"patientBanner\">\n  <div class=\"patientName\">\n      <h4>{{'$store.variables.selected_visit.patientData.demographics.surname' | store}}, &nbsp;{{'$store.variables.selected_visit.patientData.demographics.firstname' | store}}&nbsp;({{'$store.variables.selected_visit.patientData.demographics.title' | store}})</h4>\n  </div>\n  <div id=\"dob\">\n    <div class=\"legend\">\n      DOB\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.birthDate' | store | date:mediumDate}} ({{'$store.variables.selected_visit.age' | store}}y)\n  </div>\n  <div id=\"gender\">\n    <div class=\"legend\">\n      Gender\n    </div>\n    {{'$store.variables.selected_visit.patientData.demographics.gender.value' | store}}\n  </div>\n  <div id=\"nhsNumber\">\n    <div class=\"legend hidden-xs\">\n      NHS Number\n    </div>\n    <div class=\"legend visible-xs\">\n      NHS\n    </div>\n    {{'$store.variables.selected_visit.nhsNumFormatted' | store}}\n  </div>\n  <div id=\"alerts\" class=\"{{'$store.variables.selected_visit.patientData.allergies.length > 0 ? \\'hasAllergies\\' : \\'\\''|store}}{{'$store.variables.selected_visit.patientData.alerts.length > 0 ? \\' hasAlerts\\': \\'\\''|store}}\">\n    <div class=\"legend\">\n      Alerts\n    </div>\n    <div id=\"icons_holder\">\n        <span id=\"alert\"></span>\n        <span id=\"allergy\"></span>\n    </div>\n  </div>  \n</div>","expressions":{}},{"name":"button_back_to_menu","type":"button","item-type":"button","_auto_id_":"966d1bce-f617-4be7-ba71-7d3888866057","content":"Appointment Type: {{'$store.variables.selected_visit.appointmentType.value '|store}}","theme":"minimal","expressions":{"disabled":"1"},"actions":[],"classes":""}],"expressions":{}},{"name":"scrollable_results","type":"area","item-type":"scrollable","content":[{"name":"list_safety_forms","type":"content","item-type":"list","_auto_id_":"65362235-f12b-4782-8d03-3a539f56b878","static":false,"model":"$store.variables.v_safetyForms","data":"[]","autoscroll":false,"search":"","order":false,"pagination":true,"content":[{"name":"sf_triggers","type":"user-input","item-type":"text","_auto_id_":"93dcbc92-2745-4012-b7b9-251b9bc674b0","label":"Triggers: ","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"},"validators":[],"actions":[]},{"name":"sf_triggers_actionplan","type":"user-input","item-type":"text","_auto_id_":"dafefb91-ae73-4490-aeb1-4221c5253ea3","label":"Triggers action plan:","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"}},{"name":"sf_earlyws","type":"user-input","item-type":"text","_auto_id_":"de2971d5-150c-47be-a603-9ff1793e67ce","label":"How do I know when things are getting worse? (Early warning sings)","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"}},{"name":"sf_earlyws_actionplan","type":"user-input","item-type":"text","_auto_id_":"e865f373-a3d1-46d8-846e-04b8175c25fb","label":"When things are getting worse action plan:","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"}},{"name":"sf_getworse","type":"user-input","item-type":"text","_auto_id_":"74d30bb3-c757-4b46-8dc4-3fc00a038001","label":"How do I know when things have got worse? (e.g. in crisis, feeling unsafe)","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"}},{"name":"sf_getworse_actionplan","type":"user-input","item-type":"text","_auto_id_":"dbed890b-557f-4c45-8092-0deced0a9efd","label":"When things have got worse action plan:","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"}},{"name":"sf_assisteddecision","type":"user-input","item-type":"text","_auto_id_":"66155052-9c57-41ed-b5f4-571eb267ce2d","label":"What I would like you to do for me when I am unable to make decisions for myself?","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"}},{"name":"sf_advancedirective","type":"choice","item-type":"switch","_auto_id_":"35a9f26e-0de0-43fe-a77f-c5dfc944ef34","label":"This is my Advance Directive: ","required":false,"on-text":"","off-text":"","expressions":{"disabled":"1"},"validators":[],"actions":[]},{"name":"sf_contact","type":"user-input","item-type":"text","_auto_id_":"d6d8b17f-2e78-43b0-bf87-0695d61ca57c","label":"How can I best be contacted?","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"}},{"name":"sf_contactreach","type":"user-input","item-type":"text","_auto_id_":"51e32879-a449-42fe-820a-801e11a37c36","label":"Who can be contacted if I can't be reached?","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"}},{"name":"sf_crisisnumber","type":"user-input","item-type":"text","_auto_id_":"542877b1-a25d-4c40-a5d7-d8a6786b8891","label":"My local crisis line number is:","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"}},{"name":"sf_outofcrisis","type":"user-input","item-type":"text","_auto_id_":"8f3268d5-45e9-424b-add6-665533cc694a","label":"How will I know when I am out of crisis?","required":false,"multiline":true,"debounce":250,"expressions":{"disabled":"1"}},{"name":"sf_serviceuseragreedplan","type":"choice","item-type":"switch","_auto_id_":"2e6ce833-1bae-4a3e-8340-07a996549a53","label":"Service user agreed plan? ","required":false,"on-text":"","off-text":"","expressions":{"disabled":"1"},"validators":[],"actions":[]}],"dataSource":"dynamic","expressions":{},"paginationItemsPerPage":1,"paginationBelow":false,"paginationFirstLabel":"First","paginationPrevLabel":"Prev","paginationNextLabel":"Next","paginationLastLabel":"Last","paginationPrevNext":false,"paginationShowOnePage":false,"paginationAbove":true}],"_auto_id_":"94912d65-d56c-4bc2-83f5-d6cc577d55ff","expressions":{}}]}],"actionflows":[{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'Action Flow: Login', \n  'info'\n);\n\n// Grab and set current location\ncti.fn_get_location()\n\nvar platform = cti.store.env.platform.name;\n\n// if user is authenticated but no pin is set we need to make the user set a PIN\nif (cti.store.variables.v_isAuthenticated && !cti.store.variables.v_userPIN) {\n  var dataDowload = true;\n\n  if(!cti.store.variables.getStaticDataStatus) { dataDowload = false }\n\n  if(dataDowload) {\n    cti.utils.callAction(\"go-to-page\", { \"name\": \"Set_PIN\" });\n    return false;\n  } else {\n    $success();\n    return false;\n  }\n}\n\nfunction isTouchIdAvailable() {\n  if(window.plugins != undefined) {\n    window.plugins.touchid.isAvailable(\n      function () {\n        iOSverifyPrint();\n      },\n      function (msg) {\n        cti.utils.callAction(\"go-to-page\", { \"name\": \"Enter_PIN\" });\n      }\n    );\n  } else {\n    cti.utils.callAction(\"go-to-page\", { \"name\": \"Enter_PIN\" });\n  }\n}\n\n\nfunction isFingerprintAuthAvailable(){\n\n  FingerprintAuth.isAvailable(function (result) {\n\n    console.log(result);\n\n    if (result.isAvailable == true && result.hasEnrolledFingerprints == true) {\n\n      var encryptConfig = {\n        maxAttempts: 3,\n        locale: \"en_US\",\n        dialogTitle: \"Fingerprint scan\",\n        dialogMessage: \"Please scan your fingerprint\"\n      }; // See config object for required parameters\n\n      FingerprintAuth.encrypt(encryptConfig, function (_fingerResult) {\n        //console.log(\"successCallback(): \" + JSON.stringify(_fingerResult));\n        if (_fingerResult.withFingerprint) {\n          //console.log(\"Successfully encrypted credentials.\");\n          //console.log(\"Encrypted credentials: \" + result.token);\n          cti.utils.callAction(\"go-to-page\", { \"name\": \"Visits\" });\n        } else if (_fingerResult.withBackup) {\n          //console.log(\"Authenticated with backup password\");\n          cti.utils.callAction(\"go-to-page\", { \"name\": \"Visits\" });\n        }\n        // Error callback\n      }, function (err) {\n        if (err === \"Cancelled\") {\n          console.log(\"FingerprintAuth Dialog Cancelled!\");\n        } else {\n          console.log(\"FingerprintAuth Error: \" + err);\n          cti.utils.callAction(\"go-to-page\", { \"name\": \"Enter_PIN\" });\n        }\n      });\n\n    }\n\n    else{\n      console.log(\"FingerprintAuth not found\");\n      cti.utils.callAction(\"go-to-page\", {\"name\" : \"Enter_PIN\"});\n    }\n\n  }); \n\n}    \n\nfunction iOSverifyPrint() {\n  window.plugins.touchid.verifyFingerprintWithCustomPasswordFallbackAndEnterPasswordLabel(\n    'Scan your fingerprint please',\n    'Enter App PIN',\n    function (msg) {\n      cti.utils.callAction(\"go-to-page\", { \"name\": \"Visits\" });\n    },\n    function (msg) {\n      /*   \n            *    code: -3 (fallback)\n            *    code: -2 (cancelled)\n            */\n\n      if (msg.code == '-3') {\n        cti.utils.callAction(\"go-to-page\", {\"name\" : \"Enter_PIN\"});\n\n      }\n    }\n  );\n}\n\nswitch (platform) {\n  case \"ios\":\n    isTouchIdAvailable();\n    break;\n  case \"android\":\n    isFingerprintAuthAvailable();\n    break;\n  default:\n    cti.utils.callAction(\"go-to-page\", {\"name\" : \"Enter_PIN\"});\n}"},"_auto_id_":"610e3966-609d-4c0e-90be-9ac6deaa764e","actions":[{"event":"success","type":"call-component-function","data":{"page":"Login","componentInstanceId":"723ae197-d492-49b6-bde1-ca129f5b4626","function":"toggle"},"_auto_id_":"900d633d-1b67-43eb-95de-ae6ebf3e75c8"}]}],"name":"Login"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: getappointments - Sending...', \n  'info'\n);\n\n//Set the date range to sync -1, +1\ncti.store.variables.v_appointmentSyncFromDate = moment().subtract(1, 'days').format(\"YYYY-MM-DD\");\ncti.store.variables.v_appointmentSyncToDate = moment().add(1, 'days').format(\"YYYY-MM-DD\");\n\n$success();"},"_auto_id_":"5d3fc6cd-555f-4b62-8690-bd14861c1b49","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getappointments","params":{"id":"{{$store.pages.Login.username}}","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","fromDate":"{{$store.variables.v_appointmentSyncFromDate}}","toDate":"{{$store.variables.v_appointmentSyncToDate}}"}},"_auto_id_":"a5ca4068-f96c-4713-a7bb-58eed23bf377","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// Grab response\nvar response = cti.store.api.api_rio.getappointments;\n\nif(!response.success){\n  // GetVisitList status set to failed: false\n  cti.store.variables.getVisitListStatus = false;\n  \n  cti.fn_toggle_spinner('close');\n  \n  window.logManager.consoleLog(\n    'API CALL: getappointments FAILED - Reason: ' + response.message, \n    'error'\n  );\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Unable to get Appointments.\"\n  });                           \n} else {\n  // GetVisitList status set to success: true\n  cti.store.variables.getVisitListStatus = true;\n  \n  window.logManager.consoleLog(\n    'API CALL: getappointments SUCCESS', \n    'info'\n  );\n  \n  window.pouchManager.saveToDatabase(\n    \"appointments\", \n    response.data, function(rev) {\n      window.logManager.consoleLog(\n        'Pouch DB - Saved Appointment Data. Revision: ' + rev, \n        'info', \n        cti.store.schema.metadata.logDebug,\n        cti.store.schema.metadata.startDebug\n      );\n      \n      delete cti.store.api.api_rio.getappointments;\n      cti.fn_load_appointments();\n      \n      cti.fn_toggle_spinner('close');\n      \n      if(cti.store.variables.pin_login) {\n        delete cti.store.variables.pin_login\n        cti.utils.callAction(\"go-to-page\", { \"name\": \"Visits\" });\n      } else {\n      \tcti.utils.callAction(\"call-actionflow\", { name: \"Login\" });\n      }\n    }, function(reason, e) {\n      window.logManager.consoleLog(\n        'Pouch DB - Failed to save Appointment Data - ' + reason, e, \n        'error', \n        cti.store.schema.metadata.logDebug,\n        cti.store.schema.metadata.startDebug\n      );\n      \n      cti.fn_toggle_spinner('close');\n      delete cti.store.api.api_rio.getappointments;\n  });\n}"},"_auto_id_":"69e4bf66-e7df-4c4e-a458-45ee4e515df7","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetVisitList status set to failed: false\ncti.store.variables.getVisitListStatus = false;\n\ncti.fn_toggle_spinner('close');\n\nwindow.logManager.consoleLog(\n  'API CALL - Fail Response: GetVisitList - Reason: ' + $data.$response.message, \n  'error'\n);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to connect to server.\"\n});                           \n\n$success();"},"_auto_id_":"ed950c72-0089-4516-a3c3-870372e32d4e","actions":[]}]}],"name":"GetVisitList"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('open', 'Submitting Outcome...');\n\nvar arrivalTime = null, actualTime = null, actualDuration = null;\nvar payload = {\n  appointmentOutcome: {\n    appointmentId: null,\n    clientId: {},\n    authorId: null,\n    arrivalTime: null,\n    actualTime: null,\n    actualDuration: null,\n    activites: {\n      string: []\n    },\n    consultationMedium: null,\n    outcome: null,\n    comments: null\n  }\n};\n\nvar activites = [];\ndebugger;\nfor(var i in cti.store.variables.o_activities) {\n  activites.push(cti.store.variables.o_activities[i].value);\n}\n\nvar arrivalTimeDt = new Date(cti.store.variables.selected_visit.arrivalTime);\nvar arrivalTimeStr = arrivalTimeDt.toString();\nvar arrivalTimeOffset = (arrivalTimeStr.substring(arrivalTimeStr.indexOf('+'))).substring(0,5);\n\nif (cti.store.pages.Outcome.arrivalTime) {\n  arrivalTime = cti.store.pages.Outcome.arrivalTime + arrivalTimeOffset;\n}\n\nif (cti.store.pages.Outcome.actualTime) {\n  actualTime = cti.store.pages.Outcome.actualTime + arrivalTimeOffset;\n}\n\nactualDuration = (Number(cti.store.pages.Outcome.duration_hours.value) * 60 +\n  Number(cti.store.pages.Outcome.duration_minutes.value)\n).toString();\n\npayload.appointmentOutcome.appointmentId = cti.store.variables.selected_visit.appointmentId;\npayload.appointmentOutcome.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId;\npayload.appointmentOutcome.arrivalTime = arrivalTime;\npayload.appointmentOutcome.actualTime = actualTime;\npayload.appointmentOutcome.actualDuration = actualDuration;\npayload.appointmentOutcome.activites.string = activites;\npayload.appointmentOutcome.outcome = cti.store.pages.Outcome.outcome.value;\ncti.store.pages.Outcome.comments != undefined ? payload.appointmentOutcome.comments = cti.store.pages.Outcome.comments : null;\n\ncti.store.variables.v_outcomePayload = payload;\ncti.store.variables.v_outcomePayload_clear = true;\n\n$success();"},"_auto_id_":"d040b0de-df31-4688-bb71-ac752c4471fc","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"outcomesave","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_outcomePayload}}"}},"_auto_id_":"7afe80d4-e0e1-453f-a9ad-c75876827daa","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"debugger;\nif(!$data.$response.success) {\n  console.log(\"API CALL: /outcomesave | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Submit Outcome Failed: \" + $data.$response.message || \"\"\n  });\n\n  // Close spinner\n  cti.fn_toggle_spinner('close');\n} else {\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    var appointments = doc.data;\n\n    for(var i in appointments) {\n      if(appointments[i].appointmentId == cti.store.variables.v_appointmentId) {\n        var outcomeObj = cti.store.variables.v_outcomePayload.appointmentOutcome;\n        var attendeeData = appointments[i].attendees.attendee;\n\n        delete attendeeData.possibleActivites;\n        delete attendeeData.possibleOutcomes;\n\n        attendeeData.actualTime = outcomeObj.actualTime;\n        attendeeData.arrivalTime = outcomeObj.arrivalTime;\n        attendeeData.outcome = outcomeObj.outcome;\n        attendeeData.outcomeComment = outcomeObj.outcomeComment;\n        break;\n      }\n    }\n\n    // Once we've updated and packaged the response appointment data, update and\n    // save to the exisitng pouch DB\n    window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n      console.log('Updated Appointment Data. Revision: ' + rev);\n      // On success of the update delete the request payload object...\n      delete cti.store.variables.v_outcomePayload;\n      \n      // ... reset appointment data\n      cti.fn_load_appointments();\n      \n      // ... and navigate to the visits page\n      cti.utils.callAction(\"go-to-page\", {\"name\":\"Visits\"});\n      \n      // Close spinner\n      cti.fn_toggle_spinner('close');\n    }, function(reason, e) {\n      console.log('Failed to Update Appointment Data - ' + reason, e);\n      // TODO: Process response if we fail to save the appointment data to pouch DB\n      // and implement offline storage and resubmission process\n      // On fail of the update delete the request payload object...\n      delete cti.store.variables.v_outcomePayload;\n      \n      // ... reset appointment data\n      cti.fn_load_appointments();\n      \n      // ... and navigate to the visits page\n      cti.utils.callAction(\"go-to-page\", {\"name\":\"Visits\"});\n      \n      // Close spinner\n      cti.fn_toggle_spinner('close');\n    });\n  }, function (reason, err) {\n    console.log('Error: Failed retriveing Appointments Data from Pouch - ', reason + err);\n    // TODO: Process response if we fail to load the pouch DB\n    // On fail of the update delete the request payload object...\n    delete cti.store.variables.v_outcomePayload;\n\n    // ... reset appointment data\n    cti.fn_load_appointments();\n\n    // ... and navigate to the visits page\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"Visits\"});\n\n    // Close spinner\n    cti.fn_toggle_spinner('close');\n  });\n  \n  cti.store.variables.selected_visit.status = 'complete';\n  cti.store.variables.v_appointmentId = cti.store.variables.selected_visit.appointmentId;\n\n  console.log(\"API CALL: /outcomesave | SUCCESS\");\n  console.log(\"Updating Pouch DB Appointment Data...\");\n}"},"_auto_id_":"67816004-409f-4281-b0bc-ffce0afd47e9"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"debugger;\nconsole.log(\"API CALL: /outcomesave | FAILED\");\nconsole.log(\"API FAILURE: \" + $data.$response.message);\ncti.fn_toggle_spinner('close');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Submit Outcome Failed: \" + $data.$response.message || \"\"\n});\n\ndelete cti.store.variables.v_outcomePayload;"},"_auto_id_":"27b1a7a0-eb8f-4822-8289-16bd1c787458"}]}],"name":"SubmitOutcome"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var d = new Date();\ndebugger;\n//As text\nvar s = d.toString();\n\n//Get the offset\nvar offset = (s.substring(s.indexOf('+'))).substring(0,5);\n\n//Compose the dates needed for RiO\ncti.store.pages.Note.calc_noteDateTime = d.toISOString().substring(0, 10) + ' ' + d.toLocaleTimeString() + offset;\n\ncti.store.pages.Note.calc_risks = cti.store.repeater.Note.riskType.map(function (obj) {\n  return obj.riskType.value;\n});\n\nvar object = {\n  \"clientId\" : {\n    \"type\":\"MRN\",\n    \"value\":\"RRRiO6MOD0914\"\n  },\n  \"noteDateTime\": \"2017-10-02\",\n  \"noteText\": \"Test\",\n  \"specialty\": {\n    \"code\":\"1SERVDN\",\n    \"value\":\"DISTRICT NURSING\"\n  }\n}\n\ncti.store.variables.progressNotePayload = object;\n\n$success();"},"_auto_id_":"2c49d6d4-1b21-46dc-9b15-879d10f74984","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"addprogressnote","params":{"appointmentId":"{{$store.variables.selected_visit.nhsNumber}}","authorId":"{{$store.pages.Login.username}}","noteDateTime":"{{$store.pages.Note.calc_noteDateTime}}","noteText":"{{$store.pages.Note.noteText}}","noteType":"{{$store.pages.Note.noteType.value}}","subNoteType":"{{$store.pages.Note.subType.value}}","specialty":"{{$store.pages.Note.specialty.value}}","riskType":"{{$store.repeater.Note.calc_risks.toString()}}","flagSignificantEvent":"{{$store.pages.Note.flagSignificantEvent}}","flagThirdParty":"{{$store.pages.Note.flagThirdParty}}","flagClientConceal":"{{$store.pages.Note.flagClientConceal}}","document":"{{$store.media.btnPhoto != undefined ? $store.media.btnPhoto.images[0] : ($store.media.btnAudio != undefined ? $store.media.btnAudio.audio[0]: undefined)}}","Authorization":"Basic {{$store.variables.auth_header}}","nhsNumber":"{{$store.variables.selected_visit.nhsNumber}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.progressNotePayload}}"}},"_auto_id_":"403a03b0-174f-446a-97b0-1c20659dacfa","actions":[{"event":"fail","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"notification_error","title":"Server Connection Error","text":"Unable to connect to the server"},"_auto_id_":"84f16cb4-3919-4c6d-abfe-8cc2a739b021"},{"event":"success","type":"inline-function","data":{"sync":true,"code":"console.log('TODO:', $data.$response)"},"_auto_id_":"2e9ff4ff-ea3e-4e9c-afae-16dcbb3cfb02"}]},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"781e0330-e976-4f4c-afb8-c894d647c9d6"}],"name":"SubmitNote"},{"content":[{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"alerttypes","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"2e98c295-e0c0-45eb-8fc0-b01d7c69d3bf","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  // GetAlertTypes status set to failed: false\n  cti.store.variables.getAlertTypesStatus = false;\n  \n  cti.fn_toggle_spinner('close');\n  \n  console.log(\"API CALL: /alerttypes | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server connection errror\", \n    \"text\" : \"Unable to retrieve Alert Types Reference data\"\n  });\n} else {\n  // GetAlertTypes status set to success: true\n  cti.store.variables.getAlertTypesStatus = true;\n  \n  console.log(\"API CALL: /alerttypes | SUCCESS\");\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"GetAlertPriorities\" });\n  $success();\n}"},"_auto_id_":"5ef4d88d-6d27-454b-9d8a-5e8951758bab","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetAlertTypes status set to failed: false\ncti.store.variables.getAlertTypesStatus = false;\n\ncti.fn_toggle_spinner('close');\n\nconsole.log(\"API CALL: /alerttypes | FAILED\");\nconsole.log(\"API FAILURE: \" + $data.$response.message);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server connection errror\", \n  \"text\" : \"Unable to connect to server.\"\n});"},"_auto_id_":"45d50517-aca8-425c-b838-ad2278ecfe44","actions":[]}]}],"name":"GetAlertTypes"},{"content":[{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"alertpriorities","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"d8b1da97-b9a8-4980-93a3-d6335f0b090c","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  // GetAlertPriorities status set to failed: false\n  cti.store.variables.getAlertPrioritiesStatus = false;\n  \n  cti.fn_toggle_spinner('close');\n  \n  console.log(\"API CALL: /alertpriorities | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\" , \n    \"text\" : \"Unable to retrieve Alert Priorities Reference data.\"\n  });\n} else {\n  // GetAlertPriorities status set to success: true\n  cti.store.variables.getAlertPrioritiesStatus = true;\n  \n  console.log(\"API CALL: /alertpriorities | SUCCESS\");\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"GetNoteConfig\" });\n  $success();\n}"},"_auto_id_":"50562cff-03e6-47a1-8a3b-4ba2af1ab18d","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetAlertPriorities status set to failed: false\ncti.store.variables.getAlertPrioritiesStatus = false;\n\ncti.fn_toggle_spinner('close');\n\nconsole.log(\"API CALL: /alertpriorities | FAILED\");\nconsole.log(\"API FAILURE: \" + $data.$response.message);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\" , \n  \"text\" : \"Unable to connect to the server.\"\n});"},"_auto_id_":"70d51000-95ea-4af3-89b1-68e3ddfc7c11","actions":[]}]}],"name":"GetAlertPriorities"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('open', 'Submitting Alert...');\n\nvar payload = {\n\tclientId: {},\n    date: null,\n    type: {},\n    priority: {},\n    text: null\n}\n\npayload.clientId.type = cti.store.variables.selected_visit.patientData.demographics.clientId.type;\npayload.clientId.value = cti.store.variables.selected_visit.patientData.demographics.clientId.value;  \npayload.date = moment().format(\"YYYY-MM-DD\");\npayload.type = cti.store.pages.Alert.type.value;\npayload.priority = cti.store.pages.Alert.priority.value;\npayload.text = cti.store.pages.Alert.description;\n                       \ncti.store.variables.v_alertToAdd = payload;\ncti.store.variables.v_alertToAdd_clear = true;\n\n$success();"},"_auto_id_":"26450d31-f506-4788-bc88-27a3f46a70a4","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"alertsadd","params":{"Authorization":"Basic {{$store.variables.auth_header}}","payload":"{{$store.variables.v_alertToAdd}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"224a531e-0281-4eeb-ac91-128d36c550f6","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"//AddAlert actionflow\ndebugger;\nif(!$data.$response.success){\n  console.log(\"API CALL: /alerts/add | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Add Alert Failed\" \n  });\n} else {\n  var currentAlerts = cti.store.variables.selected_visit.patientData.alerts;\n  \n  if($data.$response.data != undefined) {\n    if($data.$response.data.patientAlerts != undefined) {\n      if($data.$response.data.patientAlerts.patientAlert != undefined) {\n        if($data.$response.data.patientAlerts.patientAlert instanceof Array) {\n          currentAlerts = $data.$response.data.patientAlerts.patientAlert;\n        } else {\n          currentAlerts = [];\n          currentAlerts.push($data.$response.data.patientAlerts.patientAlert);\n        }\n        \n        var displayAlerts = JSON.parse(JSON.stringify(currentAlerts));\n        for (var i = displayAlerts.length; i-- > 0;) {\n          var thisAlert = displayAlerts[i];\n\n          if (thisAlert.removalDate) {\n            displayAlerts.splice(i, 1);\n          }\n        }\n\n        // Set open alerts temp variable in the store\n        cti.store.variables.filter = \"open\";\n        cti.store.variables.selected_visit.patientData.displayAlerts = displayAlerts;\n        \n        currentAlerts.sort(function(a, b) {\n          return a.date > b.date ? -1 : a.date < b.date ? 1 : 0;\n        });\n        \n        // Update patient alerts\n        cti.store.variables.selected_visit.patientData.alerts = currentAlerts; \n        \n        // Refresh timeline\n        cti.fn_prep_timeline();\n      }\n    }\n  }\n  console.log(\"API CALL: /alerts/add | SUCCESS\");\n}\n\ndelete cti.store.variables.v_alertToAdd;\ncti.fn_toggle_spinner('close', '', 1500);\n$success();"},"_auto_id_":"bfebc6ac-0ba5-4e3c-9ae6-62754c38de26"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"debugger;\nvar response = $data.$response;\n\ncti.utils.callAction(\n  \"show-notification\", {\n    \"name\": \"notification_error\",\n    \"title\": \"Server Error\",\n    \"text\": response.message || \"Unable to connect to the server\"\n  }\n);\n\ndelete cti.store.variables.v_alertToAdd;\ncti.fn_toggle_spinner('close', '', 1500);\n$success();"},"_auto_id_":"819ef463-70ab-493b-970d-faf5ebb7f869"}]},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"2005c0af-a17f-402a-9de4-bbec9f8cc0d6"}],"name":"AddAlert"},{"content":[{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getbookingrefdata","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"462d6cd5-9de5-4d4d-952a-9ced95b05491","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  // GetBookingRefData status set to failed: false\n  cti.store.variables.getBookingRefDataStatus = false;\n  \n  cti.fn_toggle_spinner('close');\n  \n  console.log(\"API CALL: /staticdata/appointmentbookingreferencedata | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server connection errror\" , \n    \"text\" : \"Unable to retrieve Booking Reference data.\"\n  });\n} else {\n  // GetBookingRefData status set to success: true\n  cti.store.variables.getBookingRefDataStatus = true;\n  \n  console.log(\"API CALL: /staticdata/appointmentbookingreferencedata| SUCCESS\");\n  delete cti.store.variables.v_alertToAdd;\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"GetDiaryTemplate\" });\n  $success();\n}"},"_auto_id_":"46308b98-8695-4fde-b069-691af44c034f"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetBookingRefData status set to failed: false\ncti.store.variables.getBookingRefDataStatus = false;\n\ncti.fn_toggle_spinner('close');\n\nconsole.log(\"API CALL: /staticdata/appointmentbookingreferencedata | FAILED\");\nconsole.log(\"API FAILURE: \" + $data.$response.message);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server connection errror\" , \n  \"text\" : \"Unable to connect to server.\"\n});\n\n$success();"},"_auto_id_":"3e046bd2-ec0a-407a-b0c9-5c32aa6e7db7"}]}],"name":"GetBookingRefData"},{"content":[{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"diarytemplate","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"a293c477-6199-4100-bad2-652487bb877c","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  // GetDiaryTemplate status set to failed: false\n  cti.store.variables.getDiaryTemplateStatus = false;\n  \n  cti.fn_toggle_spinner('close');\n  \n  console.log(\"API CALL: /staticdata/diarytemplate | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Unable to get Diary Template data.\"\n  });\n} else {\n  // GetDiaryTemplate status set to success: true\n  cti.store.variables.getDiaryTemplateStatus = true;\n  \n  console.log(\"API CALL: /staticdata/diarytemplate | SUCCESS\");\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetTeamRefData\" });\n\n  // Organise the diary template(s) for app usage.\n  cti.fn_normalise_diary_templ($data.$response.data)\n\n  $success();\n}"},"_auto_id_":"91bfc811-0e81-4852-803c-fcd8ef440074","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetDiaryTemplate status set to failed: false\ncti.store.variables.getDiaryTemplateStatus = false;\n\ncti.fn_toggle_spinner('close');\n\nconsole.log(\"API CALL: /staticdata/diarytemplate | FAILED\");\nconsole.log(\"API FAILURE: \" + $data.$response.message);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to connect to server.\"\n});\n\n$success();"},"_auto_id_":"40de3259-fe96-419f-9526-8bf8d0e9c06e","actions":[]}]}],"name":"GetDiaryTemplate"},{"content":[{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"teamplannerreferencedata","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","teams":"{{$store.api.api_rio.authenticate.profile.userProfile.teams.team}}"}},"_auto_id_":"e0960e3b-e765-4cad-90e2-1639deacf44a","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  // GetTeamRefData status set to failed: false\n  cti.store.variables.getTeamRefDataStatus = false;\n  \n  cti.fn_toggle_spinner('close');\n\n  console.log(\"API CALL: /staticdata/teamplannerreferencedata | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Unable to get Team Planner Reference data.\"\n  });\n} else {\n  // GetTeamRefData status set to success: true\n  cti.store.variables.getTeamRefDataStatus = true;\n  \n  console.log(\"API CALL: /staticdata/teamplannerreferencedata | SUCCESS\");\n  cti.store.variables.b_autoSync = true;\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"GetVisitList\" });\n  $success();\n}"},"_auto_id_":"569e21d0-5886-4832-91bd-a0c7e35b73db"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetTeamRefData status set to failed: false\ncti.store.variables.getTeamRefDataStatus = false;\n\ncti.fn_toggle_spinner('close');\n\nconsole.log(\"API CALL: /staticdata/teamplannerreferencedata | FAILED\");\nconsole.log(\"API FAILURE: \" + $data.$response.message);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to connect to server.\"\n});\n\n$success();"},"_auto_id_":"308a80ee-58fe-4ed5-9547-8e9c4440b2b0"}]}],"name":"GetTeamRefData"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n  appointmentDetails : {\n    appointmentDateTime: null,\n    appointmentType: null,\n    authorId: null,\n    bookedDateTime: null,\n    comment: null,\n    healthcareProfessional: null,\n    intendedDuration: null,\n    location: null,\n    isNonClientAppointment: false\n  },\n  appointmentContacts: []\n}\n\n// Add to appointmentDetails\npayload.appointmentDetails.appointmentDateTime = moment(cti.store.pages.HCP_Diary.date_planner).format('YYYY-MM-DD HH:mm:ssZZ');\npayload.appointmentDetails.appointmentType = cti.store.pages.HCP_Diary.select_type.value\npayload.appointmentDetails.bookedDateTime = moment().format('YYYY-MM-DD HH:mm:ssZZ')\npayload.appointmentDetails.comment = cti.store.pages.HCP_Diary.text_comment\npayload.appointmentDetails.healthcareProfessional = cti.store.pages.Login.username\npayload.appointmentDetails.intendedDuration = cti.store.pages.HCP_Diary.select_intended_duration.value\npayload.appointmentDetails.location = cti.store.pages.HCP_Diary.select_location.value\n\nif(cti.store.pages.HCP_Diary.switch_non_client != undefined) {\n  payload.appointmentDetails.isNonClientAppointment = cti.store.pages.HCP_Diary.switch_non_client\n}\n\n//Add to appointmentContacts\n\nvar addContact = function() {\n  let contact = {\n    activities : {\n    \tstring: []\n  \t},\n    clientId : null,\n    comment : null,\n    faceToFace : null,\n    interpreterComment : null,\n    interpreterLanguage : null,\n    interpreterStatus : null,\n    isNonClientAppointment : null,\n    proxyContact : null,\n    referralId : null,\n    transportComment : null,\n    transportStatus : null,\n    proxyContact : null,\n  }\n  contact.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId\n  \n  if(cti.store.pages.HCP_Diary.contact_comment != undefined) {\n    contact.comment = cti.store.pages.HCP_Diary.contact_comment;\n  }\n  if(cti.store.pages.HCP_Diary.switch_f2f_contact != undefined) {\n    contact.faceToFace = cti.store.pages.HCP_Diary.switch_f2f_contact\n  }\n  if(cti.store.pages.HCP_Diary.interpreter_comment != undefined) {\n    contact.interpreterComment = cti.store.pages.HCP_Diary.interpreter_comment\n  }\n  if(cti.store.pages.HCP_Diary.select_interpret_language != undefined) {\n    if(cti.store.pages.HCP_Diary.select_interpret_language.value != undefined) {\n      contact.interpreterLanguage = cti.store.pages.HCP_Diary.select_interpret_language.value\n    }\n  }\n  if(cti.store.pages.HCP_Diary.select_interpret_required != undefined) {\n    if(cti.store.pages.HCP_Diary.select_interpret_required.value != undefined) {\n      contact.interpreterStatus = cti.store.pages.HCP_Diary.select_interpret_required.value\n    }\n  }\n  if(cti.store.pages.HCP_Diary.switch_non_client != undefined) {\n    contact.isNonClientAppointment = cti.store.pages.HCP_Diary.switch_non_client\n  }\n  if(cti.store.pages.HCP_Diary.switch_proxy_contact != undefined) {\n    contact.proxyContact = cti.store.pages.HCP_Diary.switch_proxy_contact\n  }\n  if(cti.store.pages.HCP_Diary.transport_comment != undefined) {\n    contact.transportComment = cti.store.pages.HCP_Diary.transport_comment\n  }\n  if(cti.store.pages.HCP_Diary.select_transport_required != undefined) {\n    if(cti.store.pages.HCP_Diary.select_transport_required.value != undefined) {\n      contact.transportStatus = cti.store.pages.HCP_Diary.select_transport_required.value\n    }\n  }\n\n  contact.referralId = cti.store.variables.selected_visit.attendees.attendee.referral.referralId\n  \n  cti.store.repeater.HCP_Diary.group_activities.forEach(function(a) {\n    contact.activities.string.push(a.activity.value)\n  })\n\n  payload.appointmentContacts.push(contact)\n}\n\naddContact()\n\ncti.store.variables.v_appointmentToAdd = payload\ncti.store.variables.v_appointmentToAdd_clear = true\n\n$success()"},"_auto_id_":"53614c39-d1cb-4f1d-9405-a82c92b203c5","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addHCPAppointment","params":{"payload":"$store.variables.v_appointmentToAdd","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"66207c8c-c850-4aec-8168-e74ac0c5ecf8","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"debugger;\nconsole.log('AddHCPAppointment: Success', $data)\n\n$success()"},"_auto_id_":"336210f0-d3a1-42cc-a746-131b2bc89f6a"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"console.log('AddHCPAppointment: Fail', $data)\n\n$success()"},"_auto_id_":"5c253ebd-8857-434f-8d14-b654cf9990c5"}]}],"name":"AddHCPAppointment"},{"content":[{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"setappointmenteta","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","appointmentId":"{{$store.variables.appointments[$store.variables.v_selectedRowIndex].appointmentId}}","eta":"{{$store.variables.appointments[$store.variables.v_selectedRowIndex].appointmentEta}}"}},"_auto_id_":"874f360a-2118-4bbd-bb12-b70a48c29c49","actions":[{"event":"fail","type":"show-notification","data":{"options":{"schedule":false,"dynamic":true},"name":"notification_error","title":"Server Connection Error","text":"Unable to connect to the server"},"_auto_id_":"8184cfcd-d9ff-43ad-adb5-c1db8905a44f"},{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  \n    console.log(\"API CALL: /sendappointmenteta | FAILED\");\n  \tconsole.log(\"API FAILURE: \" + $data.$response.message);\n    cti.utils.callAction(\"show-notification\", {\"name\": \"notification_error\", \"title\" : \"Server Connection Error\", \"text\" : \"Unable to send appointment ETA\"});\n                                               \n}\nelse{\n    console.log(\"API CALL: /sendappointmenteta | SUCCESS\");\n  \t$success();\n}"},"_auto_id_":"6fa4deaa-91e5-4caf-9de8-b3fe25ea79c5"},{"event":"success","type":"call-component-function","data":{"page":"Visits","componentInstanceId":"1b59cf67-5dcf-4c48-8edd-6412937642aa","function":"toggle","params":{"containerid":"scrollable"}},"_auto_id_":"72fa6725-a37a-4fb9-9b78-cde8f0458ba5"}]}],"name":"SendAppointmentETA"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('open', 'Submitting Progress Note...');\n\nvar payload = {\n  clientId: {},\n  noteDateTime : null,\n  noteText : null,\n  noteType: null,\n  validatedNote: null,\n  subNoteType : null,\n  specialty : null,\n  riskType : null,\n  isSignificantEvent : null,\n  isThirdParty : null,\n  isClientConceal : null,\n  document : null,\n  documentName : null,\n  documentType : null\n}\n\npayload.clientId.type = cti.store.variables.selected_visit.patientData.demographics.clientId.type;\npayload.clientId.value = cti.store.variables.selected_visit.patientData.demographics.clientId.value; \npayload.noteDateTime = moment().format(\"YYYY-MM-DD HH:mm:ss\");\npayload.noteText = cti.store.pages.Note.noteText;\ncti.store.api.api_rio.getnoteconfig.data.progressNoteConfiguration.validatedByDefault == \"1\" ? payload.validatedNote = true : payload.validatedNote = false;\n\nif(cti.store.pages.Note.noteType) {\n  payload.noteType = cti.store.pages.Note.noteType.value;\n}\n\nif(cti.store.pages.Note.subType) {\n  payload.subNoteType  = cti.store.pages.Note.subType.value;\n} \n\nif(cti.store.pages.Note.specialty != undefined) {\n  payload.specialty = cti.store.pages.Note.specialty.value;\n}\n\n/* TODO: Implement when fixed\nif(cti.store.pages.Note.list_riskType != undefined) {\n  var riskTypes = [];\n  for(var i in cti.store.pages.Note.list_riskType) {\n    riskTypes.push(cti.store.pages.Note.list_riskType[i].order.direction);\n  }\n  payload.riskTypes = riskTypes;\n}\n*/\n\nif(cti.store.pages.Note.flagSignificantEvent) {\n  payload.isSignificantEvent = cti.store.pages.Note.flagSignificantEvent;\n}\n\nif(cti.store.pages.Note.flagThirdParty) {\n  payload.isThirdParty = cti.store.pages.Note.flagThirdParty;\n}\n\nif(cti.store.pages.Note.flagClientConceal) {\n  payload.isClientConceal = cti.store.pages.Note.flagClientConceal;\n}\n\nif(cti.store.pages.Note.Document != undefined) {\n  payload.document = cti.store.pages.Note.Document;\n  payload.documentName = cti.store.pages.Note.documentName;\n  payload.documentType = cti.store.pages.Note.documentType;\n}\n\ncti.store.variables.v_progressNoteToAdd = payload;\ncti.store.variables.v_progressNoteToAdd_clear = true;\n\n$success();"},"_auto_id_":"c08771e0-a782-40bc-bf73-311db253b348","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addprogressnote","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_progressNoteToAdd}}"}},"_auto_id_":"f635d880-9cd2-42ca-a42e-96866bf4f996","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"//AddProgressNote actionflow\ndebugger;\nif(!$data.$response.success){\n  console.log(\"API CALL: /addprogressnote | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Add Progress Note Failed\"\n  });\n} else {\n  var currentNotes = cti.store.variables.selected_visit.patientData.progressNotes;\n  \n  if($data.$response.data != undefined) {\n    if($data.$response.data.progressNotes != undefined) {\n      if($data.$response.data.progressNotes.progressNote != undefined) {\n        if($data.$response.data.progressNotes.progressNote instanceof Array) {\n          currentNotes = $data.$response.data.progressNotes.progressNote;\n        } else {\n          currentNotes = [];\n          currentNotes.push($data.$response.data.progressNotes.progressNote);\n        }\n        \n        // Update patient notes\n        cti.store.variables.selected_visit.patientData.progressNotes = currentNotes;\n   \n        // Refresh timeline\n        cti.fn_prep_timeline();\n      }\n    }\n  }\n  console.log(\"API CALL: /addprogressnote | SUCCESS\");\n}\n\ndelete cti.store.variables.v_progressNoteToAdd;\ncti.fn_toggle_spinner('close', '', 1500);\n$success();"},"_auto_id_":"f83d72d4-cf33-402a-b7e9-66a928707875","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"debugger;\nvar response = $data.$response;\n\nconsole.log(\"API CALL: /addprogressnote | FAILED\");\nconsole.log(\"API FAILURE: \" + response.message);\n\ncti.utils.callAction(\n  \"show-notification\", {\n    \"name\": \"notification_error\",\n    \"title\": \"Server Error\",\n    \"text\": response.message || \"Unable to connect to the server\"\n  }\n);\n\ndelete cti.store.variables.v_progressNoteToAdd;\ncti.fn_toggle_spinner('close', '', 1500);\n$success();"},"_auto_id_":"992d356d-9ded-4bf8-8b6b-2dde3183e493","actions":[]}]},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"4ece0a9f-c6ba-4368-b967-7b9747f51336"}],"name":"AddProgressNote"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"/* var payload = {\n    fromDate : moment().format(\"YYYY-MM-DD\"),\n    toDate : moment().add(4, 'weeks').format(\"YYYY-MM-DD\")                               \n}; */\n\n//cti.store.variables.v_busySlots_fromDate = moment().format(\"YYYY-MM-DD\");\ncti.store.variables.v_busySlots_fromDate = \"2017-09-02\";\ncti.store.variables.v_busySlots_toDate = moment().add(4, 'weeks').format(\"YYYY-MM-DD\");\n\n$success();"},"_auto_id_":"69604531-ec43-4455-abb3-d4a63d0f0e95","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"busydiaryslots","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_busySlots_fromDate}}","toDate":"{{$store.variables.v_busySlots_toDate}}","fromDate":"{{$store.variables.v_busySlots_fromDate}}"}},"_auto_id_":"7ad986aa-7469-48f3-971e-64d82e7225bf","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('close');\n\nif(!$data.$response.success){\n  // GetBusyDiarySlots status set to failed: false\n  cti.store.variables.getBusyDiarySlotsStatus = false;\n  \n  console.log(\"API CALL: /bookings/busydiaryslots | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Get Busy Diary Slots Failed.\"\n  });\n} else {\n  // GetBusyDiarySlots status set to success: true\n  cti.store.variables.getBusyDiarySlotsStatus = true;\n  \n  console.log(\"API CALL: /bookings/busydiaryslots | SUCCESS\");\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"Login\" });\n  $success();\n}\n\ndelete cti.store.variables.v_busySlots_fromDate;\ndelete cti.store.variables.v_busySlots_toDate;"},"_auto_id_":"7a7a9362-e239-4675-b05d-68f5341ed47e"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetBusyDiarySlots status set to failed: false\ncti.store.variables.getBusyDiarySlotsStatus = false;\n\ncti.fn_toggle_spinner('close');\n\nconsole.log(\"API CALL: /bookings/busydiaryslots | FAILED\");\nconsole.log(\"API FAILURE: \" + $data.$response.message);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to connect to server.\"\n});\n\n$success();\n\ndelete cti.store.variables.v_busySlots_fromDate;\ndelete cti.store.variables.v_busySlots_toDate;"},"_auto_id_":"3084b628-1882-4ce5-b5e3-9fbc6a8c5421"}]}],"name":"GetBusyDiarySlots"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n\tclientId: {},\n}\ndebugger;\npayload.clientId.type = cti.store.variables.selected_visit.patientData.demographics.clientId.type;\npayload.clientId.value = cti.store.variables.selected_visit.patientData.demographics.clientId.value;  \n                       \ncti.store.variables.v_alertsGet = payload;\n\n$success();"},"_auto_id_":"ff816a5e-f3b0-4781-b57d-d9405e4e853d","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"getalerts","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_alertsGet}}"}},"_auto_id_":"2bae3049-22db-458d-87f0-20bbf76bf890","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  console.log(\"API CALL: /alerts | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Get Alerts Failed: \" +  $data.$response.message\n  });\n} else {\n  //var currentAppointmentId = cti.store.variables.selected_visit.appointmentId;\n  var currentAlerts = cti.store.variables.selected_visit.patientData.alerts;\n  //var alerts = cti.store.variables.v_selectedDayAppointments;\n  \n  if($data.$response.data != undefined) {\n    if($data.$response.data.patientAlerts != undefined) {\n      if($data.$response.data.patientAlerts.patientAlert != undefined) {\n        if($data.$response.data.patientAlerts.patientAlert instanceof Array) {\n          currentAlerts = $data.$response.data.patientAlerts.patientAlert;\n        } else {\n          currentAlerts = [];\n          currentAlerts.push($data.$response.data.patientAlerts.patientAlert);\n        }\n        \n        var displayAlerts = JSON.parse(JSON.stringify(currentAlerts));\n        for (var i = displayAlerts.length; i-- > 0;) {\n          var thisAlert = displayAlerts[i];\n\n          if (thisAlert.removalDate) {\n            displayAlerts.splice(i, 1);\n          }\n        }\n\n        // Set open alerts temp variable in the store\n        cti.store.variables.filter = \"open\";\n        cti.store.variables.selected_visit.patientData.displayAlerts = displayAlerts;\n        \n        currentAlerts.sort(function(a, b) {\n          return a.date > b.date ? -1 : a.date < b.date ? 1 : 0;\n        });\n        \n        // Update patient alerts\n        cti.store.variables.selected_visit.patientData.alerts = currentAlerts; \n        \n        // Refresh timeline\n        cti.fn_prep_timeline();\n      }\n    }\n  }\n  console.log(\"API CALL: /alerts | SUCCESS\");\n}\n\ndelete cti.store.variables.v_alertsGet;\ncti.utils.updatePage();\n$success();"},"_auto_id_":"6b08dd62-8dbf-4671-aed9-a884f06cf8f3"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"debugger;\nvar response = $data.$response;\n\ncti.utils.callAction(\n  \"show-notification\", {\n    \"name\": \"notification_error\",\n    \"title\": \"Server Error\",\n    \"text\": response.message || \"Unable to connect to the server\"\n  }\n);\n\ndelete cti.store.variables.v_alertToAdd;\n\ncti.utils.destroyPageData('Alert');\n$success();"},"_auto_id_":"30565119-6bc7-45ee-a12a-d7e9ae6d1c43"}]}],"name":"GetAlerts"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n  \"userId\" : {\n    \"type\": \"SDS\",\n    \"value\": cti.store.pages.Login.username\n  },\n  \"roleId\" : \"R8000\"\n};\n\ncti.store.variables.v_progressNoteConfig = payload;\n\n$success();"},"_auto_id_":"05341563-f352-4f9a-99c7-98f0f66e187c"},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getnoteconfig","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_progressNoteConfig}}"}},"_auto_id_":"b19f3c09-856b-4c3a-9a72-d84e151343b7","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  // GetNoteConfig status set to failed: false\n  cti.store.variables.getNoteConfigStatus = false;\n  \n  cti.fn_toggle_spinner('close');\n  \n  console.log(\"API CALL: /getprogressnoteconfiguration | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\" , \n    \"text\" : \"Unable to retrieve Progress Note Configuration data.\"\n  });\n} else {\n  // GetNoteConfig status set to success: true\n  cti.store.variables.getNoteConfigStatus = true;\n  \n  console.log(\"API CALL: /getprogressnoteconfiguration | SUCCESS\");\n  \n  delete cti.store.variables.v_progressNoteConfig;\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"GetNoteTypes\" });\n  $success();\n}"},"_auto_id_":"29f72bb4-2716-408d-984d-7da41c2a50ee"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetNoteConfig status set to failed: false\ncti.store.variables.getNoteConfigStatus = false;\n\ncti.fn_toggle_spinner('close');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\" , \n  \"text\" : \"Unable to connect to server.\"\n});\n\n$success();"},"_auto_id_":"0e4776a4-1f0d-4428-97f2-06dac80162a2"}]}],"name":"GetNoteConfig"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n  \"userId\" : {\n    \"type\": \"SDS\",\n    \"value\": cti.store.pages.Login.username\n  },\n  \"roleId\" : \"R8000\"\n};\n\ncti.store.variables.v_progressNoteTypes = payload;\n\n$success();"},"_auto_id_":"69467062-b25b-4efe-93d5-0a8e7253037b","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getnotetypes","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_progressNoteTypes}}"}},"_auto_id_":"a6ffecaa-1d13-42ab-a2f7-25a69aee1284","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  // GetNoteTypes status set to failed: false\n  cti.store.variables.getNoteTypesStatus = false;\n  \n  cti.fn_toggle_spinner('close');\n  \n  console.log(\"API CALL: /getprogressnotetypes | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\" , \n    \"text\" : \"Unable to retrieve Progress Note Types data.\"\n  });\n} else {\n  // GetNoteTypes status set to success: true\n  cti.store.variables.getNoteTypesStatus = true;\n  \n  console.log(\"API CALL: /getprogressnotetypes | SUCCESS\");\n  \n  delete cti.store.variables.v_progressNoteTypes;\n\n  var notes = cti.store.api.api_rio.getnotetypes.data.progressNoteTypes.progressNoteType;\n  var noteTypes = [];\n  var subNoteTypes = [];\n  \n  for(var i in notes) {\n    var thisNote = notes[i];\n    \n    if(noteTypes.length === 0) {\n      var subNote = thisNote.subNoteType;\n      thisNote.subNoteType = [];\n      \n      if(subNote != null || subNote != undefined) {\n      \tthisNote.subNoteType.push(subNote);\n      }\n    \n      thisNote.code = thisNote.noteType.code;\n      thisNote.value = thisNote.noteType.value;\n      delete thisNote.noteType;\n      \n      noteTypes.push(thisNote);\n    } else {\n      var newNote = true;\n      for(var x in noteTypes) {\n      \tif(thisNote.noteType.value === noteTypes[x].value) {\n          var subNote = thisNote.subNoteType;\n          noteTypes[x].isSubNoteType = \"1\";\n          noteTypes[x].subNoteType.push(subNote);\n          newNote = false;\n          break;\n        }\n      }\n      \n      if(newNote) {\n        var subNote = thisNote.subNoteType;\n        thisNote.subNoteType = [];\n        \n        if(subNote != null || subNote != undefined) {\n          thisNote.subNoteType.push(subNote);\n        }\n        \n        thisNote.code = thisNote.noteType.code;\n      \tthisNote.value = thisNote.noteType.value;\n        delete thisNote.noteType;\n\n        noteTypes.push(thisNote);\n      }\n    }\n  }\n  \n  cti.store.api.api_rio.getnotetypes.data.progressNoteTypes.uiNoteTypes = noteTypes;\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"GetNoteSpecialites\" });\n  $success();\n}"},"_auto_id_":"f6cc7f53-0354-4934-97ae-08cdc1eeee7b"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetNoteTypes status set to failed: false\ncti.store.variables.getNoteTypesStatus = false;\n\ncti.fn_toggle_spinner('close');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\" , \n  \"text\" : \"Unable to connect to server.\"\n});\n$success();"},"_auto_id_":"35e6ffd6-51ce-4e1b-b6b1-a9a1f9ef6b62"}]}],"name":"GetNoteTypes"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n  \"hcpId\" : {\n    \"type\": \"SDS\",\n    \"value\": cti.store.pages.Login.username\n  }\n};\n\ncti.store.variables.v_progressNoteSpecialites = payload;\n\n$success();"},"_auto_id_":"77870c1f-a5ce-41e6-87d1-9330f7649e4c"},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getnotespecialites","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_progressNoteSpecialites}}"}},"_auto_id_":"6ee6e18b-bf05-4a0b-ab4a-25d0d02dfcec","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  // GetNoteSpecialites status set to failed: false\n  cti.store.variables.getNoteSpecialitesStatus = false;\n  \n  cti.fn_toggle_spinner('close');\n  \n  console.log(\"API CALL: /getprogressnotespecialites | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\" , \n    \"text\" : \"Unable to retrieve Progress Note Specialites data.\"\n  });\n} else {\n  // GetNoteSpecialites status set to success: true\n  cti.store.variables.getNoteSpecialitesStatus = true;\n  \n  console.log(\"API CALL: /getprogressnotespecialites | SUCCESS\");\n  delete cti.store.variables.v_progressNoteSpecialites;\n  \n  var userSpecialties = cti.store.api.api_rio.getnotespecialites.data.userSpecialties.userSpecialty;\n  var array = [];\n  \n  for(var i in userSpecialties) {\n    var obj = {\n      \"isPrimary\" : userSpecialties[i].isPrimary,\n      \"hasWriteAccess\" : userSpecialties[i].hasWriteAccess,\n      \"code\" : userSpecialties[i].specialty.code,\n      \"value\" : userSpecialties[i].specialty.value\n    };\n    array.push(obj);\n  }\n  \n  cti.store.api.api_rio.getnotespecialites.data.userSpecialties.userSpecialty = array;\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"GetNoteRiskTypes\" });\n  $success();\n}"},"_auto_id_":"f05ebd18-532b-437f-8407-691b953bf48d","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetNoteSpecialites status set to failed: false\ncti.store.variables.getNoteSpecialitesStatus = false;\n\ncti.fn_toggle_spinner('close');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\" , \n  \"text\" : \"Unable to connect to server.\"\n});\n\n$success();"},"_auto_id_":"c167730e-6dae-4b7f-b3d8-d60c4dd3b1fa"}]}],"name":"GetNoteSpecialites"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n  \"hcpId\" : {\n    \"type\": \"SDS\",\n    \"value\": cti.store.pages.Login.username\n  }\n};\n\ncti.store.variables.v_progressNoteRiskTypes = payload;\n\n$success();"},"_auto_id_":"8bbf1a08-8809-43ab-b76b-c6530abeb61f"},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getnoterisktypes","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_progressNoteRiskTypes}}"}},"_auto_id_":"de322761-932d-4127-bc5c-82139d01dfea","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  // GetNoteRiskTypes status set to failed: false\n  cti.store.variables.getNoteRiskTypesStatus = false;\n  \n  cti.fn_toggle_spinner('close');\n  \n  console.log(\"API CALL: /getprogressnoterisktypes | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\" , \n    \"text\" : \"Unable to retrieve Progress Note Risk Types data.\"\n  });\n} else {\n  // GetNoteRiskTypes status set to success: true\n  cti.store.variables.getNoteRiskTypesStatus = true;\n  \n  console.log(\"API CALL: /getprogressnoterisktypes | SUCCESS\");\n  delete cti.store.variables.v_progressNoteRiskTypes;\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"GetBookingRefData\" });\n  $success();\n}"},"_auto_id_":"5836612c-2581-46b6-bae6-f22543a8c159"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"// GetNoteRiskTypes status set to failed: false\ncti.store.variables.getNoteRiskTypesStatus = false;\n\ncti.fn_toggle_spinner('close');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\" , \n  \"text\" : \"Unable to connect to server.\"\n});\n\n$success();"},"_auto_id_":"3f18f851-ae4c-4bcd-a2fc-804fd583a533"}]}],"name":"GetNoteRiskTypes"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"cti.fn_toggle_spinner('open', 'Removing Alert...');\nvar payload = {\n  clientId : {},\n  alertId: null,\n  endDateTime: null,\n  comment: null,\n}\n\npayload.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId\npayload.alertId = cti.store.variables.alertToRemove.id;\npayload.endDateTime = moment(cti.store.pages.RemoveAlert.date).format(\"YYYY-MM-DD\");\npayload.comment = cti.store.pages.RemoveAlert.description;\n                       \ncti.store.variables.v_alertToRemove = payload;\ncti.store.variables.v_alertToRemove_clear = true;\n\n$success();"},"_auto_id_":"a8f3f93d-7ed4-43a6-a996-8a25ba3d605f","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"removealert","params":{"Authorization":"Basic {{$store.variables.auth_header}}","payload":"{{$store.variables.v_alertToRemove}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"51ab6f21-85d1-4f34-ba8b-beb4ef44cbd2","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"//RemoveAlert Actionflow\ndebugger;\nif(!$data.$response.success){\n  console.log(\"API CALL: /alerts/remove | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Remove Alert Failed\" \n  });\n} else {\n  var currentAlerts = cti.store.variables.selected_visit.patientData.alerts;\n  \n  if($data.$response.data != undefined) {\n    if($data.$response.data.patientAlerts != undefined) {\n      if($data.$response.data.patientAlerts.patientAlert != undefined) {\n        if($data.$response.data.patientAlerts.patientAlert instanceof Array) {\n          currentAlerts = $data.$response.data.patientAlerts.patientAlert;\n        } else {\n          currentAlerts = [];\n          currentAlerts.push($data.$response.data.patientAlerts.patientAlert);\n        }\n        \n        var displayAlerts = JSON.parse(JSON.stringify(currentAlerts));\n        for (var i = displayAlerts.length; i-- > 0;) {\n          var thisAlert = displayAlerts[i];\n\n          if (thisAlert.removalDate) {\n            displayAlerts.splice(i, 1);\n          }\n        }\n\n        // Set open alerts temp variable in the store\n        cti.store.variables.filter = \"open\";\n        cti.store.variables.selected_visit.patientData.displayAlerts = displayAlerts;\n        \n        currentAlerts.sort(function(a, b) {\n          return a.date > b.date ? -1 : a.date < b.date ? 1 : 0;\n        });\n        \n        // Update patient alerts\n        cti.store.variables.selected_visit.patientData.alerts = currentAlerts; \n        \n        // Refresh timeline\n        cti.fn_prep_timeline();\n      }\n    }\n  }\n  console.log(\"API CALL: /alerts/remove | SUCCESS\");\n}\n\ndelete cti.store.variables.v_alertToRemove;\ndelete cti.store.variables.alertToRemove;\n\ncti.fn_toggle_spinner('close', '', 1500);\n$success();"},"_auto_id_":"a8b71da1-12a9-454c-a75e-44992746fcda"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response;\n\ncti.utils.callAction(\n  \"show-notification\", {\n    \"name\": \"notification_error\",\n    \"title\": \"Server Error\",\n    \"text\": response.message || \"Unable to connect to the server\"\n  }\n);\n\ndelete cti.store.variables.v_alertToRemove;\ndelete cti.store.variables.alertToRemove;\n\ncti.fn_toggle_spinner('close', '', 1500);\n$success();"},"_auto_id_":"c33af126-f0cb-4b89-ac66-26b092d4662c"}]},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"0d897676-7a73-417c-ab10-fd7e3f5b8d64"}],"name":"RemoveAlert"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n\tclientId: {},\n  \tmaximumNoteAge : 360,\n\tmaximumResultSize : 5\n}\ndebugger;\npayload.clientId.type = cti.store.variables.selected_visit.patientData.demographics.clientId.type;\npayload.clientId.value = cti.store.variables.selected_visit.patientData.demographics.clientId.value;  \n                       \ncti.store.variables.v_notesToGet = payload;\n\n$success();"},"_auto_id_":"6644d004-9cb1-4dd8-80c8-495fde2e9fae","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"getprogressnotes","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_notesToGet}}"}},"_auto_id_":"37ecd326-dde1-4cbe-87be-c05eb813ca3d","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"debugger;\nif(!$data.$response.success){\n  console.log(\"API CALL: /getprogressnotes | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Get Progress Notes Failed: \" +  $data.$response.message\n  });\n} else {\n  //var currentAppointmentId = cti.store.variables.selected_visit.appointmentId;\n  var currentNotes = cti.store.variables.selected_visit.patientData.progressNotes;\n  //var notes = cti.store.variables.v_selectedDayAppointments;\n  \n  if($data.$response.data != undefined) {\n    if($data.$response.data.progressNotes != undefined) {\n      if($data.$response.data.progressNotes.progressNote != undefined) {\n        if($data.$response.data.progressNotes.progressNote instanceof Array) {\n          currentNotes = $data.$response.data.progressNotes.progressNote;\n        } else {\n          currentNotes = [];\n          currentNotes.push($data.$response.data.progressNotes.progressNote);\n        }\n        \n        //for(var i in notes) {\n        //  if(notes[i].appointmentId === currentAppointmentId) {\n        //    notes[i].patientData.progressNotes = $data.$response.data.progressNotes.progressNote;\n        //    break;\n        //  }\n        //}\n        \n        // Update patient notes\n        cti.store.variables.selected_visit.patientData.progressNotes = currentNotes;\n   \n        // Refresh timeline\n        cti.fn_prep_timeline();\n      }\n    }\n  }\n  \n  console.log(\"API CALL: /getprogressnotes | SUCCESS\");\n}\n\ndelete cti.store.variables.v_notesToGet;\ncti.utils.updatePage();\n$success();"},"_auto_id_":"7f2e9173-aca5-43d6-a8d7-e9b40f89a90d"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var response = $data.$response;\ndebugger;\ncti.utils.callAction(\n  \"show-notification\", {\n    \"name\": \"notification_error\",\n    \"title\": \"Server Error\",\n    \"text\": response.message || \"Unable to connect to the server\"\n  }\n);\n\ndelete cti.store.variables.v_notesToGet;\n\ncti.utils.updatePage();\n$success();"},"_auto_id_":"a82cb052-9df3-4b9b-bbb0-3e637b0bcf6f"}]}],"name":"GetProgressNotes"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"var payload = {\n    \"appointmentBooking\": {\n        \"clientId\": {},\n        \"teamId\": null,\n        \"date\": null,\n        \"referralId\": null,\n        \"activities\": {\n            \"string\": []\n        },\n        \"comment\": null,\n        \"bookRepeatAppointments\": null,\n        \"repeatType\": null,\n        \"numberOfRepeats\": null,\n        \"repeatInterval\": null,\n        \"weekDays\": null,\n        \"dateOfMonth\": null,\n        \"monthOfYear\": null,\n        \"weekInMonth\": null,\n        \"authorId\": null\n    }\n}\n\nvar activities = cti.store.repeater.Team_Planner.group_activities;\nvar newActivities = [];\n\nfor (var i in activities) {\n    newActivities.push(activities[i].activity.value);\n}\n\npayload.appointmentBooking.clientId = cti.store.variables.selected_visit.patientData.demographics.clientId;\npayload.appointmentBooking.teamId = cti.store.pages.Team_Planner.select_team.value;\npayload.appointmentBooking.date = cti.store.pages.Team_Planner.date_planner;\npayload.appointmentBooking.referralId = cti.store.pages.Team_Planner.select_referral.value;\npayload.appointmentBooking.activities.string = newActivities;\npayload.appointmentBooking.comment = cti.store.pages.Team_Planner.comments;\n\ncti.store.variables.selected_visit.repeat === undefined ? payload.appointmentBooking.bookRepeatAppointments = false : payload.appointmentBooking.bookRepeatAppointments = true;\n\nif (payload.appointmentBooking.bookRepeatAppointments) {\n    payload.appointmentBooking.repeatType = cti.store.pages.Team_Planner.radio_repeat;\n    payload.appointmentBooking.numberOfRepeats = cti.store.pages.Team_Planner.number_appointments.toString();\n\n    if (payload.appointmentBooking.repeatType === \"Daily\") {\n        if (cti.store.pages.Team_Planner.radio_daily == \"Every weekday\") {\n            payload.appointmentBooking.repeatType = \"WeekDay\";\n        } else {\n            payload.appointmentBooking.repeatInterval = cti.store.pages.Team_Planner.select_daily_interval.value.toString();\n        }\n    } else if (payload.appointmentBooking.repeatType === \"Weekly\") {\n        var p = cti.store.pages.Team_Planner;\n        var bitValue = 0;\n\n        if (p.checkbox_weekly_days[1]) { bitValue += 1; }\n        if (p.checkbox_weekly_days[2]) { bitValue += 2; }\n        if (p.checkbox_weekly_days[3]) { bitValue += 4; }\n        if (p.checkbox_weekly_days[4]) { bitValue += 8; }\n        if (p.checkbox_weekly_days[5]) { bitValue += 16; }\n        if (p.checkbox_weekly_days[6]) { bitValue += 32; }\n        if (p.checkbox_weekly_days[7]) { bitValue += 64; }\n\n        payload.appointmentBooking.weekDays = bitValue.toString();\n        payload.appointmentBooking.repeatInterval = cti.store.pages.Team_Planner.select_weekly_interval.value.toString();\n    } else if (payload.appointmentBooking.repeatType === \"Monthly\") {\n        payload.appointmentBooking.repeatInterval = cti.store.pages.Team_Planner.select_month_interval.value.toString();\n\n        if (cti.store.pages.Team_Planner.select_month_day) {\n            payload.appointmentBooking.dateOfMonth = cti.store.pages.Team_Planner.select_month_day.value.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_weekday) {\n            var p = cti.store.pages.Team_Planner;\n            var day = cti.store.pages.Team_Planner.select_weekday.value;\n            var bitValue = 0;\n\n            if (day == \"1\") { bitValue = 1; }\n            if (day == \"2\") { bitValue = 2; }\n            if (day == \"3\") { bitValue = 4; }\n            if (day == \"4\") { bitValue = 8; }\n            if (day == \"5\") { bitValue = 16; }\n            if (day == \"6\") { bitValue = 32; }\n            if (day == \"7\") { bitValue = 64; }\n\n            payload.appointmentBooking.weekDays = bitValue.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_position) {\n            if (cti.store.pages.Team_Planner.select_position.value == \"First\") {\n                payload.appointmentBooking.weekInMonth = \"1\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Second\") {\n                payload.appointmentBooking.weekInMonth = \"2\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Third\") {\n                payload.appointmentBooking.weekInMonth = \"3\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Fourth\") {\n                payload.appointmentBooking.weekInMonth = \"4\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Last\") {\n                payload.appointmentBooking.weekInMonth = \"5\";\n            }\n        }\n    } else if (payload.appointmentBooking.repeatType === \"Yearly\") {\n        if (cti.store.pages.Team_Planner.select_weekday) {\n            var p = cti.store.pages.Team_Planner;\n            var day = cti.store.pages.Team_Planner.select_weekday.value;\n            var bitValue = 0;\n\n            if (day == \"1\") { bitValue = 1; }\n            if (day == \"2\") { bitValue = 2; }\n            if (day == \"3\") { bitValue = 4; }\n            if (day == \"4\") { bitValue = 8; }\n            if (day == \"5\") { bitValue = 16; }\n            if (day == \"6\") { bitValue = 32; }\n            if (day == \"7\") { bitValue = 64; }\n\n            payload.appointmentBooking.weekDays = bitValue.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_year_month_day) {\n            payload.appointmentBooking.dateOfMonth = cti.store.pages.Team_Planner.select_year_month_day.value.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_month) {\n            payload.appointmentBooking.monthOfYear = cti.store.pages.Team_Planner.select_month.value.toString();\n        }\n\n        if (cti.store.pages.Team_Planner.select_position) {\n            if (cti.store.pages.Team_Planner.select_position.value == \"First\") {\n                payload.appointmentBooking.weekInMonth = \"1\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Second\") {\n                payload.appointmentBooking.weekInMonth = \"2\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Third\") {\n                payload.appointmentBooking.weekInMonth = \"3\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Fourth\") {\n                payload.appointmentBooking.weekInMonth = \"4\";\n            } else if (cti.store.pages.Team_Planner.select_position.value == \"Last\") {\n                payload.appointmentBooking.weekInMonth = \"5\";\n            }\n        }\n    }\n}\n\ncti.store.variables.v_teamplannerToAdd = payload;\ncti.store.variables.v_teamplannerToAdd_clear = payload;\n\n$success();"},"_auto_id_":"4adf7520-504c-41d6-8de0-8091ddd5fbcf","actions":[]},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"addTPAppointment","params":{"applicationkey":"{{$store.schema.metadata.applicationkey}}","Authorization":"Basic {{$store.variables.auth_header}}","payload":"{{$store.variables.v_teamplannerToAdd}}"}},"_auto_id_":"220f5ba3-d1ac-4565-b3f8-669740044861","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success){\n  console.log(\"API CALL: /appointments/teamadd | FAILED\");\n  console.log(\"API FAILURE: \" + $data.$response.message);\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : $data.$response.message || \"Add Team Planner Appointment Failed\"});\n} else {\n  console.log(\"API CALL: /appointments/teamadd | SUCCESS\");\n}\n\ndelete cti.store.variables.v_teamplannerToAdd;\n$success();"},"_auto_id_":"dccd9d7c-87e6-4b51-a8fa-d977e1de6fa0"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"console.log(\"API CALL: /appointments/teamadd | FAILED\");\nconsole.log(\"API FAILURE: \" + $data.$response.message);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : $data.$response.message || \"Add Team Planner Appointment Failed\"\n});\n\n$success();"},"_auto_id_":"098002ca-501b-48be-a307-5f373ceacd99"}]},{"event":"click","type":"go-to-page","data":{"name":"Visit","isConditional":false},"_auto_id_":"686cb6b3-69b8-415d-9261-c349108588d3"}],"name":"AddTPAppointment"},{"content":[{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getdocument","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_documentGetPayload}}"}},"_auto_id_":"b75d952c-7142-47e9-a860-2725a4882b69","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"var response = cti.store.api.api_rio.getdocument;\nvar documentType = cti.store.variables.v_selectedDocument;\n\nif(response.success) {\n  cti.store.variables.v_selectedDocument.base64 = response.data.document.data;\n} else {\n  console.log('Fail');\n}\n\ndelete cti.store.api.api_rio.getdocument;\ncti.fn_toggle_spinner('close');\ncti.utils.callAction(\"go-to-page\", {\"name\":\"Document\"});"},"_auto_id_":"dbf8aa8e-b876-40ee-966a-c191a1d7ce90"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"debugger;\nvar response = cti.store.api.api_rio.getdocument;\nvar documentType = cti.store.variables.v_selectedDocument;\n\ndelete cti.store.variables.v_selectedDocument;\ndelete cti.store.api.api_rio.getdocument;\ncti.fn_toggle_spinner('close');"},"_auto_id_":"1b624afd-dc1d-469e-a6e7-568cc3f9422c"}]}],"name":"GetDocument"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: pushRegister - Sending...', \n  'info'\n);\n\n// Check for a notification token - can't do anything without it...\nif (!$store.notification.token) {\n  window.logManager.consoleLog(\n    'API Call: pushRegister - Notification token does not exist, cannot register for push...', \n    'info'\n  );\n  \n  cti.fn_toggle_spinner('open', 'Downloading Application Data, please wait...');\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n  \n  return false\n}\n\n$success()"},"_auto_id_":"0fe6dcac-b069-484e-8a04-2d13c061363e"},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline_main","operation":"pushRegister","params":{"os":"{{$store.env.platform.name}}","notificationToken":"{{$store.notification.token}}","username":"{{$store.variables.loggedInUser}}","registeredPushId":"{{$store.variables.registeredPushId}}","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"bc1a5eb8-cc29-4250-a763-47b02327c90a","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"if(!$data.$response.success || !$data.$response.response.RegistrationId){\n  cti.fn_toggle_spinner('close');\n  \n  window.logManager.consoleLog(\n    'API Call: pushRegister FAILED - Reason ' + ($data.$response.message || 'No Message'), \n    'error'\n  );\n  \n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\" , \n    \"text\" : \"Unable to register for push notifications.\"\n  });\n} else {\n  window.logManager.consoleLog(\n    'API Call: pushRegister SUCCESS', \n    'info'\n  );\n\n  cti.store.variables.registeredPushId = $data.$response.response.RegistrationId\n  \n  cti.fn_toggle_spinner('open', 'Downloading Application Data, please wait...');\n  cti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n  $success();\n}"},"_auto_id_":"2a1925da-ed28-4de4-91d5-f7d6f091a766","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: pushRegister FAILED - Reason ' + ($data.$response.message || 'No Message'), \n  'error'\n);\n\ncti.fn_toggle_spinner('close');\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\" , \n  \"text\" : \"Unable to connect to server.\"\n});\n\ncti.fn_toggle_spinner('open', 'Downloading Application Data, please wait...');\ncti.utils.callAction(\"call-actionflow\", { name: \"GetStaticData\" });\n\n$success();"},"_auto_id_":"4cf27f52-b85d-41eb-8252-60491ab87b8e"}]}],"name":"RegisterPush"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: push/pushDeregister SUCCESS', \n  'info'\n);\n\n$success()"},"_auto_id_":"caa33fe1-3a33-4b63-9321-67a144d5d5c6"},{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline_main","operation":"pushDeregister","params":{"registeredPushId":"{{$store.variables.registeredPushId}}","tags":"{{$store.variables.temp_user}}","Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"5ee0c5c9-4319-489f-adc6-6638cb27fdb7","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: push/pushDeregister SUCCESS', \n  'info'\n);\n\ncti.store.variables.registeredPushId = ''\ncti.store.variables.temp_user = ''\n\n$success()"},"_auto_id_":"c56fc7ec-db01-4050-8d4b-0da1e3a3b53f"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: push/pushDeregister FAILED - Reason ' + $data.$response.message, \n  'info'\n);"},"_auto_id_":"41559c3f-065f-41b0-99cd-6c361e75153f"}]}],"name":"DeregisterPush"},{"content":[{"event":"click","type":"call-offline-api","data":{"name":"api_rio_offline","operation":"getappointment","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","appointmentId":"{{$store.variables.getAppointmentPayload}}"}},"_auto_id_":"37b1c575-bc4d-4eef-845b-5438b1e88053","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"// GetAppointment Offline API Success Response Function\n// Grab response\ndebugger;\nvar response = $data.$response\nvar appointmentPayload = cti.store.variables.getAppointmentPayload\n\n// If unsuccessful clear down data and process the error message\nif(!response.success) {\n  console.log('::error:: Push Event failed to retrieve appointment ', appointment.appointmentId);\n} else {\n  // Set the appointment we've recieved\n  var app = response.data.appointment\n\n  // Load appointments from pouch\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    // Set the appointments array\n    var appointments = doc.data\n\n    // Check that we have a valid appointment\n    for(var i in appointments) {\n      if(appointments[i].appointmentId == app.appointmentId) {\n        // Update the appointment data with the selected appointment\n        appointments[i].appointmentDateTime = app.appointmentDateTime\n        appointments[i].appointmentId = app.appointmentId\n        appointments[i].appointmentType = app.appointmentType\n        appointments[i].attendees = app.attendees\n        appointments[i].createdAtDateTime = app.createdAtDateTime\n        appointments[i].hasPreviousFirstAppointmentOutcome = app.hasPreviousFirstAppointmentOutcome\n        appointments[i].healthcareProfessional = app.healthcareProfessional\n        appointments[i].intendedDuration = app.intendedDuration\n        appointments[i].location = app.location\n        \n        if(app.patientData) {\n          appointments[i].patientData = app.patientData\n        }\n        break\n      }\n    }\n    var selectedVisit = cti.store.variables.selected_visit\n    \n    if(selectedVisit) {\n      if(selectedVisit.appointmentId === app.appointmentId) {\n      \tselectedVisit.appointmentDateTime = app.appointmentDateTime\n        selectedVisit.appointmentId = app.appointmentId\n        selectedVisit.appointmentType = app.appointmentType\n        selectedVisit.attendees = app.attendees\n        selectedVisit.createdAtDateTime = app.createdAtDateTime\n        selectedVisit.hasPreviousFirstAppointmentOutcome = app.hasPreviousFirstAppointmentOutcome\n        selectedVisit.healthcareProfessional = app.healthcareProfessional\n        selectedVisit.intendedDuration = app.intendedDuration\n        selectedVisit.location = app.location\n        \n        if(app.patientData) {\n          selectedVisit.patientData = app.patientData\n        }\n      }\n    }\n\n    // Update the pouch DB with new data\n    window.pouchManager.saveToDatabase(\"appointments\", appointments, function(rev) {\n      console.log('::info:: Updated appointment '+app.appointmentId+' successfully. Revision: '+rev);\n      // Reset appointments\n      delete cti.store.variables.getAppointmentPayload\n      cti.fn_load_appointments();\n    }, function(reason, e) {\n      console.log('::error:: Failed to update appointment '+app.appointmentId+'. '+reason,e);\n    });\n  }, function (reason, err) {\n    console.log('::error:: Failed to retrieve appointments. '+reason,err);\n  });\n}"},"_auto_id_":"b2ad6dfc-4923-46b9-9e9d-97160ce2abc1"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"debugger;\n// GetAppointment Offline API Fail Response Function\n// Grab response\nvar response = $data.$response\nvar appointmentPayload = cti.store.variables.getAppointmentPayload\n\nconsole.log('::error:: Push Event failed to retrieve appointment ',appointmentPayload.appointmentId);\nconsole.log('::error:: Error message: ', $data.$response);\n\ndelete cti.store.variables.getAppointmentPayload"},"_auto_id_":"fab49cd4-f411-427a-9f3c-1f6798e6651d"}]}],"name":"GetAppointment"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: getstaticdata - Sending...', \n  'info'\n);\n\n$success()"},"_auto_id_":"3cdf3fb8-0521-4e3b-a702-0abe6d8bc64c"},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"getstaticdata","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}"}},"_auto_id_":"304e457a-4f5f-42ed-bda3-921113b5961b","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"var rio_api = cti.store.api.api_rio\nvar response = rio_api.getstaticdata\n\nvar dataObject = {\n  alerttypes : {\n    data : []\n  },\n  alertpriorities : {\n    data : []\n  },\n  getnoteconfig : {\n    data : {\n      progressNoteConfiguration : {}\n    }\n  },\n  getnotetypes : {\n    data : {\n      progressNoteTypes : {\n        uiNoteTypes : []\n      }\n    }\n  },\n  getnotespecialites : {\n    data : {\n      userSpecialties : {\n        userSpecialty : []\n      }\n    }\n  },\n  getnoterisktypes : {\n    data : {\n      riskTypes : {\n        riskType : []\n      }\n    }\n  },\n  getbookingrefdata : {\n    data : {\n      appointmentBookingReferenceData : {}\n    }\n  },\n  diarytemplate : {\n    data : []\n  },\n  teamplannerreferencedata : {\n    data : []\n  },\n  busydiaryslots : {\n    data : []\n  }\n}\n\nif(!response.success) {\n  // GetStaticData status set to failed: false\n  cti.store.variables.getStaticDataStatus = false\n  \n  window.logManager.consoleLog(\n    'API CALL: getstaticdata FAILED - Reason: ' + response.message, \n    'error'\n  );\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\" , \n    \"text\" : \"Unable to retrieve Alert Priorities Reference data.\"\n  });\n  \n  cti.fn_toggle_spinner('close');\n} else {\n  // GetStaticData status set to success: true\n  cti.store.variables.getStaticDataStatus = true;\n\n  if(response.data.alertTypes) {\n    // cti.store.variables.getAlertTypesStatus = true\n    dataObject.alerttypes.data = response.data.alertTypes\n  }\n  if(response.data.alertPriorities) {\n    // cti.store.variables.getAlertPrioritiesStatus = true\n    dataObject.alertpriorities.data = response.data.alertPriorities\n  }\n  if(response.data.progressNoteConfiguration) {\n    // cti.store.variables.getNoteConfigStatus = true\n    dataObject.getnoteconfig.data.progressNoteConfiguration = response.data.progressNoteConfiguration\n  }\n  if(response.data.progressNoteTypes) {\n    // cti.store.variables.getNoteTypesStatus = true\n    dataObject.getnotetypes.data.progressNoteTypes.uiNoteTypes = response.data.progressNoteTypes\n  }\n  if(response.data.userSpecialties) {\n    // cti.store.variables.getNoteSpecialitesStatus = true\n    dataObject.getnotespecialites.data.userSpecialties.userSpecialty = response.data.userSpecialties\n  }\n  if(response.data.riskTypes) {\n    // cti.store.variables.getNoteRiskTypesStatus = true\n    dataObject.getnoterisktypes.data.riskTypes.riskType = response.data.riskTypes\n  }\n  if(response.data.appointmentBookingReferenceData) {\n    // cti.store.variables.getBookingRefDataStatus = true\n    dataObject.getbookingrefdata.data.appointmentBookingReferenceData = response.data.appointmentBookingReferenceData\n  }\n  if(response.data.diaryTemplates) {\n    // cti.store.variables.getDiaryTemplateStatus = true\n    dataObject.diarytemplate.data = response.data.diaryTemplates\n  }\n  if(response.data.teamPlannerData) {\n    // cti.store.variables.getTeamRefDataStatus = true\n    dataObject.teamplannerreferencedata.data = response.data.teamPlannerData\n  }\n  if(response.data.busyDiarySlots) {\n    // cti.store.variables.getBusyDiarySlotsStatus = true\n    dataObject.busydiaryslots.data = response.data.busyDiarySlots\n  }\n\n  dataObject.authenticate = rio_api.authenticate\n  cti.store.api.api_rio = JSON.parse(JSON.stringify(dataObject))\n\n  window.logManager.consoleLog(\n    'API CALL: getstaticdata SUCCESS', \n    'info'\n  );\n  \n  cti.fn_toggle_spinner('close');\n  cti.fn_toggle_spinner('open', 'Fetching Appointments, please wait...');\n  \n  cti.utils.callAction(\"call-actionflow\", { name: \"GetVisitList\" });\n}"},"_auto_id_":"e5a523b3-108b-4f7d-bb2f-0d210ca9ded2"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"var rio_api = cti.store.api.api_rio\nvar response = rio_api.getstaticdata\n\n// GetStaticData status set to failed: false\ncti.store.variables.getStaticDataStatus = false\n\nwindow.logManager.consoleLog(\n  'API CALL: getstaticdata FAILED - Reason: ' + $data.$response.message, \n  'error'\n);\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\" , \n  \"text\" : \"Unable to retrieve Alert Priorities Reference data.\"\n});\n\ncti.fn_toggle_spinner('close');"},"_auto_id_":"b143e28f-7617-4fca-a5f4-a5b5a272d265"}]}],"name":"GetStaticData"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: submitsafetyform - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Submitting My Safety Form, please wait...');\n\ndebugger;\n\n// Set payload\nvar retry = false\nvar payload = {\n    clientId : {},\n    authorId : null,\n    AssessmentDate : \"\",\n    Triggers : \"\",\n    TriggersAP : \"\",\n    Contact : \"\",\n    ContReach : \"\",\n    OutofCrisis : \"\",\n    EarlyWS : \"\",\n    GetWorseAP : \"\",\n    GetWorse : \"\",\n    EarlyWSAP : \"\",\n    Decisions : \"\",\n    AdvDir : \"\",\n    SUAgree : \"\",\n    CrisisNo : \"\"\n}\n\n// check we are not retrying after a failed submission\nfor(var i in cti.store.failedDataRequests) {\n  if(cti.store.failedDataRequests[i].type == \"safetyForm\") {\n    payload = cti.store.failedDataRequests[i].data\n    retry = true\n    break\n  }\n}\n\nif(!retry) {\n  // Set variables for the safety form page, current appointment and\n  // the payload submission object\n  var safetyForm = cti.store.pages.SafetyForm\n  var appointment = cti.store.variables.selected_visit\n\n  // Set the clientId and AssessmentDate elements\n  payload.clientId = appointment.attendees.attendee.clientId\n  payload.AssessmentDate = moment().format('YYYY-MM-DD HH:mm:ss')\n\n  // Check that we have a valid page source\n  if(safetyForm === undefined) {\n      safetyForm = {}\n  }\n\n  // Check the Triggers input element\n  if(safetyForm.sf_triggers) {\n      payload.Triggers = safetyForm.sf_triggers\n  }\n  // Check the Triggers Action Plan input element\n  if(safetyForm.sf_triggers_actionplan) {\n      payload.TriggersAP = safetyForm.sf_triggers_actionplan\n  }\n  // Check the Contact input element\n  if(safetyForm.sf_contact) {\n      payload.Contact = safetyForm.sf_contact\n  }\n  // Check the Contact Reachable input element\n  if(safetyForm.sf_contactreach) {\n      payload.ContReach = safetyForm.sf_contactreach\n  }\n  // Check the Out of Crisis input element\n  if(safetyForm.sf_outofcrisis) {\n    payload.OutofCrisis = safetyForm.sf_outofcrisis\n  }\n  // Check the Early Warning input element\n  if(safetyForm.sf_earlyws) {\n      payload.EarlyWS = safetyForm.sf_earlyws\n  }\n  // Check the Getting Worse input element\n  if(safetyForm.sf_getworse) {\n      payload.GetWorse = safetyForm.sf_getworse\n  }\n  // Check the Getting Worse Action Plan input element\n  if(safetyForm.sf_getworse_actionplan) {\n      payload.GetWorseAP = safetyForm.sf_getworse_actionplan\n  }\n  // Check the Early Warnings Action Plan input element\n  if(safetyForm.sf_earlyws_actionplan) {\n      payload.EarlyWSAP = safetyForm.sf_earlyws_actionplan\n  }\n  // Check the Decisions input element\n  if(safetyForm.sf_assisteddecision) {\n      payload.Decisions = safetyForm.sf_assisteddecision\n  }\n  // Check the Advance Directive boolean\n  if(safetyForm.sf_advancedirective) {\n      payload.AdvDir = \"True\"\n  } else {\n      payload.AdvDir = \"False\"\n  }\n  // Check the Service User Agreed boolean\n  if(safetyForm.sf_serviceuseragreedplan) {\n      payload.SUAgree = \"True\"\n  } else {\n      payload.SUAgree = \"False\"\n  }\n  // Check the Crisis Number input element\n  if(safetyForm.sf_crisisnumber) {\n      payload.CrisisNo = safetyForm.sf_crisisnumber\n  }\n\n  // Set the payload parameter in the store\n  cti.store.variables.v_submitSafetyFormPayload = payload\n}\n\n$success()"},"_auto_id_":"f0f462db-7d94-4ebc-9377-28d53d109ce7","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"submitsafetyform","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_submitSafetyFormPayload}}"}},"_auto_id_":"87ebcde7-661e-432a-886b-205c1f695ea0","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"debugger;\n// Grab response\nvar response = cti.store.api.api_rio.submitsafetyform\n\nif(!response.success) {  \n  cti.fn_toggle_spinner('close')\n\n  window.logManager.consoleLog(\n    'API CALL: submitsafetyform FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Server Connection Error\", \n    \"text\" : \"Unable to submit Safety Form: \" + response.message\n  })\n  \n  cti.store.variables.selected_visit.safety_form_status = \"failed\";\n  cti.store.variables.selected_visit.safety_form_status_text = \"Failed to Upload My Safety Plan, tap to retry...\";\n  \n  var failedObj = {\n    status : \"failed\",\n    type : \"safetyForm\",\n    data : cti.store.variables.v_submitSafetyFormPayload\n  }\n  \n  cti.store.failedDataRequests.push(failedObj)\n  \n  cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n} else {\n  window.logManager.consoleLog(\n    'API CALL: submitsafetyform SUCCESS', \n    'info'\n  )\n  \n  var currentFormLength = cti.store.variables.selected_visit.patientData.mySafetyPlanForms.length\n  \n  if(response.data != undefined && response.data.length >= currentFormLength) {\n    cti.store.variables.selected_visit.patientData.mySafetyPlanForms = response.data\n  }\n  \n  cti.store.variables.selected_visit.safety_form_status = \"complete\";\n  cti.store.variables.selected_visit.safety_form_status_text = \"Completed\";\n  delete cti.store.variables.selected_visit.safety_form_page\n  cti.store.variables.v_submitSafetyFormPayload_clear = true\n\n  cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n  cti.fn_toggle_spinner('close')\n  \n  delete cti.store.variables.v_submitSafetyFormPayload\n}\n\ndelete cti.store.api.api_rio.submitsafetyform"},"_auto_id_":"33a2d600-302b-4fae-acc0-81a8a2540f73","actions":[]},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"debugger;\nvar failedObj = {\n  status : \"failed\",\n  type : \"safetyForm\",\n  data : cti.store.variables.v_submitSafetyFormPayload\n}\ncti.store.failedDataRequests.push(failedObj)\n\nwindow.logManager.consoleLog(\n  'API CALL: submitsafetyform FAILED - Reason: ' + response.message, \n  'error'\n)\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to submit Safety Form: \" + response.message\n})\n\ncti.fn_toggle_spinner('close')\ncti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\ndelete cti.store.api.api_rio.submitsafetyform"},"_auto_id_":"5b9d69e5-49e1-4f82-baca-a55db2c8e99a"}]}],"name":"SubmitSafetyForm"},{"content":[{"event":"click","type":"inline-function","data":{"sync":true,"code":"window.logManager.consoleLog(\n  'API Call: submitdialogForm - Sending...', \n  'info'\n)\n\ncti.fn_toggle_spinner('open', 'Submitting Dialog+ Form, please wait...');\n\ndebugger;\n\n// Set payload\nvar retry = false\nvar payload = {\n\tclientId : {},\n\tauthorId : null,\n\tAssessmentDate : \"\",\n\tMHSkills :  \"\",\n\tSUCap : \"\",\n\tRCYN : \"\",\n\tSUYN : \"\",\n\tMHRecovery : \"\",\n\tMHMatters : \"\",\n\tMHSatActions : \"\",\n\tPHSatActions : \"\",\n\tJSSatActions : \"\",\n\tLASatActions : \"\",\n\tRSSatActions : \"\",\n\tFSSatActions : \"\",\n\tPSSatActions : \"\",\n\tFISatActions : \"\",\n\tCNSatActions : \"\",\n\tSUSatActions : \"\",\n\tMDSatActions : \"\",\n\tPRSatActions : \"\",\n\tMPSatActions : \"\",\n\tJSSatPL : \"\",\n\tPHSatPL : \"\",\n\tACSatPL : \"\",\n\tLASatPL : \"\",\n\tRSSatPL : \"\",\n\tFSSatPL : \"\",\n\tPSSatPL : \"\",\n\tFISatPL : \"\",\n\tSUSatPL : \"\",\n\tCNSatPL : \"\",\n\tMDSatPL : \"\",\n\tPRSatPL : \"\",\n\tMPSatPL : \"\",\n\tMHSat1 : \"\",\n\tACSatActions : \"\",\n\tRevUnplan : \"\",\n\tCareDecUnplan : \"\",\n\tCareDec : \"\",\n\tInCareDec : \"\",\n\tFunded : \"\",\n\tSUDisagree : \"\",\n\tStageTreat : \"\",\n\tStageTreat1 : \"\",\n\tNxtRev : \"\",\n\tS117Comm : \"\",\n\tCarerView : \"\",\n\tMHSatHelp : \"\",\n\tJSSatHelp : \"\",\n\tACSatHelp : \"\",\n\tLASatHelp : \"\",\n\tRSSatHelp : \"\",\n\tFSSatHelp : \"\",\n\tPSSatHelp : \"\",\n\tFISatHelp : \"\",\n\tCNSatHelp : \"\",\n\tSUSatHelp : \"\",\n\tMDSatHelp : \"\",\n\tPRSatHelp : \"\",\n\tMPSatHelp : \"\",\n\tPHSatHelp : \"\",\n\tCPAAttend : [\n    {\n        CPAAttendRow : {\n          Design : \"\",\n          Name : \"\",\n          SentCopy : \"\",\n          YNPresent :  \"\"\n        }\n      }\t\n  ]\n}\n\n// check we are not retrying after a failed submission\nfor(var i in cti.store.failedDataRequests) {\n  if(cti.store.failedDataRequests[i].type == \"dialogForm\") {\n    payload = cti.store.failedDataRequests[i].data\n    retry = true\n    break\n  }\n}\n\nif(!retry) {\n  // Set variables for the safety form page, current appointment and\n  // the payload submission object\n  var dialogForm = cti.store.pages.DialogForm\n  var appointment = cti.store.variables.selected_visit\n\n  // Set the clientId and AssessmentDate elements\n  payload.clientId = appointment.attendees.attendee.clientId\n  payload.AssessmentDate = moment().format('YYYY-MM-DD HH:mm:ss')\n\n  // Check that we have a valid page source\n  if(dialogForm === undefined) {\n    dialogForm = {}\n  }\n\n  if(dialogForm.MHSkills) { payload.MHSkills = dialogForm.MHSkills }\n\n  if(dialogForm.SUCap) { payload.SUCap = dialogForm.SUCap.value }\n\n  if(dialogForm.RCYN) { payload.RCYN = dialogForm.RCYN }\n\n  if(dialogForm.SUYN) { payload.SUYN = dialogForm.SUYN }\n\n  if(dialogForm.MHRecovery) { payload.MHRecovery = dialogForm.MHRecovery }\n\n  if(dialogForm.MHMatters) { payload.MHMatters = dialogForm.MHMatters }\n\n  if(dialogForm.MHSatActions) { payload.MHSatActions = dialogForm.MHSatActions }\n\n  if(dialogForm.PHSatActions) { payload.PHSatActions = dialogForm.PHSatActions }\n  \n  if(dialogForm.JSSatActions) { payload.JSSatActions = dialogForm.JSSatActions }\n  \n  if(dialogForm.LASatActions) { payload.LASatActions = dialogForm.LASatActions }\n\n  if(dialogForm.RSSatActions) { payload.RSSatActions = dialogForm.RSSatActions }\n\n  if(dialogForm.FSSatActions) { payload.FSSatActions = dialogForm.FSSatActions }\n\n  if(dialogForm.PSSatActions) { payload.PSSatActions = dialogForm.PSSatActions }\n  \n  if(dialogForm.FISatActions) { payload.FISatActions = dialogForm.FISatActions }\n\n  if(dialogForm.CNSatActions) { payload.CNSatActions = dialogForm.CNSatActions }\n\n  if(dialogForm.SUSatActions) { payload.SUSatActions = dialogForm.SUSatActions }\n\n  if(dialogForm.MDSatActions) { payload.MDSatActions = dialogForm.MDSatActions }\n\n  if(dialogForm.PRSatActions) { payload.PRSatActions = dialogForm.PRSatActions }\n\n  if(dialogForm.MPSatActions) { payload.MPSatActions = dialogForm.MPSatActions }\n\n  if(dialogForm.JSSatPL) { payload.JSSatPL = dialogForm.JSSatPL }\n  \n  if(dialogForm.PHSatPL) { payload.PHSatPL = dialogForm.PHSatPL }\n  \n  if(dialogForm.ACSatPL) { payload.ACSatPL = dialogForm.ACSatPL }\n\n  if(dialogForm.LASatPL) { payload.LASatPL = dialogForm.LASatPL }\n\n  if(dialogForm.RSSatPL) { payload.RSSatPL = dialogForm.RSSatPL }\n\n  if(dialogForm.FSSatPL) { payload.FSSatPL = dialogForm.FSSatPL }\n  \n  if(dialogForm.PSSatPL) { payload.PSSatPL = dialogForm.PSSatPL }\n\n  if(dialogForm.FISatPL) { payload.FISatPL = dialogForm.FISatPL }\n\n  if(dialogForm.SUSatPL) { payload.SUSatPL = dialogForm.SUSatPL }\n\n  if(dialogForm.CNSatPL) { payload.CNSatPL = dialogForm.CNSatPL }\n\n  if(dialogForm.MDSatPL) { payload.MDSatPL = dialogForm.MDSatPL }\n\n  if(dialogForm.PRSatPL) { payload.PRSatPL = dialogForm.PRSatPL }\n  \n  if(dialogForm.MPSatPL) { payload.MPSatPL = dialogForm.MPSatPL }\n\n  if(dialogForm.MHSat1) { payload.MHSat1 = dialogForm.MHSat1 }\n\n  if(dialogForm.ACSatActions) { payload.ACSatActions = dialogForm.ACSatActions }\n  \n  if(dialogForm.RevUnplan) { payload.RevUnplan = dialogForm.RevUnplan }\n  \n  if(dialogForm.CareDecUnplan) { payload.CareDecUnplan = dialogForm.CareDecUnplan }\n\n  if(dialogForm.CareDec) { payload.CareDec = dialogForm.CareDec }\n\n  if(dialogForm.InCareDec) { payload.InCareDec = dialogForm.InCareDec.value }\n\n  if(dialogForm.Funded) { payload.Funded = dialogForm.Funded }\n  \n  if(dialogForm.SUDisagree) { payload.SUDisagree = dialogForm.SUDisagree }\n\n  if(dialogForm.StageTreat) { payload.StageTreat = dialogForm.StageTreat.value }\n\n  if(dialogForm.StageTreat1) { payload.StageTreat1 = dialogForm.StageTreat1.value }\n\n  if(dialogForm.NxtRev) { payload.NxtRev = dialogForm.NxtRev }\n\n  if(dialogForm.S117Comm) { payload.S117Comm = dialogForm.S117Comm }\n\n  if(dialogForm.CarerView) { payload.CarerView = dialogForm.CarerView }\n\n  if(dialogForm.MHSatHelp) { payload.MHSatHelp = dialogForm.MHSatHelp }\n\n  if(dialogForm.JSSatHelp) { payload.JSSatHelp = dialogForm.JSSatHelp }\n\n  if(dialogForm.ACSatHelp) { payload.ACSatHelp = dialogForm.ACSatHelp }\n  \n  if(dialogForm.LASatHelp) { payload.LASatHelp = dialogForm.LASatHelp }\n  \n  if(dialogForm.RSSatHelp) { payload.RSSatHelp = dialogForm.RSSatHelp }\n\n  if(dialogForm.FSSatHelp) { payload.FSSatHelp = dialogForm.FSSatHelp }\n\n  if(dialogForm.PSSatHelp) { payload.PSSatHelp = dialogForm.PSSatHelp }\n\n  if(dialogForm.FISatHelp) { payload.FISatHelp = dialogForm.FISatHelp }\n  \n  if(dialogForm.CNSatHelp) { payload.CNSatHelp = dialogForm.CNSatHelp }\n\n  if(dialogForm.SUSatHelp) { payload.SUSatHelp = dialogForm.SUSatHelp }\n\n  if(dialogForm.MDSatHelp) { payload.MDSatHelp = dialogForm.MDSatHelp }\n\n  if(dialogForm.PRSatHelp) { payload.PRSatHelp = dialogForm.PRSatHelp }\n\n  if(dialogForm.MPSatHelp) { payload.MPSatHelp = dialogForm.MPSatHelp }\n\n  if(dialogForm.PHSatHelp) { payload.PHSatHelp = dialogForm.PHSatHelp }\n\n  // Set the payload parameter in the store\n  cti.store.variables.v_submitDialogFormPayload = payload\n}\n\n$success()"},"_auto_id_":"b4a9ac90-6907-4dca-8240-1052014ecfb0","actions":[]},{"event":"click","type":"call-api","data":{"sync":true,"name":"api_rio","operation":"submitdialogform","params":{"Authorization":"Basic {{$store.variables.auth_header}}","applicationkey":"{{$store.schema.metadata.applicationkey}}","payload":"{{$store.variables.v_submitDialogFormPayload}}"}},"_auto_id_":"e89f0e56-ae6a-4d50-8347-996f60bdc397","actions":[{"event":"success","type":"inline-function","data":{"sync":true,"code":"debugger;\n// Grab response\nvar response = cti.store.api.api_rio.submitdialogform\n\nif(!response.success) {  \n  cti.fn_toggle_spinner('close')\n\n  window.logManager.consoleLog(\n    'API CALL: submitdialogform FAILED - Reason: ' + response.message, \n    'error'\n  )\n\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_error\", \n    \"title\" : \"Dialog+ Form Submission Failed\", \n    \"text\" : \"Unable to submit Dialog+ Form: \" + response.message\n  })\n  \n  cti.store.variables.selected_visit.dialog_form_status = \"failed\";\n  cti.store.variables.selected_visit.dialog_form_status_text = \"Failed to Upload Dialog+, tap to retry...\";\n  \n  var failedObj = {\n    status : \"failed\",\n    type : \"dialogForm\",\n    data : cti.store.variables.v_submitDialogFormPayload\n  }\n  \n  cti.store.failedDataRequests.push(failedObj)\n  \n  cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n} else {\n  window.logManager.consoleLog(\n    'API CALL: submitdialogform SUCCESS', \n    'info'\n  )\n  \n  var currentFormLength = cti.store.variables.selected_visit.patientData.dialogPlusForms.length\n  \n  if(response.data != undefined && response.data.length >= currentFormLength) {\n    cti.store.variables.selected_visit.patientData.dialogPlusForms = response.data\n  }\n  \n  cti.store.variables.selected_visit.dialog_form_status = \"complete\";\n  cti.store.variables.selected_visit.dialog_form_status_text = \"Completed\";\n  delete cti.store.variables.selected_visit.dialog_form_page\n  cti.store.variables.v_submitDialogFormPayload_clear = true\n\n  cti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n  cti.fn_toggle_spinner('close')\n  \n  delete cti.store.variables.v_submitDialogFormPayload\n}\n\ndelete cti.store.api.api_rio.submitdialogform"},"_auto_id_":"69367122-03e8-494f-b79e-e441e0f755e0"},{"event":"fail","type":"inline-function","data":{"sync":true,"code":"debugger;\nvar failedObj = {\n  status : \"failed\",\n  type : \"dialogForm\",\n  data : cti.store.variables.v_submitDialogFormPayload\n}\ncti.store.failedDataRequests.push(failedObj)\n\nwindow.logManager.consoleLog(\n  'API CALL: submitdialogform FAILED - Reason: ' + response.message, \n  'error'\n)\n\ncti.utils.callAction(\"show-notification\", {\n  \"name\": \"notification_error\", \n  \"title\" : \"Server Connection Error\", \n  \"text\" : \"Unable to submit Dialog+ Form: \" + response.message\n})\n\ncti.fn_toggle_spinner('close')\ncti.utils.callAction(\"go-to-page\", { \"name\": \"Visit\" })\n\ndelete cti.store.api.api_rio.submitdialogform"},"_auto_id_":"4a3c69af-2ea8-4d25-ace6-54239ce1b0c7"}]}],"name":"SubmitDialogForm"}],"dataflows":[],"config":[{"name":"On-Load Event","type":"event","item-type":"onload","_auto_id_":"f2e5db87-aa36-449f-8128-a4dc77963667","actions":[{"event":"onload","type":"inline-function","data":{"sync":true,"code":"function storeOrientation(){\n\tswitch(window.orientation) \n    {  \n      case -90:\n      case 90:\n        cti.store.variables.orientation = 'landscape';\n        break; \n      default:\n        if (window.innerWidth > window.innerHeight) {\n          cti.store.variables.orientation = 'landscape';\n        }\n        else\n        {\n          cti.store.variables.orientation = 'portrait';\n        }\n        break; \n    }\n  \tcti.utils.updatePage();\n}\n\nfunction storeOnlineStatus() {\n\tcti.store.variables.online = \"online\";\n  \tcti.utils.updatePage();\n}\n\nfunction storeOfflineStatus() {\n\tcti.store.variables.online = \"offline\";\n  \tcti.utils.updatePage();\n}\n  \n//mobile / desktop\nwindow.addEventListener('orientationchange', storeOrientation);\nwindow.addEventListener('resize', storeOrientation);\n\nwindow.addEventListener('online',  storeOnlineStatus);\nwindow.addEventListener('offline', storeOfflineStatus);\n\nstoreOrientation();\n\ncti.store.variables.online = (navigator.onLine ? \"online\" : \"offline\");\n\n//prevent iOS from highlighting phone numbers!\n$('head').append('<meta name=\"format-detection\" content=\"telephone=no\" />');\n\n$success();"},"_auto_id_":"d53cc595-5d4e-43ab-a1c2-e8d48cd5a9b2"}]},{"name":"js_moment","type":"scripting","item-type":"js-asset","_auto_id_":"202c0252-82ef-4b33-a49d-3fb80b1116db","fileName":"moment.min.js"},{"name":"js_slip","type":"scripting","item-type":"js-asset","_auto_id_":"533d19d5-1713-43ee-b559-1e2fd8e4635f","fileName":"slip.js"},{"name":"pdf","type":"scripting","item-type":"js-asset","_auto_id_":"fd94355c-9a7d-42e8-b227-d30fbb5e5ca4","fileName":"pdf.js"},{"name":"pdf_worker","type":"scripting","item-type":"js-asset","_auto_id_":"4e7bb6e3-b8c1-41ba-bb31-f106e93692e0","fileName":"pdf.worker.js"},{"name":"pouchManager","type":"scripting","item-type":"js-asset","_auto_id_":"3c661861-9777-414e-9cc0-9f9e4e3ad750","fileName":"pouchManager.js"},{"name":"logManager","type":"scripting","item-type":"js-asset","_auto_id_":"93914f96-7ca9-4531-8d5c-4ab8886c95bd","fileName":"logManager.js"},{"name":"testPushResponse","type":"scripting","item-type":"function","_auto_id_":"b25df889-0bf6-406c-8ae0-f82f1015992c","sync":true,"params":[{"name":"appointmentId","required":true}],"content":"window.logManager.consoleLog(\n  'function testPushResponse(appointmentId)', \n  'info'\n);\n\nif(appointmentId) {\n  cti.store.variables.getAppointmentPayload = {\n    appointmentId : undefined,\n    appointmentExists : false\n  }\n  \n  cti.store.variables.getAppointmentPayload.appointmentId = appointmentId\n\n  // Load appointments from pouch\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    window.logManager.consoleLog(\n      'Pouch DB - Successfully retrieved appointments from Pouch.', \n      'info', \n      cti.store.schema.metadata.logDebug,\n      cti.store.schema.metadata.startDebug\n    );\n    // Set the appointments array\n    var appointments = doc.data\n\n    // Check that we have a valid appointment\n    for(var i in appointments) {\n      if(appointments[i].appointmentId == cti.store.variables.getAppointmentPayload.appointmentId) {\n        cti.store.variables.getAppointmentPayload.appointmentExists = true\n        break\n      }\n    }\n    \n\tcti.utils.callAction(\"call-actionflow\", { name: \"GetAppointment\" })\n  }, function (reason, err) {\n    window.logManager.consoleLog(\n      'Pouch DB - Failed retriveing Appointments Data from Pouch - ' + reason + err, \n      'error', \n      cti.store.schema.metadata.logDebug,\n      cti.store.schema.metadata.startDebug\n    );\n  });\n}"},{"name":"fn_toggle_visit_menu","type":"scripting","item-type":"function","_auto_id_":"fe2fae25-2d57-4d0f-ac78-92d263951060","sync":true,"params":[{"name":"id"}],"content":"window.logManager.consoleLog(\n  'function fn_toggle_visit_menu(id)', \n  'info'\n);\n\nvar idx = JSON.parse(id);\nvar alreadyexpanded = ($('#group_visit_' + idx.$index + ' > div')[0].className.indexOf('row-expanded') > -1);\n$('#list_visits md-group > div').removeClass('row-expanded');\nif (!alreadyexpanded) {\n\t$('#group_visit_' + idx.$index + ' > div').toggleClass('row-expanded');\n}"},{"name":"fn_revoke_cleardown","type":"scripting","item-type":"function","_auto_id_":"97b070e5-ecdf-48ee-b215-7350cc921094","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_revoke_cleardown()', \n  'info'\n);\n\n// Clear down appointment specific data\ndelete cti.store.variables.show_advanced_note\ndelete cti.store.variables.show_advanced_appt\n\n// Clear down data success flags\ndelete cti.store.variables.getStaticDataStatus\n\n// Clear down appointment listing data\ndelete cti.store.variables.v_appointmentSyncFromDate\ndelete cti.store.variables.v_appointmentSyncToDate\ndelete cti.store.variables.v_appointmentDate\ndelete cti.store.variables.v_appointmentDateText\ndelete cti.store.variables.v_selectedDayAppointments\ndelete cti.store.variables.v_appointments\n\n// Clear down user credentials\ndelete cti.store.variables.v_userPIN\ndelete cti.store.variables.v_pinAttempts\ndelete cti.store.variables.auth_header\n\n// Clear down app level data\n// NOTE: Not sure how this will affect the app for now, might need reviewing at some point\ndelete cti.store.variables.v_diary_template\ndelete cti.store.variables.v_planner\ndelete cti.store.variables.duration_minutes\ndelete cti.store.variables.duration_hours\n\nreturn true;"},{"name":"fn_DialogForm_Toggler","type":"scripting","item-type":"function","_auto_id_":"8c019918-0c14-4a22-a90a-5860b5bc081f","sync":true,"params":[{"name":"index","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_DialogForm_Toggler(index)', \n  'info'\n);\n\ncti.store.pages.DialogPlus_Form.active_question = parseInt(index, 10);\ncti.store.pages.DialogPlus_Form.active_question_display = parseInt(index, 10) +1;\ncti.utils.updatePage();","actions":[]},{"name":"fn_call_contact","type":"scripting","item-type":"function","_auto_id_":"a25dd8d1-f5be-4dd4-9f6d-eb7a68d7c325","sync":true,"params":[{"name":"scope","description":"Element of 'this' from the onclick"}],"content":"window.logManager.consoleLog(\n  'function fn_call_contact(scope)', \n  'info'\n);\n\nwindow.open('tel:141'+scope);"},{"name":"fn_load_document","type":"scripting","item-type":"function","_auto_id_":"40232cfd-eb89-490c-977b-0090029628de","sync":true,"params":[{"required":true,"name":"document","description":"The document object"}],"content":"window.logManager.consoleLog(\n  'function fn_load_document(document)', \n  'info'\n);\n\n// Load Spinner\ncti.fn_toggle_spinner('open', 'Downloading Document...');\n\n// Parse the selected document\nvar docObj = JSON.parse(document);\n\n// Package the documentGet payload object ...\nvar documentPayload = {\n\t\"clientId\": cti.store.variables.selected_visit.patientData.demographics.clientId,\n\t\"documentId\": docObj.documentId,\n\t\"documentSerialNumber\": docObj.serialNumber,\n\t\"documentDate\": moment(docObj.documentDate).format(\"YYYY-MM-DD\")\n}\n\n// ... also set a global variable so that we can access the doc type on success return\ncti.store.variables.v_selectedDocument = docObj;\n\n// Set payload object and kick off GetDocument actionflow\ncti.store.variables.v_documentGetPayload = documentPayload;\ncti.utils.callAction(\"call-actionflow\", { name: \"GetDocument\" });"},{"name":"fn_prep_forms","type":"scripting","item-type":"function","_auto_id_":"6e603a4a-7d46-4b0e-98d0-150671c688d8","sync":true,"params":[{"name":"appointment","description":"Appointment object","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_prep_forms(appointment)', \n  'info'\n);\n\nvar dialog = false, \n    lifestyle = false, \n    safety = false;\n\nif(appointment.dialog_form === undefined || appointment.lifestyle_form === undefined || appointment.safety_form === undefined) {\n  if(appointment.attendees) {\n    if(appointment.attendees.attendee) {\n      if(appointment.attendees.attendee.activities) {\n        if(appointment.attendees.attendee.activities.activity) {\n          for(var i in appointment.attendees.attendee.activities.activity) {\n            if(appointment.attendees.attendee.activities.activity[i].activityType.code === \"dialogplus\") {\n              dialog = true;\n              cti.store.variables.selected_visit.dialog_form_status = \"notcomplete\"\n              cti.store.variables.selected_visit.dialog_form_status_text = \"Not Completed\"\n            } else if(appointment.attendees.attendee.activities.activity[i].activityType.code === \"phlifestyl\") {\n              lifestyle = true;\n              cti.store.variables.selected_visit.lifestyle_form_status = \"notcomplete\"\n              cti.store.variables.selected_visit.lifestyle_form_status_text = \"Not Completed\"\n            } else if(appointment.attendees.attendee.activities.activity[i].activityType.code === \"msp\") {\n              safety = true;\n              cti.store.variables.selected_visit.safety_form_status = \"notcomplete\"\n              cti.store.variables.selected_visit.safety_form_status_text = \"Not Completed\"\n            }\n          }\n        }\n      }\n    }\n  }\n  \n  appointment.dialog_form = dialog;\n  appointment.lifestyle_form = lifestyle;\n  appointment.safety_form = safety;\n} else {\n  if(appointment.dialog_form && appointment.dialog_form_status == \"inprogress\") {\n  \tcti.store.pages.DialogForm = cti.store.variables.selected_visit.dialog_form_page\n  }\n  if(appointment.lifestyle_form && appointment.lifestyle_form_status == \"inprogress\") {\n  \tcti.store.pages.LifestyleForm = cti.store.variables.selected_visit.lifestyle_form_page\n  }\n  if(appointment.safety_form && appointment.safety_form_status == \"inprogress\") {\n  \tcti.store.pages.SafetyForm = cti.store.variables.selected_visit.safety_form_page\n  }\n}"},{"name":"fn_load_form","type":"scripting","item-type":"function","_auto_id_":"638888a9-bbad-413f-b335-dcbfaf6e77e8","sync":true,"params":[{"name":"formType","description":"What form we want to load"}],"content":"window.logManager.consoleLog(\n  'function fn_load_form(form)', \n  'info'\n);\n\n// Check that we have started the visit. If not then return false and show warning\nif(cti.store.variables.selected_visit.arrivalTime === undefined) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: You have not started this Visit\", \n    \"text\" : \"You must start the Visit before you can complete any forms.\"\n  }); \n  return false;\n}\n\ndebugger;\n\n// If we're selecting the dialog form, check that we haven't already started the form\nif(formType === \"dialogplus\") {\n  // If we haven't started the form, set the status to inprogress\n  if(cti.store.variables.selected_visit.dialog_form_status != \"complete\") {\n    cti.store.variables.selected_visit.dialog_form_status = \"inprogress\";\n    cti.store.variables.selected_visit.dialog_form_status_text = \"In Progress...\";\n\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"PreDialogForm\"});\n  } else {\n    cti.fn_view_dialog(cti.store.variables.selected_visit.patientData.dialogPlusForms);\n  }\n} else if(formType === \"phlifestyl\") {\n  // If we haven't started the form, set the status to inprogress\n  if(cti.store.variables.selected_visit.lifestyle_form_status != \"complete\") {\n    cti.store.variables.selected_visit.lifestyle_form_status = \"inprogress\";\n    cti.store.variables.selected_visit.lifestyle_form_status_text = \"In Progress...\";\n\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"LifestyleForm\"});\n  } else {\n    cti.fn_view_lifestyle(cti.store.variables.selected_visit.patientData.lifestyleAssessmentForms);\n  }\n} else if(formType === \"msp\") {\n  if(cti.store.variables.selected_visit.safety_form_status != \"complete\") {\n    cti.store.variables.selected_visit.safety_form_status = \"inprogress\";\n    cti.store.variables.selected_visit.safety_form_status_text = \"In Progress...\";\n\n    cti.utils.callAction(\"go-to-page\", {\"name\":\"SafetyForm\"});\n  } else {\n    cti.fn_view_safety(true);\n  }\n} "},{"name":"fn_view_dialog","type":"scripting","item-type":"function","_auto_id_":"7617fa66-f224-4a97-9f71-6bd15c4c2071","sync":true,"params":[{"name":"form"}],"content":"window.logManager.consoleLog(\n  'function fn_view_forms(form)', \n  'info'\n);\n\ndebugger;\nvar patiendData = cti.store.variables.selected_visit.patientData\n\n// If we're selecting the dialog form, check that we haven't already started the form\nif(form === \"dialogplus\") {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogForm\"});\n} else if(form === \"phlifestyl\") {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"LifestyleForm\"});\n} else if(form === \"msp\") {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"SafetyForm\"});\n} "},{"name":"fn_view_lifestyle","type":"scripting","item-type":"function","_auto_id_":"70f9b7c7-7fdd-4b1b-84ed-58f753980c22","sync":true,"params":[{"name":"form"}],"content":"window.logManager.consoleLog(\n  'function fn_view_forms(form)', \n  'info'\n);\n\ndebugger;\nvar patiendData = cti.store.variables.selected_visit.patientData\n\n// If we're selecting the dialog form, check that we haven't already started the form\nif(form === \"dialogplus\") {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"DialogForm\"});\n} else if(form === \"phlifestyl\") {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"LifestyleForm\"});\n} else if(form === \"msp\") {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"SafetyForm\"});\n} "},{"name":"fn_view_safety","type":"scripting","item-type":"function","_auto_id_":"e5164d2c-f490-463b-80c9-7e3e3ab50270","sync":false,"params":[{"name":"currentForm"}],"content":"window.logManager.consoleLog(\n  'function fn_view_safety(currentForm)', \n  'info'\n);\n\ndebugger;\n\ncti.store.variables.v_safetyForms = []\nvar form = []\nvar editForms = []\n\nif(currentForm) {\n  form = cti.store.variables.selected_visit.patientData.mySafetyPlanForms[0]\n  var array = []\n  array.push(form)\n  editForms = JSON.parse(JSON.stringify(array))\n} else {\n  form = cti.store.variables.selected_visit.patientData.mySafetyPlanForms\n  editForms = JSON.parse(JSON.stringify(form))\n}\n\nfor(var i in editForms) {\n  var thisForm = editForms[i]\n\n  var formObject = {\n    sf_triggers : thisForm.triggers.result || 'No data provided',\n    sf_triggers_actionplan : thisForm.triggersAp.result || 'No data provided',\n    sf_contact : thisForm.contact.result || 'No data provided',\n    sf_contactreach : thisForm.contReach.result || 'No data provided',\n    sf_outofcrisis : thisForm.outofCrisis.result || 'No data provided',\n    sf_earlyws : thisForm.earlyWs.result || 'No data provided',\n    sf_earlyws_actionplan : thisForm.earlyWsap.result || 'No data provided',\n    sf_getworse : thisForm.getWorse.result || 'No data provided',\n    sf_getworse_actionplan : thisForm.getWorseAp.result || 'No data provided',\n    sf_assisteddecision : thisForm.decisions.result || 'No data provided',\n    sf_advancedirective : thisForm.advDir.result == \"1\" ? true : false,\n    sf_serviceuseragreedplan : thisForm.suAgree.result == \"1\" ? true : false,\n    sf_crisisnumber : thisForm.crisisNo.result || 'No data provided'\n  }\n\n  cti.store.variables.v_safetyForms.push(formObject)\n}\n\nif(cti.store.variables.v_safetyForms.length === 0) {\n  cti.utils.callAction(\"show-notification\", {\n    \"name\": \"notification_warning\", \n    \"title\" : \"Warning: This patient currently has no Safety Forms\", \n    \"text\" : \"The current patient does not have any previously submitted Safety Forms.\"\n  }); \n} else {\n  cti.utils.callAction(\"go-to-page\", {\"name\":\"SafetyForm_View\"});\n}"},{"name":"fn_top_scroll","type":"scripting","item-type":"function","_auto_id_":"9aaa5523-e92d-462d-8cf1-3018cf5ed285","sync":true,"params":[{"name":"id"}],"content":"window.logManager.consoleLog(\n  'function fn_top_scroll(id)', \n  'info'\n);\n\nvar objDiv = document.getElementById(id);\nobjDiv.scrollTop = 0;"},{"name":"fn_calc_visit_duration","type":"scripting","item-type":"function","_auto_id_":"093bd40c-2f3d-4643-b59a-d389db3fce6f","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_calc_visit_duration()', \n  'info'\n);\n\nif (!cti.store.pages.Outcome) {\n  cti.store.pages.Outcome = {};\n}\n\nvar startDate = cti.store.variables.selected_visit.arrivalTime;\nvar arrivalTime = moment(startDate).format(\"HH:mm\");\nvar arrivalTimeHours = moment(arrivalTime, \"HH:mm\").format(\"HH\");\nvar arrivalTimeMinutes = moment(arrivalTime, \"HH:mm\").format(\"mm\");\nvar minsArrivalTime = parseInt(arrivalTimeMinutes);\nvar arrivalTimeLabel = \"\";\n\nif(minsArrivalTime < 15) { arrivalTimeLabel = arrivalTimeHours+\":00\"; }\nelse if(minsArrivalTime >= 15 && minsArrivalTime < 30) { arrivalTimeLabel = arrivalTimeHours+\":15\"; }\nelse if(minsArrivalTime >= 30 && minsArrivalTime < 45) { arrivalTimeLabel = arrivalTimeHours+\":30\"; } \nelse if(minsArrivalTime >= 45 && minsArrivalTime < 60) { arrivalTimeLabel = arrivalTimeHours+\":45\"; }\n\ncti.store.pages.Outcome.arrivalTime = arrivalTimeLabel;\ncti.store.pages.Outcome.actualTime = arrivalTimeLabel;\n\nvar now = moment().format(\"YYYY-MM-DDTHH:mm:ss\");\nvar time = moment.utc(moment(now,\"YYYY-MM-DDTHH:mm:ss\").diff(moment(startDate,\"YYYY-MM-DDTHH:mm:ss\"))).format(\"HH:mm\");\nvar mins = moment(time, \"HH:mm\").format(\"m\");\nvar hours = moment(time, \"HH:mm\").format(\"h\");\n\ncti.store.pages.Outcome.duration_hours = {\"label\": hours, \"value\": hours };\ncti.store.pages.Outcome.duration_minutes = {\"label\": mins, \"value\": mins };\n\ncti.utils.updatePage();"},{"name":"fn_get_location","type":"scripting","item-type":"function","_auto_id_":"bcd20c8b-3548-41b8-b652-0c61912d9d6a","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_get_location()', \n  'info'\n);\n\nfunction setPosition(position){\n  cti.store.variables.latitude = position.coords.latitude;\n  cti.store.variables.longitude = position.coords.longitude;\n  window.logManager.consoleLog(\n    'function fn_get_location() - Successfully saved current location', \n    'info'\n  );\n  return true;\n}\n\nif(cti.store.env.platform.name != \"electron\"){\n  navigator.geolocation.getCurrentPosition(setPosition); \n  return true;\n} else {\n  window.logManager.consoleLog(\n    'function fn_get_location() - Geo location not supported, setting location to Sevelec HQ', \n    'error'\n  );\n  cti.store.variables.latitude = \"53.3125156\"; //servelec HQ\n  cti.store.variables.longitude = \"-1.3461527\";\n  return true;\n}"},{"name":"fn_init_google_maps","type":"scripting","item-type":"function","_auto_id_":"db191980-6c00-4996-b0f5-eaa55a198507","sync":true,"params":[{"name":"callback"}],"content":"window.logManager.consoleLog(\n  'function fn_init_google_maps(callback)', \n  'info'\n);\n\n// Grab api key from schema\nvar apiKey = cti.store.schema.metadata.googleMapsApiKey;\n// Set Google URL with the cti.fn_render_map as the callback function\nvar url = 'https://maps.googleapis.com/maps/api/js?key=' + apiKey + '&callback=' + callback;\n\n// If Google maps is not initiated into the app, create and load it here\nif (cti.store.variables.online === \"online\" && $(\"head script[src='\" + url + \"']\").length == 0) {\n  var s = document.createElement(\"script\");\n  s.type = \"text/javascript\";\n  s.src = url;\n\n  // Use any selector\n  s.async = true;\n  s.defer = true;\n  $(\"head\").append(s);\n  console.log(\"maps loaded\");\n  return true;\n} else {\n  return false;\n}"},{"name":"fn_render_map","type":"scripting","item-type":"function","_auto_id_":"e3a3f805-5d59-4de6-9885-f18cfa297762","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_render_map()', \n  'info'\n);\n\nif (!window.google) {\n  window.logManager.consoleLog(\n    'function fn_render_map() - No Google maps installed on device.', \n    'error'\n  );\n  return false\n}\n\nif (!cti.store.variables.v_selectedDayAppointments) {\n  window.logManager.consoleLog(\n    'function fn_render_map() - No appointment data [cti.store.variables.appointments]', \n    'error'\n  );\n  return false\n}\n\nvar directionDisplay\nvar directionsService = new google.maps.DirectionsService()\nvar map\nvar start = new google.maps.LatLng(cti.store.variables.latitude, cti.store.variables.longitude)\nvar myOptions = {\n  zoom: 8,\n  mapTypeId: google.maps.MapTypeId.ROADMAP,\n  center: start\n}\n\nfunction renderDirections(result) {\n  var rendererOptions = {\n    map: map,\n    suppressMarkers: true\n  }\n  var directionsRenderer = new google.maps.DirectionsRenderer(rendererOptions)\n  directionsRenderer.setDirections(result)\n}\n\nfunction requestDirections(start, end, indx, markerContent) {\n  directionsService.route(\n    {\n      origin: start,\n      destination: end,\n      travelMode: google.maps.DirectionsTravelMode.DRIVING\n    },\n    function(result) {\n      if (!result || !result.status || ['ZERO_RESULTS', 'NO_ROUTES', 'NOT_FOUND'].indexOf(result.status) > -1 || !result.routes) {\n        window.logManager.consoleLog(\n          'function fn_render_map() - Invalid postcode returned.', \n          'error', \n          cti.store.schema.metadata.logDebug,\n          cti.store.schema.metadata.startDebug\n        );\n        return false\n      }\n      var duration = result.routes[0].legs[0].duration\n\n      var marker = new google.maps.Marker({\n        position: {\n          lat: result.routes[0].legs[0].end_location.lat(),\n          lng: result.routes[0].legs[0].end_location.lng()\n        },\n        map: map,\n        label: (indx + 1).toString(),\n        icon: 'user-assets/pin.png'\n      })\n\n      var step = result.routes[0].legs[0].steps.length - 1\n      var lat = result.routes[0].legs[0].steps[step].start_location.lat()\n      var long = result.routes[0].legs[0].steps[step].start_location.lng()\n\n      txt = new TxtOverlay(new google.maps.LatLng(lat, long), duration.text, 'durationBox', map)\n\n      google.maps.event.addListener(\n        marker,\n        'click',\n        (function(marker, i, duration) {\n          //add the duration to the appointment data\n          cti.store.variables.v_selectedDayAppointments[i].appointmentEta = moment()\n            .add(duration.value, 'seconds')\n            .format('hh:mm')\n\n          return function() {\n            var infowindow = new google.maps.InfoWindow()\n            infowindow.setContent('<p>' + cti.store.variables.v_selectedDayAppointments[i].patientData.demographics.firstname + '&nbsp;' + cti.store.variables.v_selectedDayAppointments[i].patientData.demographics.surname + '<br/>' + cti.store.variables.v_selectedDayAppointments[i].appointmentType.value + '<br/>Travel Time: ' + duration.text + '</p>')\n            infowindow.open(map, marker)\n          }\n        })(marker, indx, duration)\n      )\n      renderDirections(result)\n    }\n  )\n}\n\nmap = new google.maps.Map(document.getElementById('layersmap'), myOptions)\nwindow.mymap = map\n\n//add destination markers\nvar infowindow = new google.maps.InfoWindow()\nfor (var i = 0; i < cti.store.variables.v_selectedDayAppointments.length; i++) {\n  var a = cti.store.variables.v_selectedDayAppointments[i]\n  var markerContent = a.patientData.demographics.surname\n  requestDirections(start, a.patientData.demographics.address.postCode, i, markerContent)\n}\n\n//add user location marker\nmarkerusr = new google.maps.Marker({\n  position: start,\n  map: map,\n  label: {\n    text: 'Me',\n    color: 'white'\n  }\n})\n\n//add traffic layer\nvar trafficLayer = new google.maps.TrafficLayer()\ntrafficLayer.setMap(map)\n\n//adapted from http://code.google.com/apis/maps/documentation/javascript/overlays.html#CustomOverlays\n//text overlays\nfunction TxtOverlay(pos, txt, cls, map) {\n  // Now initialize all properties.\n  this.pos = pos\n  this.txt_ = txt\n  this.cls_ = cls\n  this.map_ = map\n  // We define a property to hold the image's\n  // div. We'll actually create this div\n  // upon receipt of the add() method so we'll\n  // leave it null for now.\n  this.div_ = null\n  // Explicitly call setMap() on this overlay\n  this.setMap(map)\n}\nTxtOverlay.prototype = new google.maps.OverlayView()\nTxtOverlay.prototype.onAdd = function() {\n  // Note: an overlay's receipt of onAdd() indicates that\n  // the map's panes are now available for attaching\n  // the overlay to the map via the DOM.\n  // Create the DIV and set some basic attributes.\n  var div = document.createElement('DIV')\n  div.className = this.cls_\n  div.innerHTML = this.txt_\n  // Set the overlay's div_ property to this DIV\n  this.div_ = div\n  var overlayProjection = this.getProjection()\n  var position = overlayProjection.fromLatLngToDivPixel(this.pos)\n  div.style.left = position.x + 'px'\n  div.style.top = position.y + 'px'\n  // We add an overlay to a map via one of the map's panes.\n  var panes = this.getPanes()\n  panes.floatPane.appendChild(div)\n}\nTxtOverlay.prototype.draw = function() {\n  var overlayProjection = this.getProjection()\n  // Retrieve the southwest and northeast coordinates of this overlay\n  // in latlngs and convert them to pixels coordinates.\n  // We'll use these coordinates to resize the DIV.\n  var position = overlayProjection.fromLatLngToDivPixel(this.pos)\n  var div = this.div_\n  div.style.left = position.x + 'px'\n  div.style.top = position.y + 'px'\n}\n//Optional: helper methods for removing and toggling the text overlay.\nTxtOverlay.prototype.onRemove = function() {\n  this.div_.parentNode.removeChild(this.div_)\n  this.div_ = null\n}\nTxtOverlay.prototype.hide = function() {\n  if (this.div_) {\n    this.div_.style.visibility = 'hidden'\n  }\n}\nTxtOverlay.prototype.show = function() {\n  if (this.div_) {\n    this.div_.style.visibility = 'visible'\n  }\n}\nTxtOverlay.prototype.toggle = function() {\n  if (this.div_) {\n    if (this.div_.style.visibility == 'hidden') {\n      this.show()\n    } else {\n      this.hide()\n    }\n  }\n}\nTxtOverlay.prototype.toggleDOM = function() {\n  if (this.getMap()) {\n    this.setMap(null)\n  } else {\n    this.setMap(this.map_)\n  }\n}","actions":[]},{"name":"fn_openContentMenu","type":"scripting","item-type":"function","_auto_id_":"335d5190-8fd6-4eaf-ab65-c102e68e9035","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_openContentMenu()', \n  'info'\n);\n\nvar contextMenu = document.getElementsByTagName('ct-context-menu')[0];\ncontextMenu.toggle();"},{"name":"fn_populate_duration_dl","type":"scripting","item-type":"function","_auto_id_":"2637d090-0615-4390-9283-e85b89e43506","sync":true,"params":[],"content":"debugger;\nwindow.logManager.consoleLog(\n  'function fn_populate_duration_dl()', \n  'info'\n);\n\ncti.store.variables.duration_minutes = [];\nfor (var i = 0; i < 61; i++) {\n  cti.store.variables.duration_minutes.push({\"label\":i.toString(),\"value\":i.toString()});\n}\n\ncti.store.variables.duration_hours = [];\nfor (var i = 0; i < 25; i++) {\n  cti.store.variables.duration_hours.push({\"label\":i.toString(),\"value\":i.toString()});\n}"},{"name":"fn_prep_timeline","type":"scripting","item-type":"function","_auto_id_":"72309a2b-0d9d-47b4-b3a4-c582f8a1a202","sync":true,"params":[],"content":"window.logManager.consoleLog(\n  'function fn_prep_timeline()', \n  'info'\n);\n\nvar a = [];\ndelete cti.store.variables.timeline;\nvar p = cti.store.variables.selected_visit.patientData;\n\n// ##### Documents Preperation Functionality Begin\n// Append documents eventType\nif (p.documents != undefined) {\n  a = a.concat(p.documents);\n  a.forEach(function(e) {\n    if (e.eventType == undefined) {\n      e.eventType = \"documents\";\n    }\n  });\n}\n// ##### Documents Preperation Functionality End\n\n// ##### Referrals Preperation Functionality Begin\n// Check and amend details of Referral data for timeline\nvar referralsArray = JSON.parse(JSON.stringify(p.referrals));\nfor (var i in referralsArray) {\n  var thisReferral = referralsArray[i];\n\n  if (thisReferral.healthcareProfessional) {\n\tthisReferral.referredToDisplay = thisReferral.healthcareProfessional.value;\n  } else {\n    if (thisReferral.team != \"\") {\n      thisReferral.referredToDisplay = thisReferral.team.value;\n    } else {\n      thisReferral.referredToDisplay = \"No Referrer Team/HCP\";\n    }\n  }\n  thisReferral.eventType = \"referral\";\n  a.push(thisReferral);\n}\n// Sort Referrals into date order, newset first\np.referrals.sort(function(a, b) {\n  return a.referralDate > b.referralDate ? -1 : a.referralDate < b.referralDate ? 1 : 0;\n});\n// ##### Referrals Preperation Functionality End\n\n// ##### Progress Notes Preperation Functionality Begin\n// Bind all data to display in the timeline for a note into one html template\nfor (var i in p.progressNotes) {\n  var thisNote = p.progressNotes[i];\n  var risk, validated;\n\n  if (thisNote.isRiskRelated == \"0\") {\n    risk = \"No\";\n  } else {\n    risk = \"Yes\";\n  }\n\n  if (thisNote.verifyDate == undefined) {\n    validated = \"No\";\n  } else {\n    validated = \"Yes\";\n  }\n\n  var rowOne = \"<p><strong>Added by</strong> \" + thisNote.enteredBy.value + \"</p>\";\n  var rowTwo = \"<p><strong>Is Risk:</strong> \" + risk + \"</pr>\";\n  var rowThree = \"<p><strong>Validated:</strong> \" + validated + \"</p><br>\";\n\n  thisNote.timeLineDisplay = rowOne + rowTwo + rowThree + thisNote.noteText;\n}\n// Append progressNotes eventType\nif (p.progressNotes != undefined) {\n  a = a.concat(p.progressNotes);\n  a.forEach(function(e) {\n    if (e.eventType == undefined) {\n      e.eventType = \"notes\";\n    }\n  });\n}\n// ##### Progress Notes Preperation Functionality End\n\n// ##### Appointment Preperation Functionality Begin\n// Create appointments display text\nfor (var i in p.appointmentHistory) {\n  var thisApp = p.appointmentHistory[i];\n  thisApp.timeLineDisplay = \"\";\n\n  if(thisApp.outcome != \"\") {\n  \tvar rowOne = \"<p><strong>Outcome:</strong> \" + thisApp.outcome + \"</p>\";\n    thisApp.timeLineDisplay += rowOne;\n  }\n  \n  if(thisApp.location != \"\") {\n  \tvar rowTwo = \"<p><strong>Location:</strong> \" + thisApp.location + \"</p>\";\n    thisApp.timeLineDisplay += rowTwo;\n  }\n  if(thisApp.clinic != \"\") {\n  \tvar rowThree = \"<p><strong>Setting:</strong> \" + thisApp.clinic + \"</p>\";\n    thisApp.timeLineDisplay += rowThree;\n  }\n  \n  if(thisApp.intendedDuration != \"\") {\n  \tvar rowFour = \"<p><strong>Duration:</strong> \" + thisApp.intendedDuration + \"</p>\";\n    thisApp.timeLineDisplay += rowFour;\n  }\n  \n  if(thisApp.comment != \"\") {\n  \tvar rowFive = \"<p><strong>Comment:</strong> \" + thisApp.comment + \"</p>\";\n    thisApp.timeLineDisplay += rowFive;\n  }\n  \n  if(thisApp.cancellationReason != \"\") {\n  \tvar rowSix = \"<p><strong>Cancelation Reason:</strong> \" + thisApp.cancellationReason + \"</p>\";\n    thisApp.timeLineDisplay += rowSix;\n  }\n}\n// Append appointmentHistory eventType\nif (p.appointmentHistory != undefined) {\n  a = a.concat(p.appointmentHistory);\n  a.forEach(function(e) {\n    if (e.eventType == undefined) {\n      e.eventType = \"appointments\";\n    }\n  });\n}\n// ##### Appointments Preperation Functionality End\n\n// ##### Alerts Preperation Functionality Begin\n// Create all alert instances for timeline events only\nvar alertsArray = JSON.parse(JSON.stringify(p.alerts));\nfor (var i in alertsArray) {\n  var thisAlert = alertsArray[i];\n\n  if (thisAlert.removalDate) {\n    var endedAlert = {\n      id: thisAlert.id,\n      date: thisAlert.date,\n      type: thisAlert.type,\n      priority: thisAlert.priority,\n      text: thisAlert.text,\n      removalDate: thisAlert.removalDate,\n      removalReason: thisAlert.removalReason,\n      removalComment: thisAlert.removalComment,\n      eventType: \"alerts-removed\"\n    };\n    endedAlert.displayText = endedAlert.type.value + \" (Created On: \" + moment(endedAlert.date).format(\"DD MMM YYYY\") + \")\";\n\n    delete thisAlert.removalDate;\n    delete thisAlert.removalReason;\n    delete thisAlert.removalComment;\n    thisAlert.eventType = \"alerts-added\";\n\n    a.push(thisAlert);\n    a.push(endedAlert);\n  } else {\n    thisAlert.eventType = \"alerts-added\";\n    a.push(thisAlert);\n  }\n}\n// Sort alerts into date order, newset first\np.alerts.sort(function(a, b) {\n  return a.date > b.date ? -1 : a.date < b.date ? 1 : 0;\n});\n// ##### Alerts Preperation Functionality End\n\n// ##### Allergies Preperation Functionality Begin\n// Append allergies eventType\nif (p.allergies != undefined) {\n  a = a.concat(p.allergies);\n  a.forEach(function(e) {\n    if (e.eventType == undefined) {\n      e.eventType = \"allergies\";\n    }\n  });\n}\n// ##### Allergies Preperation Functionality End\n\n// Format all specific dateTime stamps to a uniform format for ordering...\na.forEach(function(e) {\n  var dateString;\n\n  if (e.eventType === \"notes\") {\n    dateString = e.dateTime;\n  } else if (e.eventType === \"referral\") {\n    dateString = e.referralDate;\n  } else if (e.eventType === \"appointments\") {\n    dateString = moment(e.date).format(\"YYYY-MM-DDTHH:mm:ss\");\n  } else if (e.eventType === \"documents\") {\n    dateString = e.documentDate;\n  } else if (e.eventType === \"alerts-removed\") {\n    dateString = moment(e.removalDate, \"YYYY-MM-DDTHH:mm:ss\").add(1, 'hours').format(\"YYYY-MM-DDTHH:mm:ss\");\n  } else if (e.eventType === \"alerts-added\") {\n    dateString = e.date;\n  } else if (e.eventType === \"allergies\") {\n    e.eventYear = e.yearOfIdentification;\n    dateString = e.eventYear + \"-01-01T00:00:00\";\n  }\n  \n  if(e.eventType === \"allergies\") {\n  \te.eventDateDisplay = \"Year: \" + e.yearOfIdentification;\n  }\n\n  if (dateString !== undefined) {\n    e.eventDate = new Date(dateString.replace(\" \", \"T\"));\n  }\n});\n\n// ... order Timeline by newest entry first\na.sort(function(a, b) {\n  return a.eventDate > b.eventDate ? -1 : a.eventDate < b.eventDate ? 1 : 0;\n});\n\n// Set timeline variable\ncti.store.variables.timeline = a;"},{"name":"fn_set_appointments","type":"scripting","item-type":"function","_auto_id_":"ccc57943-92fa-499c-9221-07ea1fc01885","sync":true,"params":[{"name":"appointments"}],"content":"window.logManager.consoleLog(\n  'function fn_set_appointments(appointments)', \n  'info'\n);\n\nif(appointments === undefined) { appointments = {} }\n\n//appointments.forEach(function(obj, idx) {\nfor(var i in appointments) {\n  var obj = appointments[i]\n\n  // Check if the appointment has already been completed or not\n  if (obj.attendees && obj.attendees.attendee && obj.attendees.attendee.outcome) {\n    obj['status'] = 'complete'\n  } else {\n    if (obj.status != 'started') {\n      obj['status'] = 'new'\n    }\n  }\n\n  // Create friendly time stamps\n  obj.shortTime = moment(obj.appointmentDateTime).format('HH:mm')\n  obj.shortEndTime = moment(obj.appointmentDateTime)\n    .add(obj.intendedDuration, 'minutes')\n    .format('HH:mm')\n\n  // No patientData means nothing more to process so continue.\n  var patientData = obj.patientData || null\n  if (patientData === null) {\n    obj['noData'] = true\n    return false\n  }\n\n  var demographics = patientData.demographics || null\n\n  if (demographics === null) {\n    return false\n  }\n\n  // Set friendly formatted GP Details\n  var gp = (demographics.healthcareProvider && demographics.healthcareProvider.healthcareProvider && demographics.healthcareProvider.healthcareProvider.generalPractioner && demographics.healthcareProvider.healthcareProvider.generalPractioner.value) || ''\n\n  obj.gpDetails = (gp !== '' ? gp + ' (' : '') + (demographics.healthcareProvider && demographics.healthcareProvider.healthcareProvider && demographics.healthcareProvider.healthcareProvider.practice && demographics.healthcareProvider.healthcareProvider.practice.value) + (gp !== '' ? ')' : '')\n\n  // Set friendly formatted NHS number\n  if (!!demographics.nhsNumber) {\n    obj.nhsNumFormatted = demographics.nhsNumber.substring(0, 3) + ' ' + demographics.nhsNumber.substring(3, 6) + ' ' + demographics.nhsNumber.substring(6, 10)\n  } else {\n    obj.nhsNumFormatted = ''\n  }\n\n  // Set friendly formatted address\n  obj.addressFormatted = [\n    obj.patientData.demographics.address.addressLine1 || '', \n    obj.patientData.demographics.address.addressLine2 || '', \n    obj.patientData.demographics.address.addressLine3 || '', \n    obj.patientData.demographics.address.addressLine4 || ''\n  ].filter(function(e) {\n    return e.length > 0\n  }).join(', ')\n  \n  // Set postcode for navigation\n  obj.postCode = (demographics.address && demographics.address.postCode) || ''\n\n  // Set patients age (note: now using moment for more precision)\n  var now = moment().format('YYYY-MM-DD')\n  obj.age = (demographics.birthDate && moment(now).diff(demographics.birthDate, 'years')) || ''\n}\n\n//cti.store.variables.v_selectedDayAppointments.forEach(function(obj, idx) {\n  //obj.index = idx\n//})\n\nreturn appointments;"},{"name":"fn_load_appointments","type":"scripting","item-type":"function","_auto_id_":"c70d8079-dd69-4e9c-8609-3a1e5ac7d4b1","sync":true,"params":[{"name":"filter","description":"Boolean to indicate whether we are filtering existing appointments"}],"content":"window.logManager.consoleLog(\n  'function fn_load_appointments(filter)', \n  'info'\n);\n\n// If filter is true then we are refreshing the list view\n// from the Visits page, so we'll leave the appointment \n// parameters as they are...\nif(filter) {\n  delete cti.store.variables.filter\n  \n  // Reset the v_selectedDayAppointments array\n  cti.store.variables.v_selectedDayAppointments = []\n  // Set the v_appointments array\n  var appointments = cti.store.variables.v_appointments\n\n  // For loop throught the array of appointments\n  for(var i in appointments) {\n    var thisAppointment = appointments[i]\n\n    // If thisAppointment created date matches our filter date then\n    // push this into the v_selectedDayAppointments array\n    if(moment(thisAppointment.appointmentDateTime).format(\"YYYY-MM-DD\") === cti.store.variables.v_appointmentDate) {\n      var pushAppointment = JSON.parse(JSON.stringify(thisAppointment))\n      cti.store.variables.v_selectedDayAppointments.push(pushAppointment)\n    }\n  }\n\n  // Loop through the selectedDay appointments and create readable\n  // index values for them\n  for(var x in cti.store.variables.v_selectedDayAppointments) {\n    var thisSelectedDayAppointment = cti.store.variables.v_selectedDayAppointments[x]\n    thisSelectedDayAppointment.index = parseInt(x)\n  }\n  \n  cti.fn_toggle_spinner('close', '', 500);\n  return false\n} else {\n  // ... otherwise default them to today's date or the last\n  // defined date\n  if(cti.store.variables.v_appointmentDate === undefined) {\n    cti.store.variables.v_appointmentDate = moment().format(\"YYYY-MM-DD\");\n    cti.store.variables.v_appointmentDateText = 'Today';\n  }\n}\n\n// Load appointments from pouch\nwindow.pouchManager.loadFromDatabase('appointments', function (doc) {\n  // Set the appointments variable\n  var appointments = doc.data;\n  \n  // Filter the appointments with user friendly data and append\n  // status values to them via the fn_set_appointments function\n  var setAppointments = cti.fn_set_appointments(appointments);\n\n  // Reset the v_selectedDayAppointments array\n  cti.store.variables.v_selectedDayAppointments = []\n  // Reset the v_appointments array\n  cti.store.variables.v_appointments = []\n  cti.store.variables.v_appointments = JSON.parse(JSON.stringify(setAppointments))\n  \n  // For loop throught the array of appointments\n  for(var i in cti.store.variables.v_appointments) {\n    var thisAppointment = cti.store.variables.v_appointments[i]\n    \n    // Delete all patientData entries bar the demographics\n    delete thisAppointment.patientData.appointmentHistory\n    delete thisAppointment.patientData.referrals\n    delete thisAppointment.patientData.alerts\n    delete thisAppointment.patientData.progressNotes\n    delete thisAppointment.patientData.documents\n    delete thisAppointment.patientData.allergies\n    delete thisAppointment.patientData.contacts\n    delete thisAppointment.patientData.dialogPlusForms\n    delete thisAppointment.patientData.mySafetyPlanForms\n    delete thisAppointment.patientData.lifestyleAssessmentForms\n    \n    // If thisAppointment created date matches our filter date then\n    // push this into the v_selectedDayAppointments array\n    if(moment(thisAppointment.appointmentDateTime).format(\"YYYY-MM-DD\") === cti.store.variables.v_appointmentDate) {\n      var pushAppointment = JSON.parse(JSON.stringify(thisAppointment))\n      cti.store.variables.v_selectedDayAppointments.push(pushAppointment)\n    }\n  }\n  \n  // Loop through the selectedDay appointments and create readable\n  // index values for them\n  for(var x in cti.store.variables.v_selectedDayAppointments) {\n    var thisSelectedDayAppointment = cti.store.variables.v_selectedDayAppointments[x]\n    thisSelectedDayAppointment.index = parseInt(x)\n  }\n  \n  // Update the pouch DB with new data\n  window.pouchManager.saveToDatabase(\"appointments\", setAppointments, function(rev) {\n    window.logManager.consoleLog(\n      'Pouch DB - Updated Appointment Data. Revision: ' + rev, \n      'info', \n      cti.store.schema.metadata.logDebug,\n      cti.store.schema.metadata.startDebug\n    );\n    \n    if(cti.store.variables.filter) {\n      delete cti.store.variables.filter\n      cti.fn_toggle_spinner('close', '', 500);\n    }\n  }, function(reason, e) {\n    window.logManager.consoleLog(\n      'Pouch DB - Failed to Update Appointment Data - ' + reason + e, \n      'error', \n      cti.store.schema.metadata.logDebug,\n      cti.store.schema.metadata.startDebug\n    );\n    \n    if(cti.store.variables.filter) {\n      delete cti.store.variables.filter\n      cti.fn_toggle_spinner('close', '', 500);\n    }\n  });\n}, function (reason, err) {\n  window.logManager.consoleLog(\n    'Pouch DB - Failed retriveing Appointments Data from Pouch - ' + reason + err, \n    'error'\n  );\n  \n  if(cti.store.variables.filter) {\n    delete cti.store.variables.filter\n    cti.fn_toggle_spinner('close', '', 500);\n  }\n});","actions":[]},{"name":"fn_set_view","type":"scripting","item-type":"function","_auto_id_":"37611c81-0396-4a35-a251-859a1c12f244","sync":true,"params":[{"name":"view_name"},{"name":"manual_filter","description":"Passed true when clicked from the filer button"}],"content":"window.logManager.consoleLog(\n  'function fn_set_view(view_name, manualFilter)', \n  'info'\n);\n\nif(view_name == \"Alerts\") {\n  // If view name is Alerts, reset and create a new alerts array based on the filter option\n  var alertsArray = JSON.parse(JSON.stringify(cti.store.variables.selected_visit.patientData.alerts));\n  \n  // Check to see if we're excecuting from the filter button or the menu tab\n  if(manual_filter) {\n    cti.store.variables.filter = \"open\";\n  } else {\n    if(cti.store.variables.filter === undefined) {\n      cti.store.variables.filter = \"open\";\n    } else if(cti.store.variables.filter === \"open\") {\n      cti.store.variables.filter = \"all\";\n    } else if(cti.store.variables.filter === \"all\") {\n      cti.store.variables.filter = \"open\";\n    }\n  }\n  \n  // If the filter is set to open, then loop through the alerts and splice out any\n  // alerts that have been ended (not currently open), otherwise...\n  if(cti.store.variables.filter === \"open\") {\n    for (var i = alertsArray.length; i-- > 0;) {\n      var thisAlert = alertsArray[i];\n\n      if (thisAlert.removalDate) {\n        alertsArray.splice(i, 1);\n      }\n    }\n    \n    // Set open alerts temp variable in the store\n    cti.store.variables.selected_visit.patientData.displayAlerts = alertsArray;\n  } else {\n    // ... set the temp variable to contain all alerts \n    cti.store.variables.selected_visit.patientData.displayAlerts = alertsArray;\n  }\n  \n  // Clear unwanted data\n  delete cti.store.variables.selected_visit.patientData.patient;\n} else if(view_name == \"Patient Demographics\") {\n  // Repackage demographics into temp patient array containing the one object\n  var patient = JSON.parse(JSON.stringify(cti.store.variables.selected_visit.patientData.demographics));\n  var array = [];\n  \n  // Grab the allergies and alers length, and the patients age and NHS number\n  patient.allergiesLength = cti.store.variables.selected_visit.patientData.allergies.length;\n  patient.alertsLength = cti.store.variables.selected_visit.patientData.alerts.length;\n  patient.age = cti.store.variables.selected_visit.age;\n  patient.nhsNumFormatted = cti.store.variables.selected_visit.nhsNumFormatted;\n  \n  // Set default values for missing demographic values\n  if(patient.language === undefined) {\n    patient.language = {\n      code : null,\n      value : \"Not Specified\"\n    }\n  }\n  if(patient.nationality === undefined) {\n    patient.nationality = {\n      code : null,\n      value : \"Not Specified\"\n    }\n  }\n  \n  // Push the demographics data into the array\n  array.push(patient);\n  \n  // Set the temp array in the store\n  cti.store.variables.selected_visit.patientData.patient = array;\n  \n  // Clear unwanted data\n  delete cti.store.variables.selected_visit.patientData.displayAlerts;\n} else if(view_name == \"Appointments\") {\n  for(var i in cti.store.variables.selected_visit.patientData.appointmentHistory) {\n    var thisApp = cti.store.variables.selected_visit.patientData.appointmentHistory[i];\n    \n    if(thisApp.cancellationReason != \"\" || thisApp.comment != \"\" || thisApp.outcome != \"\") {\n      thisApp.rowClass = \"middle-row\";\n   \t} else {\n      thisApp.rowClass = \"bottom-row\";\n    }\n  }\n  \n  // Clear unwanted data\n  delete cti.store.variables.selected_visit.patientData.displayAlerts;\n  delete cti.store.variables.selected_visit.patientData.patient;\n} else {\n  // Clear unwanted data\n  delete cti.store.variables.selected_visit.patientData.displayAlerts;\n  delete cti.store.variables.selected_visit.patientData.patient;\n}\n  \ncti.store.variables.visit_view_mode = view_name;\ncti.utils.updatePage();"},{"name":"fn_normalise_diary_templ","type":"scripting","item-type":"function","_auto_id_":"3d7016ce-be17-479a-a7d3-6b7a3843a799","sync":true,"params":[{"name":"importedTemplate","description":"The diary template array from RiO","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_normalise_diary_templ(importedTemplate)', \n  'info'\n);\n\n// importedTemplate = array of template objects\n\n// Servelec days are 1-indexed.\nvar DAY_NUMBER_OFFSET = 1;\n\nvar diaryTemplate = [{\n  name: 'Monday',\n  sessions: []\n}, {\n  name: 'Tuesday',\n  sessions: []\n}, {\n  name: 'Wednesday',\n  sessions: []\n}, {\n  name: 'Thursday',\n  sessions: []\n}, {\n  name: 'Friday',\n  sessions: []\n}, {\n  name: 'Saturday',\n  sessions: []\n}, {\n  name: 'Sunday',\n  sessions: []\n}];\n\n// Normalise diary template data - we're only interested in so much of it.\ndiaryTemplate.forEach(function (dt, i) {\n  // Add all of today's sessions.\n  dt.sessions = importedTemplate.filter(function (e) {\n    var appointmentsAreAllowed = function appointmentsAreAllowed() {\n      return e.noAppointments != true;\n    };\n    var isCorrectDay = function isCorrectDay() {\n      return e.dayNumber === (i + DAY_NUMBER_OFFSET).toString();\n    };\n    var isInMultiRange = function isInMultiRange() {\n      // If this slot only covers one day, it's not multi so exit.\n      if (e.endDayNumber === e.dayNumber) {\n        return false;\n      }\n\n      return i + DAY_NUMBER_OFFSET >= parseInt(e.dayNumber) && i + DAY_NUMBER_OFFSET <= parseInt(e.endDayNumber);\n    };\n\n    return appointmentsAreAllowed() && (isCorrectDay() || isInMultiRange());\n  }).map(function (e) {\n    return {\n      startTime: e.startTime,\n      endTime: e.endTime,\n      slotLength: parseInt(e.slotLength),\n      addedFromDay: e.dayOfWeek\n    };\n  }).sort(function (a, b) {\n    if (a.startTime < b.startTime) {\n      return -1;\n    }\n    if (a.startTime > b.startTime) {\n      return 1;\n    }\n    if (a.endTime < b.endTime) {\n      return -1;\n    }\n    if (a.endTime > b.endTime) {\n      return 1;\n    }\n    return 0;\n  });\n});\n\ncti.store.variables.v_diary_template = diaryTemplate"},{"name":"fn_merge_busy_slots","type":"scripting","item-type":"function","_auto_id_":"3f67456a-b2da-4d14-86ac-3a43410e64d7","sync":true,"params":[{"name":"bookedSlots","description":"Busy / Booked appointment slots","required":true},{"name":"dow","description":"Day of the week to merge (zero-indexed)","required":true}],"content":"window.logManager.consoleLog(\n  'function fn_merge_busy_slots(bookedSlots, dow)', \n  'info'\n);\n\n// Process all sessions on the given day and return a list of free slots which can be booked into.\n\nvar diaryTemplate = cti.store.variables.v_diary_template\n\nvar selectedDay = diaryTemplate[dow] || {}\nbookedSlots = bookedSlots || []\nvar freeSlots = []\n\n// Ensure we've got at least one session to work with - if not, bomb straight out with empty free slots.\nif (!selectedDay.sessions || !selectedDay.sessions[0] || !selectedDay.sessions[0].startTime) {\n  return freeSlots\n}\n\nbookedSlots.sort(function(a, b) {\n  if (!a.startDateTime || !b.startDateTime || !a.endDateTime || !b.endDateTime) {\n    return 0\n  }\n  if (a.startDateTime < b.startDateTime) {\n    return -1\n  }\n  if (a.startDateTime > b.startDateTime) {\n    return 1\n  }\n  if (a.endDateTime < b.endDateTime) {\n    return -1\n  }\n  if (a.endDateTime > b.endDateTime) {\n    return 1\n  }\n  return 0\n})\n\nvar getBusyPointerStartTime = function getBusyPointerStartTime(busyPointerIndex, sessionIndex) {\n  // Ascertain if we have any booked slots to use and if so, do. Otherwise, use the current end of session marker.\n  if (bookedSlots && bookedSlots.length > busyPointerIndex && bookedSlots[busyPointerIndex].startDateTime) {\n    return moment(bookedSlots[busyPointerIndex].startDateTime)\n  } else {\n    return moment(selectedDay.sessions[sessionIndex].endTime, 'HH:mm')\n  }\n}\n\nvar freePointer = moment.duration(selectedDay.sessions[0].startTime)\n\nvar busyPointerIndex = 0\n\nvar busyPointer = moment.duration(moment(getBusyPointerStartTime(busyPointerIndex, 0)).format('HH:mm'))\n\nselectedDay.sessions.forEach(function(session, index) {\n  var sessionEndMins = moment.duration(session.endTime).asMinutes()\n\n  while (freePointer.asMinutes() + session.slotLength <= sessionEndMins) {\n    // Slot conflict checking...\n    //\n    // - Need to move freePointer to the end of each bookedSlot if it meets / overlaps.\n    // - Can add the free slot if the current potential free slot starts before the current busy pointer (either an appt or the end of session marker) and that slot can exist in its entirety - i.e. adding\n    //   slot length to the start time is still within those bounds.\n    if (freePointer.asMinutes() <= busyPointer.asMinutes() && freePointer.asMinutes() + session.slotLength <= busyPointer.asMinutes()) {\n      var hours = Math.floor(freePointer.asHours())\n      var start = (hours < 10 ? '0' : '') + hours + moment.utc(freePointer.asMilliseconds()).format(':mm')\n\n      // const slot = {\n      //   day: `${selectedDay.name}`,\n      //   time: `${start}`,\n      //   duration: session.slotLength\n      // }\n\n      var slot = {\n        code: '' + start,\n        value: '' + start\n      }\n\n      freeSlots.push(slot)\n    }\n\n    // Update the pointers accordingly.\n\n    // If we're at the start of or into the appt, move the free pointer to the end of this appt and move the busyPointer on to the next appt if there is one or alternatively, the end of the session.\n    if ((freePointer.asMinutes() >= busyPointer.asMinutes() || freePointer.asMinutes() + session.slotLength >= busyPointer.asMinutes()) && !!bookedSlots[busyPointerIndex]) {\n      // Set freePointer to be the latter of the end of the blocking appt and the next available slot start - to avoid odd minutes being made available.\n      var busySlotEnd = moment.duration(moment(bookedSlots[busyPointerIndex].endDateTime, 'YYYY-MM-DD HH:mm:ss').format('HH:mm'))\n\n      // Add as many slot lengths as we need to get past the current busy slot.\n      while (freePointer.asMinutes() < busySlotEnd.asMinutes()) {\n        freePointer = freePointer.add(session.slotLength, 'minutes')\n      }\n\n      busyPointerIndex++\n\n      busyPointer = moment.duration(getBusyPointerStartTime(busyPointerIndex, index).format('HH:mm'))\n    } else {\n      freePointer.add(session.slotLength, 'minutes')\n    }\n  }\n\n  // If we've got another session, update the pointer to either its current position or the start of the next session, whichever is later (to account for session overlaps).\n  if (!!selectedDay.sessions[index + 1]) {\n    var nextSessionStart = moment.duration(selectedDay.sessions[index + 1].startTime)\n    if (nextSessionStart.asMinutes() > freePointer.asMinutes()) {\n      freePointer = nextSessionStart\n    }\n  }\n})\n\nreturn freeSlots"},{"name":"fn_toggle_spinner","type":"scripting","item-type":"function","_auto_id_":"aa8f1181-8707-4e01-b5e9-52879149f436","sync":true,"params":[{"name":"orientation","description":"To dictate whether we are opening or closing the spinner","required":true},{"name":"message","description":"Message to display on the spinner"},{"name":"timeout","description":"Timeout period while data loads"}],"actions":[],"content":"window.logManager.consoleLog(\n  'function fn_toggle_spinner(orientation, message, timeout)', \n  'info'\n);\n\nif(orientation === \"open\") {\n  var spinner = document.querySelectorAll('load-spinner');\n\n  if(spinner && spinner.length > 0) {\n    spinner[0].setAttribute(\"message\", message);\n    spinner[0].show();\n  }\n} else {\n  if(timeout) {\n    setTimeout(function(){\n      var spinner = document.querySelectorAll('load-spinner');\n\n      if(spinner && spinner.length > 0) {\n        spinner[0].close();\n      }\n  \t}, timeout);\n  } else {\n    var spinner = document.querySelectorAll('load-spinner');\n\n    if(spinner && spinner.length > 0) {\n      spinner[0].close();\n    }\n  }\n}"},{"name":"orientation","type":"scripting","item-type":"variable","_auto_id_":"ff995e12-b350-45d6-bdd4-620a2d80d294","variable-type":"string"},{"name":"visit_view_mode","type":"scripting","item-type":"variable","_auto_id_":"f39581dd-c358-49f0-bb82-d9cb14ac9e18","variable-type":"string"},{"name":"visit_list_view_mode","type":"scripting","item-type":"variable","_auto_id_":"67024457-3ad2-4bc9-848a-7c25bed3ef4c","variable-type":"string","value":"list"},{"name":"show_advanced_note","type":"scripting","item-type":"variable","_auto_id_":"9b8f14a4-8f42-4556-ba09-d5771b1fea4f","variable-type":"boolean","value":"false"},{"name":"show_advanced_appt","type":"scripting","item-type":"variable","_auto_id_":"edf0457a-d580-4667-85f4-18ef943cddff","variable-type":"boolean","value":"false"},{"name":"auth_header","type":"scripting","item-type":"variable","_auto_id_":"fa1c2d7f-0a10-47bc-b92c-9f1b18874197","variable-type":"string"},{"name":"v_free_slots","type":"scripting","item-type":"variable","_auto_id_":"bd3dc03e-1399-422e-8ef1-0f44a69ecad7","variable-type":"string"},{"name":"v_dialog_plus_questions","type":"scripting","item-type":"variable","_auto_id_":"50a9aad3-4046-4321-84d0-5cd98ebd21c5","variable-type":"string"},{"name":"api_rio","type":"integration","item-type":"api","_auto_id_":"ff9cc79e-2ce6-4da5-a512-b85cacffe69d","headers":{},"params":[],"operations":[{"name":"getappointments","method":"POST","path":"/getappointments","summary":"Gets a list of appointments with patient data","params":[{"name":"Authorization","type":"string","description":"Base64 encoded username and password","in":"header","required":true},{"name":"applicationkey","description":"The application key","type":"string","typeConfig":{},"in":"header","required":true},{"name":"id","description":"HCP id","type":"string","typeConfig":{},"in":"body","required":true},{"name":"fromDate","description":"Range of appointments from date","type":"string","typeConfig":{},"in":"body","required":true},{"name":"toDate","description":"Range of appointments to date","type":"string","typeConfig":{},"in":"body","required":true}],"responses":[],"$open":false,"ttlMinutes":60,"content-type":""},{"name":"authenticate","method":"POST","path":"/authenticate","summary":"Authenticates a user","params":[{"name":"Authorization","type":"string","description":"Base64 encoded username and password","in":"header","required":true},{"name":"applicationkey","description":"Used to determine which API to connect to","type":"string","typeConfig":{},"in":"header","required":true}],"responses":[],"$open":false,"ttlMinutes":60,"content-type":""},{"ttlMinutes":60,"name":"setappointmenteta","summary":"Specify an ETA at which the HCP expects to arrive at the appointment location","path":"/setappointmenteta","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Base64 encoded username and password","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"application key specific for using our API","type":"string","typeConfig":{},"in":"header","required":true},{"name":"appointmentId","description":"Visit Appointment id","type":"string","typeConfig":{},"in":"body","required":true},{"name":"eta","description":"Arrival ETA","type":"string","typeConfig":{},"in":"body","required":true}]},{"ttlMinutes":60,"name":"alerttypes","summary":"Static Data for Alert Types","path":"/staticdata/alerttypes","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"alertpriorities","summary":"Alert Priorities Static Data","path":"/staticdata/alertpriorities","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"path":"/alerts","name":"getalerts","summary":"Refresh Alerts List","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body","required":true}],"$open":false},{"ttlMinutes":60,"name":"getbookingrefdata","summary":"Get Static Reference Data for Booking an Appointment","path":"/staticdata/appointmentbookingreferencedata","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"diarytemplate","summary":"Diary Template Static Data","path":"/staticdata/diarytemplate","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"teamplannerreferencedata","summary":"teamplannerreferencedata","path":"/staticdata/teamplannerreferencedata","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"teams","description":"teams","type":"string","typeConfig":{},"in":"body","required":true}]},{"ttlMinutes":60,"name":"busydiaryslots","summary":"Get user's busy slots","path":"/bookings/busydiaryslots","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"fromDate","description":"fromDate","type":"string","typeConfig":{},"in":"body","required":true},{"name":"toDate","description":"toDate","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnoteconfig","summary":"Get the Progress Note Configuration","path":"/getprogressnoteconfiguration","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnotetypes","summary":"Get Note Types","path":"/getprogressnotetypes","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnotespecialites","summary":"Get Note Specialites","path":"/getprogressnotespecialites","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getnoterisktypes","summary":"Get Note Risk Types","path":"/getprogressnoterisktypes","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"outcomesave","summary":"Saves outcome of visit","path":"/appointments/outcomesave","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body"}]},{"ttlMinutes":60,"name":"getdocument","summary":"Gets individual document data","path":"/getdocument","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header base64","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}]},{"ttlMinutes":60,"name":"getstaticdata","summary":"Pulls back all static data in one call","path":"/staticdata","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header","required":true}]},{"ttlMinutes":60,"name":"submitsafetyform","summary":"Submits the safety form","path":"/mysafetyplan/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":true},{"ttlMinutes":60,"name":"submitdialogform","summary":"Submits dialog+ form","path":"/dialogplus/add","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}]}],"url":"https://infinity-dev.api.servelechsc.com/api/v3","definitions":{}},{"name":"api_rio_offline","type":"integration","item-type":"offline-api","_auto_id_":"e3100357-1301-4eee-982a-02d7257ac7ad","headers":{},"params":[],"operations":[{"name":"alertsadd","method":"POST","path":"/alerts/add","summary":"Add an alert","params":[{"name":"Authorization","type":"string","description":"Base64 encoded username and password","in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body","required":true}],"responses":[],"$open":false,"ttlMinutes":60,"content-type":"application/json"},{"name":"outcomesave","method":"POST","path":"/appointments/outcomesave","summary":"The outcome of the appointment","params":[{"name":"Authorization","type":"string","description":"Base64 encoded username and password","in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"payload","description":"payload","type":"string","typeConfig":{},"in":"body","required":true}],"responses":[],"$open":false,"ttlMinutes":60,"content-type":"application/json"},{"ttlMinutes":60,"name":"addprogressnote","summary":"Add progress note","path":"/addprogressnote","method":"POST","content-type":"application/json","downloadAsFile":false,"params":[{"name":"Authorization","description":"Authorization","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true},{"name":"payload","description":"Request payload","type":"string","typeConfig":{},"in":"body","required":true}],"$open":false},{"ttlMinutes":60,"name":"getalerts","summary":"Get Patient Specific Alerts","path":"/alerts","method":"POST","content-type":"application/json","$open":false,"params":[{"name":"Authorization","description":"Authorization Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}]},{"ttlMinutes":60,"name":"removealert","summary":"Remove a singular alert","path":"/alerts/remove","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}]},{"ttlMinutes":60,"name":"getprogressnotes","summary":"Fetches a refreshed list of Progress Notes","path":"/getprogressnotes","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":1000,"name":"addHCPAppointment","summary":"Add new HCP appointment","path":"/appointments/add","method":"POST","content-type":"application/json","$open":false,"params":[{"name":"payload","description":"Appointment payload","type":"string","typeConfig":{},"in":"body","required":true},{"name":"Authorization","description":"Auth header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"}]},{"ttlMinutes":60,"name":"addTPAppointment","summary":"Add a new Team Planner appointment","path":"/appointments/teamadd","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"payload","description":"Payload object","type":"string","typeConfig":{},"in":"body"}],"$open":false},{"ttlMinutes":60,"name":"getappointment","summary":"Gets an updated singular appointment without the patientData","path":"/getappointment","method":"POST","content-type":"application/json","params":[{"name":"Authorization","description":"Auth Header","type":"string","typeConfig":{},"in":"header"},{"name":"applicationkey","description":"App key","type":"string","typeConfig":{},"in":"header"},{"name":"appointmentId","description":"Appointment ID","type":"string","typeConfig":{},"in":"body"}],"$open":false}],"url":"https://infinity-dev.api.servelechsc.com/api/v3","definitions":{}},{"name":"api_rio_offline_main","type":"integration","item-type":"offline-api","_auto_id_":"5e944fe4-e097-4c9c-a50b-fc7d414e79c6","headers":{},"params":[],"operations":[{"ttlMinutes":60,"name":"pushRegister","summary":"Registers the device for push notifications.","path":"/push/register","method":"POST","content-type":"application/json","params":[{"name":"os","description":"Operating system the request is being sent from","type":"string","typeConfig":{},"in":"body","required":true},{"name":"notificationToken","description":"Device's unique token registered against the relevant service.","type":"string","typeConfig":{},"in":"body","required":true},{"name":"username","description":"The username of the currently logged in user - for targetted notifications.","type":"string","typeConfig":{},"in":"body","required":true},{"name":"registeredPushId","description":"If this user / device combo is already registered, the saved ID.","type":"string","typeConfig":{},"in":"body"},{"name":"Authorization","description":"Base64 encoded username and password","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}],"$open":false},{"ttlMinutes":60,"name":"pushDeregister","summary":"Deregisters the user / device from the push notification service.","path":"/push/deregister","method":"POST","content-type":"application/json","$open":false,"params":[{"name":"registeredPushId","description":"If this user / device combo is already registered, the saved ID.","type":"string","typeConfig":{},"in":"body","required":true},{"name":"tags","description":"The tags registered by this device - in this case, the username.","type":"string","typeConfig":{},"in":"body"},{"name":"Authorization","description":"Base64 encoded username and password","type":"string","typeConfig":{},"in":"header","required":true},{"name":"applicationkey","description":"applicationkey","type":"string","typeConfig":{},"in":"header","required":true}]}],"url":"https://infinity-dev.api.servelechsc.com/api"},{"name":"url_google_maps","type":"integration","item-type":"url","_auto_id_":"99606cfa-4927-4aab-92cd-6ab72e962172","params":{},"target":"_system","url":"http://maps.google.com/"},{"name":"notification_error","type":"notification","item-type":"app-notification","_auto_id_":"cf63ce44-16b9-458b-91ea-193c9afb1e24","options":{"autoDismiss":true},"style":"error"},{"name":"notification_info","type":"notification","item-type":"app-notification","_auto_id_":"418171e5-8009-4f8f-a133-497c6b69bb68","options":{"autoDismiss":true},"style":"success"},{"name":"notification_success","type":"notification","item-type":"app-notification","_auto_id_":"8b78ba02-4727-403e-bfa2-4c4b69abdc60","options":{"autoDismiss":true},"style":"success"},{"name":"notification_warning","type":"notification","item-type":"app-notification","_auto_id_":"8b5715bf-9908-40b7-98a4-b5975d10d9a6","options":{"autoDismiss":true},"style":"warning"},{"name":"font_opensans","type":"style","item-type":"font-asset","_auto_id_":"1f8cd6ea-7dcb-4503-8818-9eb7e56c24a0","fileName":"OpenSans-Regular.ttf"},{"name":"font_opensans_light","type":"style","item-type":"font-asset","_auto_id_":"49937495-4d70-4dba-bbf8-9c958aa0ef5b","fileName":"OpenSans-Light.ttf"},{"name":"css_main","type":"style","item-type":"css-asset","_auto_id_":"488967a5-4bd6-4b52-ba9c-978d74bf588d","fileName":"servelec.css"},{"name":"image_rio_logo","type":"style","item-type":"image-asset","_auto_id_":"89dea4f3-c423-4e7e-a8a8-3b8a40de8e78","fileName":"RiO oceano o Logo.jpg"},{"name":"image_servelec_logo","type":"style","item-type":"image-asset","_auto_id_":"6d030ecb-5ab3-4797-8b4f-ec56a756683c","fileName":"Servelec hsc Logo - RGB.JPG"},{"name":"image_splash","type":"style","item-type":"image-asset","_auto_id_":"6bdf425d-97ca-436f-b8b4-3421db0de522","fileName":"newriopage.png"},{"name":"image_pin","type":"style","item-type":"image-asset","_auto_id_":"62dc3282-89ff-42d3-96ef-b00f8aa908ac","fileName":"pin.png"},{"name":"image_safety","type":"style","item-type":"image-asset","_auto_id_":"7e3576ed-6cb2-4862-8635-8a3ff8d73e15","fileName":"thin-0635_anti_virus_protection_shield.png"},{"name":"image_dialog","type":"style","item-type":"image-asset","_auto_id_":"cb3b2616-5191-4a17-8f7b-6d15d4d4f2c1","fileName":"thin-0064_bullet_list_view.png"},{"name":"image_lifestyle","type":"style","item-type":"image-asset","_auto_id_":"1b232ceb-3f4f-411b-8dc8-6bc1a934288d","fileName":"thin-0842_fitness_running.png"},{"name":"image_medicine","type":"style","item-type":"image-asset","_auto_id_":"e26dc941-01e4-470c-bbf5-040c55051682","fileName":"thin-0820_medicine_drugs_ill_pill.png"},{"name":"image_referral","type":"style","item-type":"image-asset","_auto_id_":"0b1032df-8914-44f4-bc48-adb0e139bd07","fileName":"thin-0825_stetoscope_doctor_hospital_ill.png"},{"name":"image_admission","type":"style","item-type":"image-asset","_auto_id_":"96d37b07-2d9f-4bed-976c-d8860cbf6a37","fileName":"thin-0823_hospital_ill_medicine_doctor_ambulance.png"},{"name":"image_vte","type":"style","item-type":"image-asset","_auto_id_":"d190680f-a104-4679-a2ca-ea06b54dba5a","fileName":"thin-0815_lungs_breathing.png"},{"name":"image_timeline","type":"style","item-type":"image-asset","_auto_id_":"396cdc17-cfe6-4c39-925b-dd71f5f55b34","fileName":"thin-0117_folder_documents_revert_history.png"},{"name":"image_alerts","type":"style","item-type":"image-asset","_auto_id_":"9f0fd3f9-f77a-4044-94ad-e30eae9862fc","fileName":"thin-0550_attention_error_alert_caution.png"},{"name":"image_documents","type":"style","item-type":"image-asset","_auto_id_":"fad17b99-7240-40ec-8f1d-aba5bab2eddf","fileName":"thin-0073_documents_files_paper_text_archive_copy.png"},{"name":"image_appointments","type":"style","item-type":"image-asset","_auto_id_":"ca808029-f4b7-4c03-93c7-ac0622011b4b","fileName":"thin-0023_calendar_month_day_planner_events.png"},{"name":"image_mha","type":"style","item-type":"image-asset","_auto_id_":"7d2f098c-ce28-4e02-9937-6c5a9a5c0f55","fileName":"thin-0026_time_watch_clock.png"},{"name":"image_contacts","type":"style","item-type":"image-asset","_auto_id_":"bb99e399-8591-47bd-a394-3d99f8b61b87","fileName":"thin-0301_address_book_contacts.png"},{"name":"image_progress","type":"style","item-type":"image-asset","_auto_id_":"6a286242-0da6-49e2-8976-07847b05df15","fileName":"thin-0003_write_pencil_new_edit.png"},{"name":"image_allergies","type":"style","item-type":"image-asset","_auto_id_":"34927d85-70a3-46d9-bd8a-e8c988ac0aed","fileName":"thin-0816_microscope_laboratory.png"},{"name":"image_patient","type":"style","item-type":"image-asset","_auto_id_":"92887b73-99fc-4edd-9d2c-652de57cc908","fileName":"thin-0708_user_profile.png"},{"name":"image_tasks","type":"style","item-type":"image-asset","_auto_id_":"379e363f-0905-4ee1-9d24-117247b1b19d","fileName":"thin-0102_notebook_to_do_bullets_list.png"},{"name":"alert_icon","type":"style","item-type":"image-asset","_auto_id_":"2094a016-4438-4992-936e-5e70fa228f6f","fileName":"alert_icon.svg"},{"name":"allergy_icon","type":"style","item-type":"image-asset","_auto_id_":"5dc19083-4d4e-459f-bd7f-705738d94251","fileName":"allergy_icon.svg"},{"name":"handset_icon","type":"style","item-type":"image-asset","_auto_id_":"90d0eec3-c0fb-477c-b9c7-fd906245215e","fileName":"handset_icon.png"},{"name":"location","type":"style","item-type":"image-asset","_auto_id_":"22fc0c57-f15d-465f-92ce-05ecba99d661","fileName":"location.png"},{"name":"image_alerts_semi","type":"style","item-type":"image-asset","_auto_id_":"16418353-b8cc-496c-b2bf-689de97e588e","fileName":"thin-0550_attention_error_alert_caution_semi.png"},{"name":"appt_or_patient_update","type":"notification","item-type":"push-event","_auto_id_":"15e300c3-0df8-4b32-b75d-00b2268be1e0","operations":[],"actions":[{"event":"push-received","type":"inline-function","data":{"sync":true,"code":"console.log('PUSH!!!', JSON.stringify($data.$notification))\n\nif($data.$notification.payload.appointmentId) {\n  cti.store.variables.getAppointmentPayload = {\n    appointmentId : undefined,\n    appointmentExists : false\n  }\n  \n  cti.store.variables.getAppointmentPayload.appointmentId = $data.$notification.payload.appointmentId\n\n  // Load appointments from pouch\n  window.pouchManager.loadFromDatabase('appointments', function (doc) {\n    // Set the appointments array\n    var appointments = doc.data\n\n    // Check that we have a valid appointment\n    for(var i in appointments) {\n      if(appointments[i].appointmentId == cti.store.variables.appointmentId) {\n        cti.store.variables.getAppointmentPayload.appointmentExists = true\n      }\n    }\n    \n\tcti.utils.callAction(\"call-actionflow\", { name: \"GetAppointment\" })\n  }, function (reason, err) {\n    console.log('Error: Failed retriveing Appointments Data from Pouch - ', reason + err);\n  });\n}"},"_auto_id_":"e84bce67-6070-42c0-98ad-0febc6c07714"}]}],"components":[{"name":"ct_popup_box","description":"","icon":"fa-puzzle-piece","_auto_id_":"606531b4-9a85-4f06-b7ce-52e3902da20a","tagName":"ct-popup-box","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"id","description":"","type":"string","enum":null,"required":true}],"functions":[{"name":"toggle","description":"Toggles the menu opened and closed based on the value\nof the this.opened property (initially set to false)","params":[{"name":"containerid","description":"id of container the popup is in","type":"string","enum":null,"required":true}],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"ct_popup_box.js","transpiled":"ct_popup_box.output.js"}},{"name":"ct_context_menu","description":"","icon":"fa-puzzle-piece","_auto_id_":"1fa0aab1-7b03-413d-b3e0-433405059753","tagName":"ct-context-menu","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"MinWidth","description":"","type":"number","enum":null,"required":false},{"name":"Direction","description":"","type":"string","enum":null,"required":false},{"name":"Overlay","description":"","type":"boolean","enum":null,"required":false}],"functions":[{"name":"toggle","description":"Toggles the page opened and closed based on the value\nof the this.opened property (initially set to false)","params":[],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"ct_context_menu.js","transpiled":"ct_context_menu.output.js"}},{"name":"activity_spinner","description":"","icon":"fa-puzzle-piece","_auto_id_":"0d99e205-ae61-431d-85d1-6a3702fa694b","tagName":"load-spinner","type":"web-component","format":"javascript","typeVersion":"1","annotations":{"attributes":[{"name":"message","description":"A message to display whilst the spinner is showing","type":"string","enum":null,"required":false}],"functions":[{"name":"show","description":"Invoke the spinner","params":[],"returnType":"void","returnEnum":null},{"name":"close","description":"Remove/hide the spinner","params":[],"returnType":"void","returnEnum":null}]},"userConfig":{},"valid":true,"files":{"original":"activity_spinner.js","transpiled":"activity_spinner.output.js"}}],"lastSchemaUpgradeDate":"WNGRADED_MANUALLY_FROM_24_TO_22_BY_KEVIN_FREEMAN","icondata":"rio_logo.png","jwt":"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhcHBfaWQiOiJmZGZkODljYi01NDZjLTQyMTItODVmNy1kODQ4ZGMzN2EwNzUiLCJhcHBfbmFtZSI6IkNvbW11bml0eV9Xb3JrZXIiLCJidWlsZF9pZCI6ImY2MDRiMDRhLWMxYTEtNDkwZC1iMjJiLWYxNjVkOTdjNzdlZiIsImNsaWVudF9pZCI6Ijc3ZGJmY2YyLWQwMWYtNDUwOS05ZTFiLTlhY2E5ZjE1OGM0NCIsImNsaWVudF9zZWNyZXQiOiJOR1UwVGpaV01sVndjMWw2VEdnMlJ6SktURGxLUVQwOSIsImV4cCI6MTUxNDQ1NDA0MywiZnJlcXVlbmN5IjoyMTYwMDAwMDAsImhhc2giOiIwNWZjYWU4ZmU0ZWMwMzUzNzNiMGRiNTU5NDI4YjY3ZjQ1MTI1NWM4Njk2OTM4N2I0YjE4OTViYzVmNTdiYTY3IiwibGljX2V4cCI6MTUxMTg2MjA0MywibHBfaWQiOiI2YzgyYjEwYy05N2FkLTQyY2UtOGY3ZC1iMzBiYWMzM2NlMjAiLCJwYWNrYWdlX2lkIjoiY29tLmNvbW1vbnRpbWUuaW5maW5pdHkuY29tbXVuaXR5d29ya2VyIiwicmVmcmVzaF90b2tlbiI6IlZUWmhaU3RtWWtGbFZUSTVOM2R4Y0ZocGMyeFBVVVZ4WVVScVJTOHZOR2RoZUdSUmVYWm1WVlpYY3owPSIsInR5cGUiOiJmcmVlIiwiaWF0IjoxNTExODYyMDQzfQ.ufZ07QWIEVJ5Sm0jF3eB7RHPxRguSD065brnAc3R9-W0RXCP6qFTdYADjPkeBDOGMUjQ-_n1ex_Qy-vdqP6rtMFfH3e0Bz0GBNoDV5YtNdNte3p5obxmEIM3HgCwxX1zmjdjmIp_Tk3bLv3fF5QSTWucJoPscJj2Wto1BZljkSZRlv4z1kU3eWD3WKh-P2AGnx2FFuxpvkAjLMt2bYxjZTgITb6XoqsiNt6oKpz_UHfewfbX6pubUpmT0AZkH4hFPnlHhbOmGb9rh8uTjEpPDBJx_ypUfo6vNwMh9e_LQKB_qeAl6qrUzhK7SEmG2TvnkIGoAzKRV8dGuxmOA7XY4Q","buildId":"f604b04a-c1a1-490d-b22b-f165d97c77ef","hostContext":0}